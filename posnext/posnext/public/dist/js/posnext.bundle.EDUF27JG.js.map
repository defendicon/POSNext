{
  "version": 3,
  "sources": ["../../../../../apps/posnext/posnext/public/js/pos_controller.js", "../../../../../apps/posnext/posnext/public/js/pos_item_selector.js", "../../../../../apps/posnext/posnext/public/js/pos_item_cart.js", "../../../../../apps/posnext/posnext/public/js/pos_item_details.js", "../../../../../apps/posnext/posnext/public/js/pos_number_pad.js", "../../../../../apps/posnext/posnext/public/js/pos_payment.js", "../../../../../apps/posnext/posnext/public/js/pos_past_order_list.js", "../../../../../apps/posnext/posnext/public/js/pos_past_order_summary.js"],
  "sourcesContent": ["frappe.provide('posnext.PointOfSale');\nvar selected_item = null\n\nposnext.PointOfSale.Controller = class {\n\tconstructor(wrapper) {\n\t\tconsole.log(\"CONTROLLLLLERE\")\n\t\tthis.wrapper = $(wrapper).find('.layout-main-section');\n\t\tthis.page = wrapper.page;\n\t\tthis.add_ledger_balance_box();\n\t\tfrappe.run_serially([\n\t\t\t() => this.reload_status = false,\n\t\t\t() => this.check_opening_entry(\"\"),\n\t\t\t() => this.reload_status = true,\n\t\t]);\n\n\n\n\t}\n\n    // Function to add the ledger balance box\n    add_ledger_balance_box() {\n        const updateLedgerBalance = (customerSection, balance) => {\n            let ledgerBalanceDiv = document.getElementById(\"ledger-balance-box\");\n\n            if (!ledgerBalanceDiv) {\n                ledgerBalanceDiv = document.createElement(\"div\");\n                ledgerBalanceDiv.id = \"ledger-balance-box\";\n                ledgerBalanceDiv.style.marginTop = \"10px\";\n                ledgerBalanceDiv.style.padding = \"10px\";\n                ledgerBalanceDiv.style.border = \"1px solid #ccc\";\n                ledgerBalanceDiv.style.borderRadius = \"4px\";\n                ledgerBalanceDiv.style.backgroundColor = \"#f0f8ff\";\n                ledgerBalanceDiv.style.fontWeight = \"bold\";\n                customerSection.appendChild(ledgerBalanceDiv);\n            }\n\n            // Update the balance\n            ledgerBalanceDiv.textContent = `Ledger Balance: Rs. ${balance}`;\n        };\n\n        const fetchLedgerBalance = async (customerId) => {\n            try {\n                const response = await frappe.call({\n                    method: \"posnext.controllers.queries.get_ledger_balance\",\n                    args: { customer: customerId },\n                });\n                return response.message || \"0.00\"; // Default to 0.00 if no balance found\n            } catch (error) {\n                console.error(\"Failed to fetch ledger balance:\", error);\n                return \"Error\";\n            }\n        };\n\n        // Watch for customer section changes\n        const observer = new MutationObserver(async () => {\n            const customerSection = document.querySelector(\".customer-section\");\n\n            if (customerSection) {\n                const resetCustomerBtn = customerSection.querySelector(\".reset-customer-btn\");\n                const customerId = resetCustomerBtn?.getAttribute(\"data-customer\");\n\n                if (customerId && customerId !== \"undefined\") {\n                    const ledgerBalance = await fetchLedgerBalance(customerId);\n                    updateLedgerBalance(customerSection, ledgerBalance);\n                } else {\n                    updateLedgerBalance(customerSection, \"Select a Customer\");\n                }\n            }\n        });\n\n        observer.observe(document.body, {\n            childList: true,\n            subtree: true,\n        });\n};\n\n\tfetch_opening_entry(value) {\n\t\treturn frappe.call(\"posnext.posnext.page.posnext.point_of_sale.check_opening_entry\", { \"user\": frappe.session.user, \"value\": value });\n\t}\n\n\tcheck_opening_entry(value = \"\") {\n\t\tthis.fetch_opening_entry(value).then((r) => {\n\t\t\tif (r.message.length) {\n\t\t\t\t// assuming only one opening voucher is available for the current user\n\t\t\t\tthis.prepare_app_defaults(r.message[0]);\n\t\t\t} else {\n\t\t\t\tthis.create_opening_voucher();\n\t\t\t}\n\t\t});\n\t}\n\n\tcreate_opening_voucher() {\n\t\tconst me = this;\n\t\tconst table_fields = [\n\t\t\t{\n\t\t\t\tfieldname: \"mode_of_payment\", fieldtype: \"Link\",\n\t\t\t\tin_list_view: 1, label: \"Mode of Payment\",\n\t\t\t\toptions: \"Mode of Payment\", reqd: 1\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"opening_amount\", fieldtype: \"Currency\",\n\t\t\t\tin_list_view: 1, label: \"Opening Amount\",\n\t\t\t\toptions: \"company:company_currency\",\n\t\t\t\tchange: function () {\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data.some(d => {\n\t\t\t\t\t\tif (d.idx == this.doc.idx) {\n\t\t\t\t\t\t\td.opening_amount = this.value;\n\t\t\t\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst fetch_pos_payment_methods = () => {\n\t\t\tconst pos_profile = dialog.fields_dict.pos_profile.get_value();\n\t\t\tif (!pos_profile) return;\n\t\t\tfrappe.db.get_doc(\"POS Profile\", pos_profile).then(({ payments }) => {\n\t\t\t\tdialog.fields_dict.balance_details.df.data = [];\n\t\t\t\tpayments.forEach(pay => {\n\t\t\t\t\tconst { mode_of_payment } = pay;\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data.push({ mode_of_payment, opening_amount: '0' });\n\t\t\t\t});\n\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t});\n\t\t}\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Create POS Opening Entry'),\n\t\t\tstatic: true,\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Link', label: __('Company'), default: frappe.defaults.get_default('company'),\n\t\t\t\t\toptions: 'Company', fieldname: 'company', reqd: 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Link', label: __('POS Profile'),\n\t\t\t\t\toptions: 'POS Profile', fieldname: 'pos_profile', reqd: 1,\n\t\t\t\t\tget_query: () => pos_profile_query(),\n\t\t\t\t\tonchange: () => fetch_pos_payment_methods()\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"balance_details\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\tlabel: \"Opening Balance Details\",\n\t\t\t\t\tcannot_add_rows: false,\n\t\t\t\t\tin_place_edit: true,\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdata: [],\n\t\t\t\t\tfields: table_fields\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: async function({ company, pos_profile, balance_details }) {\n\t\t\t\tif (!balance_details.length) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Please add Mode of payments and opening balance details.\"),\n\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t})\n\t\t\t\t\treturn frappe.utils.play_sound(\"error\");\n\t\t\t\t}\n\n\t\t\t\t// filter balance details for empty rows\n\t\t\t\tbalance_details = balance_details.filter(d => d.mode_of_payment);\n\n\t\t\t\tconst method = \"posnext.posnext.page.posnext.point_of_sale.create_opening_voucher\";\n\t\t\t\tconst res = await frappe.call({ method, args: { pos_profile, company, balance_details }, freeze:true });\n\t\t\t\t!res.exc && me.prepare_app_defaults(res.message);\n\t\t\t\tdialog.hide();\n\t\t\t},\n\t\t\tprimary_action_label: __('Submit')\n\t\t});\n\t\tdialog.show();\n\t\tconst pos_profile_query = () => {\n\t\t\treturn {\n\t\t\t\tquery: 'erpnext.accounts.doctype.pos_profile.pos_profile.pos_profile_query',\n\t\t\t\tfilters: { company: dialog.fields_dict.company.get_value() }\n\t\t\t}\n\t\t};\n\t}\n\n\tasync prepare_app_defaults(data) {\n\t\tthis.pos_opening = data.name;\n\t\tthis.company = data.company;\n\t\tthis.pos_profile = data.pos_profile;\n\t\tthis.pos_opening_time = data.period_start_date;\n\t\tthis.item_stock_map = {};\n\t\tthis.settings = {};\n\t\twindow.current_pos_profile = this.pos_profile\n\t\tfrappe.db.get_value('Stock Settings', undefined, 'allow_negative_stock').then(({ message }) => {\n\t\t\tthis.allow_negative_stock = flt(message.allow_negative_stock) || false;\n\t\t});\n\n\t\tfrappe.call({\n\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.get_pos_profile_data\",\n\t\t\targs: { \"pos_profile\": this.pos_profile },\n\t\t\tcallback: (res) => {\n\t\t\t\tconst profile = res.message;\n\n\t\t\t\tObject.assign(this.settings, profile);\n\t\t\t\tthis.settings.customer_groups = profile.customer_groups.map(group => group.name);\n\n\t\t\t\tthis.make_app();\n\t\t\t}\n\t\t});\n\t}\n\n\tset_opening_entry_status() {\n\t\tthis.page.set_title_sub(\n\t\t\t`<span class=\"indicator orange\">\n\t\t\t\t<a class=\"text-muted\" href=\"#Form/POS%20Opening%20Entry/${this.pos_opening}\">\n\t\t\t\t\tOpened at ${moment(this.pos_opening_time).format(\"Do MMMM, h:mma\")}\n\t\t\t\t</a>\n\t\t\t</span>`);\n\t}\n\n\tmake_app() {\n\t\tthis.prepare_dom();\n\t\tthis.prepare_components();\n\t\tthis.prepare_menu();\n\t\tthis.make_new_invoice();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<div class=\"point-of-sale-app\"></div>`\n\t\t);\n\n\t\tthis.$components_wrapper = this.wrapper.find('.point-of-sale-app');\n\t}\n\n\tprepare_components() {\n\t\tthis.init_item_selector();\n\t\tthis.init_item_details();\n\t\tthis.init_item_cart();\n\t\tthis.init_payments();\n\t\tthis.init_recent_order_list();\n\t\tthis.init_order_summary();\n\t}\n\n\tprepare_menu() {\n\t\tthis.page.clear_menu();\n\t\tif(this.settings.custom_show_open_form_view){\n\t\t\tthis.page.add_menu_item(__(\"Open Form View\"), this.open_form_view.bind(this), false, 'Ctrl+F');\n\t\t}\n\t\tif(this.settings.custom_show_toggle_recent_orders) {\n\t\t\tthis.page.add_menu_item(__(\"Toggle Recent Orders\"), this.toggle_recent_order.bind(this), false, 'Ctrl+O');\n\t\t}\n\t\tif(this.settings.custom_show_save_as_draft) {\n\t\t\tthis.page.add_menu_item(__(\"Save as Draft\"), this.save_draft_invoice.bind(this), false, 'Ctrl+S');\n\t\t}\n\t\tif(this.settings.custom_show_close_the_pos) {\n\t\t\tthis.page.add_menu_item(__('Close the POS'), this.close_pos.bind(this), false, 'Shift+Ctrl+C');\n\t\t}\n\t}\n\n\topen_form_view() {\n\t\tfrappe.model.sync(this.frm.doc);\n\t\tfrappe.set_route(\"Form\", this.frm.doc.doctype, this.frm.doc.name);\n\t}\n\n\ttoggle_recent_order() {\n\t\tconst show = this.recent_order_list.$component.is(':hidden');\n\t\tthis.toggle_recent_order_list(show);\n\t}\n\n\tsave_draft_invoice() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\t\tconsole.log(this.frm.doc.items)\n\t\tif (this.frm.doc.items.length == 0) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"You must add atleast one item to save it as draft.\"),\n\t\t\t\tindicator:'red'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.frm.save(undefined, undefined, undefined, () => {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"There was an error saving the document.\"),\n\t\t\t\tindicator: 'red'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t}).then(() => {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t() => this.make_new_invoice(true),\n\t\t\t\t() => frappe.dom.unfreeze()\n\n\n\t\t\t]);\n\n\n\n\t\t});\n\t}\n\n\tclose_pos() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\n\t\tlet voucher = frappe.model.get_new_doc('POS Closing Entry');\n\t\tvoucher.pos_profile = this.frm.doc.pos_profile;\n\t\tvoucher.user = frappe.session.user;\n\t\tvoucher.company = this.frm.doc.company;\n\t\tvoucher.pos_opening_entry = this.pos_opening;\n\t\tvoucher.period_end_date = frappe.datetime.now_datetime();\n\t\tvoucher.posting_date = frappe.datetime.now_date();\n\t\tvoucher.posting_time = frappe.datetime.now_time();\n\t\tfrappe.set_route('Form', 'POS Closing Entry', voucher.name);\n\t}\n\n\tinit_item_selector() {\n\t\tif(this.frm){\n\t\tthis.frm.doc.set_warehouse = this.settings.warehouse\n\t\t}\n\t\tthis.item_selector = new posnext.PointOfSale.ItemSelector({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tpos_profile: this.pos_profile,\n\t\t\tsettings: this.settings,\n\t\t\treload_status: this.reload_status,\n\t\t\tcurrency: this.settings.currency,\n\t\t\tevents: {\n\t\t\t\tcheck_opening_entry: () => this.check_opening_entry(),\n\t\t\t\titem_selected: args => this.on_cart_update(args),\n\t\t\t\tinit_item_cart: () => this.init_item_cart(),\n\t\t\t\tinit_item_details: () => this.init_item_details(),\n\t\t\t\tchange_items: (args) => this.change_items(args),\n\t\t\t\tget_frm: () => this.frm || {}\n\t\t\t}\n\t\t})\n\t}\n\tchange_items(items){\n\t\tvar me = this\n\t\tthis.frm = items;\n\t\tthis.cart.load_invoice()\n\t}\n\n\tinit_item_cart() {\n\t\tthis.cart = new posnext.PointOfSale.ItemCart({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\t\t\t\tremove_item_from_cart: (item) => {\n\t\t\t\t\tthis.item_details.current_item = item\n\t\t\t\t\tthis.item_details.name = item.name\n\t\t\t\t\tthis.item_details.doctype= item.doctype\n\n\t\t\t\t},\n\t\t\t\tform_updated: (item, field, value) => {\n\t\t\t\t\tthis.item_details.current_item = item\n\t\t\t\t\tconst item_row = frappe.model.get_doc(item.doctype, item.name);\n\t\t\t\t\tif(field === 'qty' && this.frm.doc.is_return && value >=0){\n\t\t\t\t\t\tfrappe.throw(\"Qty must be negative for return document\" )\n\t\t\t\t\t}\n\t\t\t\t\tif (item_row && item_row[field] != value) {\n\t\t\t\t\t\tconst args = {\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\titem: this.item_details.current_item\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn this.on_cart_update(args);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t},\n\t\t\t\tcart_item_clicked: (item) => {\n\n\t\t\t\t\tconst item_row = this.get_item_from_frm(item);\n\n\t\t\t\t\tif(selected_item && selected_item['name'] == item['name']){\n\t\t\t\t\t\tselected_item = null\n\t\t\t\t\t} else {\n\t\t\t\t\t\tselected_item = item_row\n\t\t\t\t\t}\n\t\t\t\t\tthis.item_details.toggle_item_details_section(item_row);\n\t\t\t\t},\n\n\t\t\t\tnumpad_event: (value, action) => this.update_item_field(value, action),\n\n\t\t\t\tcheckout: () => this.save_and_checkout(),\n\n\t\t\t\tedit_cart: () => this.payment.edit_cart(),\n\t\t\t\tsave_draft_invoice: () => this.save_draft_invoice(),\n\t\t\t\ttoggle_recent_order: () => this.toggle_recent_order(),\n\t\t\t\tcustomer_details_updated: (details) => {\n\t\t\t\t\tthis.customer_details = details;\n\t\t\t\t\t// will add/remove LP payment method\n\t\t\t\t\tthis.payment.render_loyalty_points_payment_mode();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tinit_item_details() {\n\t\tthis.item_details = new posnext.PointOfSale.ItemDetails({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\ttoggle_item_selector: (minimize) => {\n\t\t\t\t\tthis.item_selector.resize_selector(minimize);\n\t\t\t\t\tthis.cart.toggle_numpad(minimize);\n\t\t\t\t},\n\n\t\t\t\tform_updated: (item, field, value) => {\n\t\t\t\t\tconst item_row = frappe.model.get_doc(item.doctype, item.name);\n\t\t\t\t\tif(field === 'qty' && this.frm.doc.is_return && value >=0){\n\t\t\t\t\t\tfrappe.throw(\"Qty must be negative for return document\" )\n\t\t\t\t\t}\n\t\t\t\t\tif (item_row && item_row[field] != value) {\n\t\t\t\t\t\tconst args = {\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\titem: this.item_details.current_item\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn this.on_cart_update(args);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t},\n\n\t\t\t\thighlight_cart_item: (item) => {\n\t\t\t\t\tconst cart_item = this.cart.get_cart_item(item);\n\t\t\t\t\tthis.cart.toggle_item_highlight(cart_item);\n\t\t\t\t},\n\n\t\t\t\titem_field_focused: (fieldname) => {\n\t\t\t\t\tthis.cart.toggle_numpad_field_edit(fieldname);\n\t\t\t\t},\n\t\t\t\tset_value_in_current_cart_item: (selector, value) => {\n\t\t\t\t\tthis.cart.update_selector_value_in_cart_item(selector, value, this.item_details.current_item);\n\t\t\t\t},\n\t\t\t\tclone_new_batch_item_in_frm: (batch_serial_map, item) => {\n\t\t\t\t\t// called if serial nos are 'auto_selected' and if those serial nos belongs to multiple batches\n\t\t\t\t\t// for each unique batch new item row is added in the form & cart\n\t\t\t\t\tObject.keys(batch_serial_map).forEach(batch => {\n\t\t\t\t\t\tconst item_to_clone = this.frm.doc.items.find(i => i.name == item.name);\n\t\t\t\t\t\tconst new_row = this.frm.add_child(\"items\", { ...item_to_clone });\n\t\t\t\t\t\t// update new serialno and batch\n\t\t\t\t\t\tnew_row.batch_no = batch;\n\t\t\t\t\t\tnew_row.serial_no = batch_serial_map[batch].join(`\\n`);\n\t\t\t\t\t\tnew_row.qty = batch_serial_map[batch].length;\n\t\t\t\t\t\tthis.frm.doc.items.forEach(row => {\n\t\t\t\t\t\t\tif (item.item_code === row.item_code) {\n\t\t\t\t\t\t\t\tthis.update_cart_html(row);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tremove_item_from_cart: () => this.remove_item_from_cart(),\n\t\t\t\tget_item_stock_map: () => this.item_stock_map,\n\t\t\t\tclose_item_details: () => {\n\t\t\t\t\tselected_item = null\n\t\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\t\tthis.cart.prev_action = null;\n\t\t\t\t\tthis.cart.toggle_item_highlight();\n\t\t\t\t},\n\t\t\t\tget_available_stock: (item_code, warehouse) => this.get_available_stock(item_code, warehouse)\n\t\t\t}\n\t\t});\n\t\tif(selected_item){\n\t\t\tthis.item_details.toggle_item_details_section(selected_item);\n\t\t}\n\t}\n\n\tinit_payments() {\n\t\tthis.payment = new posnext.PointOfSale.Payment({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm || {},\n\n\t\t\t\tget_customer_details: () => this.customer_details || {},\n\n\t\t\t\ttoggle_other_sections: (show) => {\n\t\t\t\t\tif (show) {\n\t\t\t\t\t\tthis.item_details.$component.is(':visible') ? this.item_details.$component.css('display', 'none') : '';\n\t\t\t\t\t\tthis.item_selector.toggle_component(false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.item_selector.toggle_component(true);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tsubmit_invoice: () => {\n\t\t\t\t\tthis.frm.savesubmit()\n\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\tthis.toggle_components(false);\n\t\t\t\t\t\t\tthis.order_summary.toggle_component(true);\n\t\t\t\t\t\t\tthis.order_summary.load_summary_of(this.frm.doc, true);\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\t\t\tmessage: __('POS invoice {0} created succesfully', [r.doc.name])\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tinit_recent_order_list() {\n\t\tthis.recent_order_list = new posnext.PointOfSale.PastOrderList({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\topen_invoice_data: (name) => {\n\t\t\t\t\tfrappe.db.get_doc('Sales Invoice', name).then((doc) => {\n\t\t\t\t\t\tthis.order_summary.load_summary_of(doc);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\treset_summary: () => this.order_summary.toggle_summary_placeholder(true),\n\t\t\t\tprevious_screen: () => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tthis.cart.load_invoice()\n\t\t\t\t\tthis.item_selector.toggle_component(true)\n\t\t\t\t\tthis.wrapper.find('.past-order-summary').css(\"display\",\"none\");\n\t\t\t\t},\n\n\t\t\t},\n\t\t\tsettings: this.settings,\n\t\t})\n\t}\n\n\tinit_order_summary() {\n\t\tthis.order_summary = new posnext.PointOfSale.PastOrderSummary({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tpos_profile: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\tprocess_return: (name) => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.db.get_doc('Sales Invoice', name).then((doc) => {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => this.make_return_invoice(doc),\n\t\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t\t() => this.item_selector.toggle_component(true)\n\t\t\t\t\t\t]);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tedit_order: (name) => {\n\t\t\t\t\tconsole.log(\"Edit Order...\")\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => this.frm.refresh(name),\n\t\t\t\t\t\t() => this.frm.call('reset_mode_of_payments'),\n\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true)\n\t\t\t\t\t]);\n\t\t\t\t},\n\t\t\t\tdelete_order: (name) => {\n\t\t\t\t\tfrappe.model.delete_doc(this.frm.doc.doctype, name, () => {\n\t\t\t\t\t\tthis.recent_order_list.refresh_list();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tnew_order: () => {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\ttoggle_recent_order_list(show) {\n\t\tthis.toggle_components(!show);\n\t\tthis.recent_order_list.toggle_component(show);\n\t\tthis.order_summary.toggle_component(show);\n\t}\n\n\ttoggle_components(show) {\n\t\tthis.cart.toggle_component(show);\n\t\tthis.item_selector.toggle_component(show);\n\n\t\t// do not show item details or payment if recent order is toggled off\n\t\t!show ? (this.item_details.toggle_component(false) || this.payment.toggle_component(false)) : '';\n\t}\n\n\tmake_new_invoice(from_held=false) {\n\t\tif(from_held){\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t() => this.make_sales_invoice_frm(),\n\t\t\t\t() => this.set_pos_profile_data(),\n\t\t\t\t() => this.set_pos_profile_status(),\n\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t() => this.toggle_recent_order(),\n\t\t\t]);\n\t\t} else {\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t() => this.make_sales_invoice_frm(),\n\t\t\t\t() => this.set_pos_profile_data(),\n\t\t\t\t() => this.set_pos_profile_status(),\n\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t]);\n\t\t}\n\n\t}\n\n\tmake_sales_invoice_frm() {\n\t\tconst doctype = 'Sales Invoice';\n\t\treturn new Promise(resolve => {\n\t\t\tif (this.frm) {\n\t\t\t\tthis.frm = this.get_new_frm(this.frm);\n\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\tthis.frm.doc.is_pos = 1\n\t\t\t\tthis.frm.doc.set_warehouse = this.settings.warehouse\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\t\tthis.frm = this.get_new_frm();\n\t\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\t\tthis.frm.doc.is_pos = 1\n\t\t\t\t\tthis.frm.doc.set_warehouse = this.settings.warehouse\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget_new_frm(_frm) {\n\t\tconst doctype = 'Sales Invoice';\n\t\tconst page = $('<div>');\n\t\tconst frm = _frm || new frappe.ui.form.Form(doctype, page, false);\n\t\tconst name = frappe.model.make_new_doc_and_get_name(doctype, true);\n\t\tfrm.refresh(name);\n\n\t\treturn frm;\n\t}\n\n\tasync make_return_invoice(doc) {\n\t\tfrappe.dom.freeze();\n\t\tthis.frm = this.get_new_frm(this.frm);\n\t\tthis.frm.doc.items = [];\n\t\treturn frappe.call({\n\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.make_sales_return\",\n\t\t\targs: {\n\t\t\t\t'source_name': doc.name,\n\t\t\t\t'target_doc': this.frm.doc\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\t// console.log(r.message)\n\t\t\t\tfrappe.model.sync(r.message);\n\t\t\t\tfrappe.get_doc(r.message.doctype, r.message.name).__run_link_triggers = false;\n\t\t\t\tthis.set_pos_profile_data().then(() => {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tset_pos_profile_data() {\n\t\tif (this.company && !this.frm.doc.company) this.frm.doc.company = this.company;\n\t\tif ((this.pos_profile && !this.frm.doc.pos_profile) | (this.frm.doc.is_return && this.pos_profile != this.frm.doc.pos_profile)) {\n\t\t\tthis.frm.doc.pos_profile = this.pos_profile;\n\t\t}\n\n\t\tif (!this.frm.doc.company) return;\n\n\t\treturn this.frm.trigger(\"set_pos_data\");\n\t}\n\n\tset_pos_profile_status() {\n\t\tthis.page.set_indicator(this.pos_profile, \"blue\");\n\t}\n\n\tasync on_cart_update(args) {\n\t\t// frappe.dom.freeze();\n\t\tlet item_row = undefined;\n\t\ttry {\n\t\t\tlet { field, value, item } = args;\n\t\t\titem_row = this.get_item_from_frm(item);\n\t\t\tconst item_row_exists = !$.isEmptyObject(item_row);\n\n\t\t\tconst from_selector = field === 'qty' && value === \"+1\";\n\t\t\tif (from_selector)\n\t\t\t\tvalue = flt(item_row.stock_qty) + flt(value);\n\n\t\t\tif (item_row_exists) {\n\t\t\t\tif (field === 'qty')\n\t\t\t\t\tvalue = flt(value);\n\n\t\t\t\tif (['qty', 'conversion_factor'].includes(field) && value > 0 && !this.allow_negative_stock) {\n\t\t\t\t\tconst qty_needed = field === 'qty' ? value * item_row.conversion_factor : item_row.qty * value;\n\t\t\t\t\t// await this.check_stock_availability(item_row, qty_needed, this.frm.doc.set_warehouse);\n\t\t\t\t}\n\n\t\t\t\tif (this.is_current_item_being_edited(item_row) || from_selector) {\n\t\t\t\t\tawait frappe.model.set_value(item_row.doctype, item_row.name, field, value)\n\t\t\t\t\t// this.update_cart_html(item_row);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif (!this.frm.doc.customer && !this.settings.custom_mobile_number_based_customer){\n\t\t\t\t\treturn this.raise_customer_selection_alert();\n\t\t\t\t}\n\t\t\t\tfrappe.flags.ignore_company_party_validation = true\n\t\t\t\tconst { item_code, batch_no, serial_no, rate, uom, valuation_rate, custom_item_uoms, custom_logical_rack } = item;\n\t\t\t\tif (!item_code)\n\t\t\t\t\treturn;\n\n\t\t\t\tconst new_item = { item_code, batch_no, rate, uom, [field]: value };\n\t\t\t\tif(value){\n\t\t\t\t\tnew_item['qty'] = value\n\t\t\t\t}\n\t\t\t\tif (serial_no) {\n\t\t\t\t\tawait this.check_serial_no_availablilty(item_code, this.frm.doc.set_warehouse, serial_no);\n\t\t\t\t\tnew_item['serial_no'] = serial_no;\n\t\t\t\t}\n\n\t\t\t\tif (field === 'serial_no')\n\t\t\t\t\tnew_item['qty'] = value.split(`\\n`).length || 0;\n\t\t\t\titem_row = this.frm.add_child('items', new_item);\n\n\t\t\t\t// if (field === 'qty' && value !== 0 && !this.allow_negative_stock) {\n\t\t\t\t\t// const qty_needed = value * item_row.conversion_factor;\n\t\t\t\t\t// await this.check_stock_availability(item_row, qty_needed, this.frm.doc.set_warehouse);\n\t\t\t\t// }\n\n\t\t\t\tawait this.trigger_new_item_events(item_row);\n\t\t\t\titem_row['rate'] = rate\n\t\t\t\titem_row['valuation_rate'] = valuation_rate;\n\t\t\t\titem_row['custom_valuation_rate'] = valuation_rate;\n\t\t\t\titem_row['custom_item_uoms'] = custom_item_uoms;\n\t\t\t\titem_row['custom_logical_rack'] = custom_logical_rack;\n\t\t\t\t// this.update_cart_html(item_row);\n\t\t\t\tif (this.item_details.$component.is(':visible'))\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\n\t\t\t\tif (this.check_serial_batch_selection_needed(item_row) && !this.item_details.$component.is(':visible'))\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\t\t\t}\n\t\t\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t} finally {\n\t\t\t// frappe.dom.unfreeze();\n\n\t\t\tvar total_incoming_rate = 0\n\t\t\tthis.frm.doc.items.forEach(item => {\n\t\t\t\ttotal_incoming_rate += (parseFloat(item.valuation_rate) * item.qty)\n\t\t\t});\n\t\t\tthis.item_selector.update_total_incoming_rate(total_incoming_rate)\n\n\t\t\treturn item_row; // eslint-disable-line no-unsafe-finally\n\t\t}\n\t}\n\n\traise_customer_selection_alert() {\n\t\tfrappe.dom.unfreeze();\n\t\tfrappe.show_alert({\n\t\t\tmessage: __('You must select a customer before adding an item.'),\n\t\t\tindicator: 'orange'\n\t\t});\n\t\tfrappe.utils.play_sound(\"error\");\n\t}\n\n\tget_item_from_frm({ name, item_code, batch_no, uom, rate }) {\n\t\tlet item_row = null;\n\n\t\tif (name) {\n\t\t\titem_row = this.frm.doc.items.find(i => i.name == name);\n\t\t} else {\n\t\t\t// if item is clicked twice from item selector\n\t\t\t// then \"item_code, batch_no, uom, rate\" will help in getting the exact item\n\t\t\t// to increase the qty by one\n\t\t\tconst has_batch_no = (batch_no !== 'null' && batch_no !== null);\n\t\t\tconst batch_no_check = this.settings.custom_allow_add_new_items_on_new_line ? (has_batch_no && cur_frm.doc.items[i].batch_no === batch_no) : true\n\t\t\tfor(var i=0;i<cur_frm.doc.items.length;i+=1){\n\t\t\t\tif(cur_frm.doc.items[i].item_code === item_code && cur_frm.doc.items[i].uom === uom && parseFloat(cur_frm.doc.items[i].rate) === parseFloat(rate)){\n\t\t\t\t\titem_row = cur_frm.doc.items[i]\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(item_row)\n\t\t}\n\t\treturn item_row || {};\n\t}\n\n\tedit_item_details_of(item_row) {\n\t\tthis.item_details.toggle_item_details_section(item_row);\n\t}\n\n\tis_current_item_being_edited(item_row) {\n\t\treturn item_row.name == this.item_details.current_item.name;\n\t}\n\n\tupdate_cart_html(item_row, remove_item) {\n\t\tthis.cart.update_item_html(item_row, remove_item);\n\n\t\tthis.cart.update_totals_section(this.frm);\n\n\t}\n\n\tcheck_serial_batch_selection_needed(item_row) {\n\t\t// right now item details is shown for every type of item.\n\t\t// if item details is not shown for every item then this fn will be needed\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_serial_selected = !item_row.serial_no;\n\t\tconst no_batch_selected = !item_row.batch_no;\n\n\t\tif ((serialized && no_serial_selected) || (batched && no_batch_selected) ||\n\t\t\t(serialized && batched && (no_batch_selected || no_serial_selected))) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tasync trigger_new_item_events(item_row) {\n\t\tawait this.frm.script_manager.trigger('item_code', item_row.doctype, item_row.name);\n\t\tawait this.frm.script_manager.trigger('qty', item_row.doctype, item_row.name);\n\t\tawait this.frm.script_manager.trigger('discount_percentage', item_row.doctype, item_row.name);\n\t}\n\n\tasync check_stock_availability(item_row, qty_needed, warehouse) {\n\t\tconst resp = (await this.get_available_stock(item_row.item_code, warehouse)).message;\n\t\tconst available_qty = resp[0];\n\t\tconst is_stock_item = resp[1];\n\n\t\tfrappe.dom.unfreeze();\n\t\tconst bold_uom = item_row.uom.bold();\n\t\tconst bold_item_code = item_row.item_code.bold();\n\t\tconst bold_warehouse = warehouse.bold();\n\t\tconst bold_available_qty = available_qty.toString().bold()\n\t\tif (!(available_qty > 0)) {\n\t\t\tif (is_stock_item) {\n\t\t\t\tfrappe.model.clear_doc(item_row.doctype, item_row.name);\n\t\t\t\tfrappe.throw({\n\t\t\t\t\ttitle: __(\"Not Available\"),\n\t\t\t\t\tmessage: __('Item Code: {0} is not available under warehouse {1}.', [bold_item_code, bold_warehouse])\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else if (is_stock_item && available_qty < qty_needed) {\n\t\t\tfrappe.throw({\n\t\t\t\tmessage: __('Stock quantity not enough for Item Code: {0} under warehouse {1}. Available quantity {2} {3}.', [bold_item_code, bold_warehouse, bold_available_qty, bold_uom]),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t}\n\t\tfrappe.dom.freeze();\n\t}\n\n\tasync check_serial_no_availablilty(item_code, warehouse, serial_no) {\n\t\tconst method = \"erpnext.stock.doctype.serial_no.serial_no.get_pos_reserved_serial_nos\";\n\t\tconst args = {filters: { item_code, warehouse }}\n\t\tconst res = await frappe.call({ method, args });\n\n\t\tif (res.message.includes(serial_no)) {\n\t\t\tfrappe.throw({\n\t\t\t\ttitle: __(\"Not Available\"),\n\t\t\t\tmessage: __('Serial No: {0} has already been transacted into another Sales Invoice.', [serial_no.bold()])\n\t\t\t});\n\t\t}\n\t}\n\n\tget_available_stock(item_code, warehouse) {\n\t\tconst me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pos_invoice.pos_invoice.get_stock_availability\",\n\t\t\targs: {\n\t\t\t\t'item_code': item_code,\n\t\t\t\t'warehouse': warehouse,\n\t\t\t},\n\t\t\tcallback(res) {\n\t\t\t\tif (!me.item_stock_map[item_code])\n\t\t\t\t\tme.item_stock_map[item_code] = {};\n\t\t\t\tme.item_stock_map[item_code][warehouse] = res.message;\n\t\t\t}\n\t\t});\n\t}\n\n\tupdate_item_field(value, field_or_action) {\n\t\tif (field_or_action === 'checkout') {\n\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t} else if (field_or_action === 'remove') {\n\t\t\tthis.remove_item_from_cart();\n\t\t} else {\n\t\t\tconst field_control = this.item_details[`${field_or_action}_control`];\n\t\t\tif (!field_control) return;\n\t\t\tfield_control.set_focus();\n\t\t\tvalue != \"\" && field_control.set_value(value);\n\t\t}\n\t}\n\n\tremove_item_from_cart() {\n\t\tfrappe.dom.freeze();\n\t\tconst { doctype, name, current_item } = this.item_details;\n\t\treturn frappe.model.set_value(doctype, name, 'qty', 0)\n\t\t\t.then(() => {\n\t\t\t\tfrappe.model.clear_doc(doctype, name);\n\t\t\t\tthis.update_cart_html(current_item, true);\n\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\tfrappe.dom.unfreeze();\n\n\t\t\t\tvar total_incoming_rate = 0\n\t\t\t\tthis.frm.doc.items.forEach(item => {\n\t\t\t\t\ttotal_incoming_rate += (parseFloat(item.valuation_rate) * item.qty)\n\t\t\t\t});\n\t\t\t\tthis.item_selector.update_total_incoming_rate(total_incoming_rate)\n\t\t\t})\n\t\t\t.catch(e => console.log(e));\n\t}\n\n\tasync save_and_checkout() {\n\t\tif (this.frm.is_dirty()) {\n\t\t\tconst div = document.getElementById(\"customer-cart-container2\");\n\t\t\tdiv.style.gridColumn = \"\";\n\t\t\tlet save_error = false;\n\t\t\tawait this.frm.save(null, null, null, () => save_error = true);\n\t\t\t// only move to payment section if save is successful\n\t\t\t!save_error && this.payment.checkout();\n\t\t\t// show checkout button on error\n\t\t\tsave_error && setTimeout(() => {\n\t\t\t\tthis.cart.toggle_checkout_btn(true);\n\t\t\t}, 300); // wait for save to finish\n\t\t} else {\n\t\t\tthis.payment.checkout();\n\t\t}\n\t}\n};\n", "frappe.provide('posnext.PointOfSale');\nvar view = \"List\"\n\nposnext.PointOfSale.ItemSelector = class {\n\t// eslint-disable-next-line no-unused-vars\n\tconstructor({ frm, wrapper, events, pos_profile, settings,currency,init_item_cart,reload_status }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.currency = currency;\n\t\tthis.pos_profile = pos_profile;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.reload_status = reload_status\n\t\tthis.auto_add_item = settings.auto_add_item_to_cart;\n\t\tif(settings.custom_default_view){\n\t\t\tview = settings.custom_default_view\n\t\t}\n\t\tif(settings.custom_show_only_list_view){\n\t\t\tview = \"List\"\n\t\t}\n\t\tif(settings.custom_show_only_card_view){\n\t\t\tview = \"Card\"\n\t\t}\n\t\tthis.custom_show_item_code = settings.custom_show_item_code\n\t\tthis.custom_show_last_incoming_rate = settings.custom_show_last_incoming_rate\n\t\tthis.custom_show_oem_part_number = settings.custom_show_oem_part_number\n\t\tthis.custom_show_posting_date = settings.custom_show_posting_date\n\t\tthis.custom_show_logical_rack = settings.custom_show_logical_rack\n\t\tthis.show_only_list_view = settings.custom_show_only_list_view\n\t\tthis.show_only_card_view = settings.custom_show_only_card_view\n\t\tthis.custom_edit_rate = settings.custom_edit_rate_and_uom\n\t\tthis.custom_show_incoming_rate = settings.custom_show_incoming_rate && settings.custom_edit_rate_and_uom;\n\t\t// this.custom_edit_uom = settings.custom_edit_uom\n\t\tthis.inti_component();\n\t}\n\n\tinti_component() {\n\n\t\tthis.prepare_dom();\n\t\tthis.make_search_bar();\n\t\tthis.load_items_data();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tvar cardlist = ``\n\t\tif(!this.show_only_list_view && !this.show_only_card_view){\n\t\t\tcardlist = `<div class=\"list-view\"><a class=\"list-span\">List</a></div>\n\t\t\t<div class=\"card-view\"><a class=\"card-span\">Card</a></div>`\n\t\t}\n\n\t\tif(view === \"Card\" && !this.show_only_list_view){\n\t\t\tvar tir = ``\n\t\t\tif(this.custom_show_last_incoming_rate || this.custom_show_incoming_rate){\n\t\t\t\ttir = `<div class=\"total-incoming-rate\" style=\"margin-left: 10px;grid-column: span 2 / span 2\"></div>`\n\t\t\t}\n\t\t\tthis.wrapper.append(\n\t\t\t\t`<div class=\"items-container\">\n\t\t\t\t\t<section class=\"items-selector\" id=\"card-view-section\">\n\t\t\t\t\t\t<div class=\"filter-section\">` + cardlist + `\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class=\"pos-profile\" style=\"grid-column: span 2 / span 2\"></div>\n\t\t\t\t\t\t\t<div class=\"search-field\" style=\"grid-column: span 4 / span 4\"></div>\n\t\t\t\t\t\t\t<!--<div class=\"item-code-search-field\" style=\"grid-column: span 2 / span 2\"></div>-->\n\t\t\t\t\t\t\t<div class=\"item-group-field\" style=\"grid-column: span 2 / span 2\"></div>\n\t\t\t\t\t\t\t<div class=\"invoice-posting-date\" style=\"grid-column: span 2 / span 2\"></div>\n\t\t\t\t\t\t\t` + tir + `\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"items-container\"></div>\n\t\t\t\t\t</section>\n\t\t\t\t</div>`\n\t\t\t);\n\n\t\t\tthis.$component = this.wrapper.find('.items-selector');\n\t\t\tthis.$items_container = this.$component.find('.items-container');\n\t\t} else if(view === \"List\" && !this.show_only_card_view) {\n            var section = `<section class=\"customer-cart-container items-selector\" id=\"list-view-section\" style=\"grid-column: span 6 / span 6;overflow-y:hidden\">`\n\t\t\tvar tir = ``\n\t\t\tif(this.custom_edit_rate){\n\t\t\t    section = `<section class=\"customer-cart-container items-selector\" id=\"list-view-section\" style=\"grid-column: span 5 / span 5;overflow-y:hidden\">`\n\t\t\t}\n\t\t\tif(this.custom_show_last_incoming_rate || this.custom_show_incoming_rate){\n\t\t\t\ttir = `<div class=\"total-incoming-rate\" style=\"margin-left: 10px;grid-column: span 2 / span 2\"></div>`\n\t\t\t}\n\n\n\t\t\tthis.wrapper.append(\n\t\t\t\tsection + `<div class=\"filter-section\">` + cardlist + `<div class=\"pos-profile\" style=\"grid-column: span 2 / span 2\"></div>\n\t\t\t\t\t\t<div class=\"search-field\" style=\"grid-column: span 4 / span 4\"></div>\n\t\t\t\t\t\t<!--<div class=\"item-code-search-field\" style=\"grid-column: span 2 / span 2\"></div>-->\n\t\t\t\t\t\t<div class=\"item-group-field\" style=\"grid-column: span 2 / span 2\"></div>\n\t\t\t\t\t\t<div class=\"invoice-posting-date\" style=\"margin-left: 10px;grid-column: span 2 / span 2\"></div>` + tir + `\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"cart-container\" ></div>\n\t\t\t\t</section>`\n\t\t\t);\n\n\t\t\tthis.$component = this.wrapper.find('.customer-cart-container');\n\t\t\tthis.$items_container = this.$component.find('.cart-container');\n\t\t}\n        if(!this.show_only_list_view && !this.show_only_card_view) {\n            this.$list_view = this.$component.find('.list-view');\n            this.$card_view = this.$component.find('.card-view');\n            if (view === \"List\" && !this.show_only_list_view) {\n                this.$list_view.find('.list-span').css({\n                    \"display\": \"inline-block\",\n                    \"background-color\": \"#3498db\",\n                    \"color\": \"white\",\n                    \"padding\": \"5px 10px\",\n                    \"border-radius\": \"20px\",\n                    \"font-size\": \"14px\",\n                    \"font-weight\": \"bold\",\n                    \"text-transform\": \"uppercase\",\n                    \"letter-spacing\": \"1px\",\n                    \"cursor\": \"pointer\",\n                    \"transition\": \"background-color 0.3s ease\"\n                });\n                this.$card_view.find('.card-span').css({\n                    \"display\": \"\",\n                    \"background-color\": \"\",\n                    \"color\": \"\",\n                    \"padding\": \"\",\n                    \"border-radius\": \"\",\n                    \"font-size\": \"\",\n                    \"font-weight\": \"\",\n                    \"text-transform\": \"\",\n                    \"letter-spacing\": \"\",\n                    \"cursor\": \"\",\n                    \"transition\": \"\"\n                });\n            } else if (view === \"Card\" && !this.show_only_card_view) {\n                this.$card_view.find('.card-span').css({\n                    \"display\": \"inline-block\",\n                    \"background-color\": \"#3498db\",\n                    \"color\": \"white\",\n                    \"padding\": \"5px 10px\",\n                    \"border-radius\": \"20px\",\n                    \"font-size\": \"14px\",\n                    \"font-weight\": \"bold\",\n                    \"text-transform\": \"uppercase\",\n                    \"letter-spacing\": \"1px\",\n                    \"cursor\": \"pointer\",\n                    \"transition\": \"background-color 0.3s ease\"\n                });\n                this.$list_view.find('.list-span').css({\n                    \"display\": \"\",\n                    \"background-color\": \"\",\n                    \"color\": \"\",\n                    \"padding\": \"\",\n                    \"border-radius\": \"\",\n                    \"font-size\": \"\",\n                    \"font-weight\": \"\",\n                    \"text-transform\": \"\",\n                    \"letter-spacing\": \"\",\n                    \"cursor\": \"\",\n                    \"transition\": \"\"\n                });\n            } else {\n                this.$list_view.find('.list-span').css({\"display\": \"none\"});\n                this.$card_view.find('.card-span').css({\"display\": \"none\"});\n\n            }\n            if (!this.show_only_card_view && !this.show_only_list_view) {\n                this.click_functions()\n            }\n        }\n\t}\n\tclick_functions(){\n\t\tthis.$list_view.on('click', 'a', () => {\n\n\t\t\tthis.$list_view.find('.list-span').css({\"display\": \"inline-block\",\"background-color\": \"#3498db\",\"color\": \"white\",\"padding\": \"5px 10px\", \"border-radius\": \"20px\", \"font-size\": \"14px\",\"font-weight\": \"bold\", \"text-transform\": \"uppercase\",\"letter-spacing\": \"1px\",\"cursor\": \"pointer\", \"transition\": \"background-color 0.3s ease\"});\n\t\t\tthis.$card_view.find('.card-span').css({\"display\": \"\",\"background-color\": \"\",\"color\": \"\",\"padding\": \"\", \"border-radius\": \"\", \"font-size\": \"\",\"font-weight\": \"\", \"text-transform\": \"\",\"letter-spacing\": \"\",\"cursor\": \"\", \"transition\": \"\"});\n\t\t\tview = \"List\"\n\t\t\tif(document.getElementById(\"card-view-section\")) document.getElementById(\"card-view-section\").remove()\n\t\t\tif(document.getElementById(\"list-view-section\")) document.getElementById(\"list-view-section\").remove()\n\t\t\tif(document.getElementById(\"customer-cart-container2\")) document.getElementById(\"customer-cart-container2\").remove()\n\t\t\tif(document.getElementById(\"item-details-container\")) document.getElementById(\"item-details-container\").remove()\n\n\t\t\tthis.inti_component()\n\t\t\tthis.events.init_item_details()\n\t\t\tthis.events.init_item_cart()\n\t\t\tthis.events.change_items(this.events.get_frm())\n\n\n\t\t});\n\t\tthis.$card_view.on('click', 'a', () => {\n\t\t\tthis.$card_view.find('.card-span').css({\"display\": \"inline-block\",\"background-color\": \"#3498db\",\"color\": \"white\",\"padding\": \"5px 10px\", \"border-radius\": \"20px\", \"font-size\": \"14px\",\"font-weight\": \"bold\", \"text-transform\": \"uppercase\",\"letter-spacing\": \"1px\",\"cursor\": \"pointer\", \"transition\": \"background-color 0.3s ease\"});\n\t\t\tthis.$list_view.find('.list-span').css({\"display\": \"\",\"background-color\": \"\",\"color\": \"\",\"padding\": \"\", \"border-radius\": \"\", \"font-size\": \"\",\"font-weight\": \"\", \"text-transform\": \"\",\"letter-spacing\": \"\",\"cursor\": \"\", \"transition\": \"\"});\n\t\t\tview = \"Card\"\n\t\t\tif(document.getElementById(\"card-view-section\")) document.getElementById(\"card-view-section\").remove()\n\t\t\tif(document.getElementById(\"list-view-section\")) document.getElementById(\"list-view-section\").remove()\n\t\t\tif(document.getElementById(\"customer-cart-container2\")) document.getElementById(\"customer-cart-container2\").remove()\n\t\t\tif(document.getElementById(\"item-details-container\")) document.getElementById(\"item-details-container\").remove()\n\n\t\t\tthis.inti_component()\n\t\t\tthis.events.init_item_details()\n\t\t\tthis.events.init_item_cart()\n\t\t\tthis.events.change_items(this.events.get_frm())\n\n\t\t});\n\t}\n\tasync load_items_data() {\n\t\tif (!this.item_group) {\n\t\t\tconst res = await frappe.db.get_value(\"Item Group\", {lft: 1, is_group: 1}, \"name\");\n\t\t\tthis.parent_item_group = res.message.name;\n\t\t}\n\t\tif (!this.price_list) {\n\t\t\tconst res = await frappe.db.get_value(\"POS Profile\", this.pos_profile, \"selling_price_list\");\n\t\t\tthis.price_list = res.message.selling_price_list;\n\t\t}\n\n\t\tthis.get_items({}).then(({message}) => {\n\t\t\tthis.render_item_list(message.items);\n\t\t});\n\t}\n\n\tget_items({start = 0, page_length = 40, search_term=''}) {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst price_list = (doc && doc.selling_price_list) || this.price_list;\n\t\tlet { item_group, pos_profile } = this;\n\n\t\t!item_group && (item_group = this.parent_item_group);\n\n\t\treturn frappe.call({\n\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.get_items\",\n\t\t\tfreeze: true,\n\t\t\targs: { start, page_length, price_list, item_group, search_term, pos_profile },\n\t\t});\n\t}\n\n\n\trender_item_list(items) {\n\t\tthis.$items_container.html('');\n\t\tvar me = this\n\t\tif(view === \"List\"){\n\t\t\tthis.$items_container.append(\n\t\t\t\t`<div class=\"abs-cart-container\" style=\"overflow-y:hidden\">\n\t\t\t\t\t<div class=\"cart-header\">\n\t\t\t\t\t${get_item_code_header()}\n\t\t\t\t\t\t<div style=\"flex: 1\">${__('Rate')}</div>\n\t\t\t\t\t\t<div style=\"flex: 1\">${__('Avail. Qty')}</div>\n\t\t\t\t\t\t<!--<div class=\"qty-header\">${__('UOM')}</div>-->\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"cart-items-section\" style=\"overflow-y:scroll;font-size: 12px\"></div>\n\t\t\t\t</div>`)\n\n\t\t\tfunction get_item_code_header() {\n\t\t\t\tvar flex_value = 3\n\t\t\t\t if(!me.custom_show_item_code && !me.custom_show_last_incoming_rate && !me.custom_show_oem_part_number && !me.custom_show_logical_rack){\n\t\t\t\t\tflex_value = 2\n\t\t\t\t}\n\t\t\t\tvar html_header = ``\n\t\t\t\tif(me.custom_show_item_code){\n\t\t\t\t\t// flex_value -= 1\n\t\t\t\t\thtml_header += `<div style=\"flex: 1\">${__('Item Code')}</div>`\n\t\t\t\t}\n\t\t\t\tif(me.custom_show_last_incoming_rate){\n\t\t\t\t\t// flex_value -= 1\n\t\t\t\t\thtml_header += `<div style=\"flex: 1\">${__('Inc.Rate')}</div>`\n\t\t\t\t}\n\t\t\t\tif(me.custom_show_oem_part_number){\n\t\t\t\t\t// flex_value -= 1\n\t\t\t\t\thtml_header += `<div style=\"flex: 1\">${__('OEM')} <br> ${__('Part No.')}</div>`\n\t\t\t\t}\n\t\t\t\tif(me.custom_show_logical_rack){\n\t\t\t\t\t// flex_value -= 1\n\t\t\t\t\thtml_header += `<div style=\"flex: 1\">${__('Rack')}</div>`\n\t\t\t\t}\n\t\t\t\tif(flex_value > 0){\n\t\t\t\t\treturn `<div style=\"flex: ` + flex_value + `\">${__('Item')}</div>` + html_header\n\t\t\t\t} else {\n\t\t\t\t\treturn `<div>${__('Item')}</div>` + html_header\n\t\t\t\t}\n\n\n            }\n\t\t\tthis.make_cart_items_section();\n\n\t\t\titems.forEach(item => {\n\t\t\t\tthis.render_cart_item(item);\n\t\t\t});\n\t\t} else {\n\t\t\titems.forEach(item => {\n                var item_html = this.get_item_html(item);\n                this.$items_container.append(item_html);\n        \t})\n\t\t}\n\n\t\t// this.$cart_container = this.$component.find('.cart-container');\n\n\n\t}\n\tmake_cart_items_section() {\n\t\tthis.$cart_header = this.$component.find('.cart-header');\n\t\tthis.$cart_items_wrapper = this.$component.find('.cart-items-section');\n\n\t}\n\tget_cart_item({ name }) {\n\t\tconst item_selector = `.cart-item-wrapper[data-row-name=\"${escape(name)}\"]`;\n\t\treturn this.$cart_items_wrapper.find(item_selector);\n\t}\n\tget_cart_item1({ item_code }) {\n\t\tconst item_selector = `.cart-item-wrapper[data-row-name=\"${escape(item_code)}\"]`;\n\t\treturn this.$cart_items_wrapper.find(item_selector);\n\t}\n\trender_cart_item(item_data) {\n\t\tconsole.log(\"Rener cart item\")\n\t\tconsole.log(item_data)\n\t\tconst me = this;\n\t\tconst currency = me.events.get_frm().currency || me.currency;\n\t\tthis.$cart_items_wrapper.append(\n\t\t\t`<div class=\"cart-item-wrapper item-wrapper\" \n\t\t\tdata-item-code=\"${escape(item_data.item_code)}\" \n\t\t\tdata-serial-no=\"${escape(item_data.serial_no)}\"\n\t\t\tdata-batch-no=\"${escape(item_data.batch_no)}\" \n\t\t\tdata-uom=\"${escape(item_data.uom)}\"\n\t\t\tdata-rate=\"${escape(item_data.price_list_rate || 0)}\"\n\t\t\tdata-valuation-rate=\"${escape(item_data.valuation_rate || item_data.custom_valuation_rate)}\"\n\t\t\tdata-item-uoms=\"${item_data.custom_item_uoms}\"\n\t\t\tdata-item-logical-rack=\"${item_data.custom_logical_rack}\"\n\t\t\ttitle=\"${item_data.item_name}\"\n\t\t\tdata-row-name=\"${escape(item_data.item_code)}\"></div>\n\t\t\t<div class=\"seperator\"></div>`\n\t\t)\n\t\tvar $item_to_update = this.get_cart_item1(item_data);\n\n\t\t$item_to_update.html(\n\t\t\t`${get_item_image_html()}\n\t\t\t${get_item_name()}\n\t\t\t\n\t\t\t\t<div style=\"overflow-wrap: break-word;overflow:hidden;white-space: normal;font-weight: 700;margin-right: 10px\">\n\t\t\t\t\t${item_data.item_name}\n\t\t\t\t</div>\n\t\t\t\t${get_description_html()}\n\t\t\t</div>\n\t\t\t${get_item_code()}\n\t\t\t${get_rate_discount_html()}`\n\t\t)\n\n\t\tfunction get_item_name() {\n\t\t\tvar flex_value = 4\n            if(me.custom_show_item_code && me.custom_show_last_incoming_rate && me.custom_show_oem_part_number){\n\t\t\t\tflex_value = 3\n            }\n            // if(me.custom_show_item_code && me.custom_show_last_incoming_rate && !me.custom_show_oem_part_number){\n\t\t\t\t// flex_value = 3\n            // }\n            if(!me.custom_show_item_code && !me.custom_show_last_incoming_rate && !me.custom_show_oem_part_number && !me.custom_show_logical_rack){\n\t\t\t\tflex_value = 2\n            }\n            // if(me.custom_show_last_incoming_rate && me.custom_show_item_code){\n\t\t\t\t// flex_value -= 1\n            // }\n            // if(me.custom_show_oem_part_number){\n\t\t\t\t// flex_value -= 1\n            // }\n\t\t\treturn `<div class=\"\" style=\"flex: ` + flex_value +`;overflow-wrap: break-word;overflow:hidden;white-space: normal\">`\n        }\n\t\tset_dynamic_rate_header_width();\n\n\t\tfunction set_dynamic_rate_header_width() {\n\t\t\tconst rate_cols = Array.from(me.$cart_items_wrapper.find(\".item-rate-amount\"));\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", \"\");\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", \"\");\n\t\t\tvar max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\t\tif ($(elm).width() > max_width)\n\t\t\t\t\tmax_width = $(elm).width();\n\t\t\t\treturn max_width;\n\t\t\t}, 0);\n\n\t\t\tmax_width += 1;\n\t\t\tif (max_width == 1) max_width = \"\";\n\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", max_width);\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", max_width);\n\t\t}\n\t\tfunction get_item_code() {\n\t\t\tvar html_code = ``\n\t\t\tif(me.custom_show_item_code){\n\t\t\t\tvar item_code_flex_value =  1\n\t\t\t\thtml_code += `<div class=\"item-code-desc\" style=\"flex: ` + item_code_flex_value + `;text-align: left\">\n\t\t\t\t\t<div class=\"item-code\" >\n\t\t\t\t\t\t<b>${item_data.item_code}</b> <br>\n\t\t\t\t\t\t${item_data.uom}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t\t}\n\t\t\tif(me.custom_show_last_incoming_rate){\n\t\t\t\thtml_code += `<div class=\"incoming-rate-desc\" style=\"flex: 1;text-align: left\">\n\t\t\t\t\t<div class=\"incoming-rate\" >\n\t\t\t\t\t\t${parseFloat(item_data.valuation_rate).toFixed(2)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n            }\n            if(me.custom_show_oem_part_number){\n\t\t\t\thtml_code += `<div class=\"incoming-rate-desc\" style=\"flex: 1;text-align: left\">\n\t\t\t\t\t<div class=\"incoming-rate\" >\n\t\t\t\t\t\t${item_data.custom_oem_part_number || \"\"}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n            }\n            if(me.custom_show_logical_rack){\n\t\t\t\thtml_code += `<div class=\"incoming-rate-desc\" style=\"flex: 1;text-align: left\">\n\t\t\t\t\t<div class=\"incoming-rate\" >\n\t\t\t\t\t\t${item_data.rack || \"\"}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n            }\n            return html_code\n        }\n\t\tfunction get_rate_discount_html() {\n\t\t\tif (item_data.rate && item_data.amount && item_data.rate !== item_data.amount) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-qty-rate\" style=\"flex: 3\">\n\t\t\t\t\t\t<div class=\"item-rate-amount\" style=\"flex: 1\">\n\t\t\t\t\t\t\t<div class=\"item-rate\" style=\"text-align: left\">${format_currency(item_data.price_list_rate, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-qty\" style=\"flex: 1;display:block;text-align: center\"><span> ${item_data.actual_qty || 0}</span></div>\n\t\t\t\t\t\t\n\t\t\t\t\t</div>`\n\t\t\t} else {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-qty-rate\" style=\"flex: 3\">\n\t\t\t\t\t\t<div class=\"item-rate-amount\" style=\"flex: 1\">\n\t\t\t\t\t\t\t<div class=\"item-rate\" style=\"text-align: left\">${format_currency(item_data.price_list_rate, currency)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-qty\" style=\"flex: 1;display:block;text-align: center\"><span> ${item_data.actual_qty || 0}</span></div>\n\t\t\t\t\t\t\n\t\t\t\t\t</div>`\n\t\t\t}\n\t\t}\n\n\t\tfunction get_description_html() {\n\t\t\tif (item_data.description) {\n\t\t\t\tif (item_data.description.indexOf('<div>') != -1) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\titem_data.description = $(item_data.description).text();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\titem_data.description = item_data.description.replace(/<div>/g, ' ').replace(/<\\/div>/g, ' ').replace(/ +/g, ' ');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\titem_data.description = frappe.ellipsis(item_data.description, 45);\n\t\t\t\treturn `<div class=\"item-desc\">${item_data.description}</div>`;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tconst { image, item_name } = item_data;\n\t\t\tif (!me.hide_images && image) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-image\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tonerror=\"cur_pos.cart.handle_broken_image(this)\"\n\t\t\t\t\t\t\tsrc=\"${image}\" alt=\"${frappe.get_abbr(item_name)}\"\">\n\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-image item-abbr\">${frappe.get_abbr(item_name)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\tget_item_html(item) {\n\t\tconst me = this;\n\t\titem.currency = item.currency  || me.currency\n\t\t// eslint-disable-next-line no-unused-vars\n\t\tconst { item_image, serial_no, batch_no, barcode, actual_qty, uom, price_list_rate } = item;\n\t\tconst precision = flt(price_list_rate, 2) % 1 != 0 ? 2 : 0;\n\t\tlet indicator_color;\n\t\tlet qty_to_display = actual_qty;\n\n\t\tif (item.is_stock_item) {\n\t\t\tindicator_color = (actual_qty > 10 ? \"green\" : actual_qty <= 0 ? \"red\" : \"orange\");\n\n\t\t\tif (Math.round(qty_to_display) > 999) {\n\t\t\t\tqty_to_display = Math.round(qty_to_display)/1000;\n\t\t\t\tqty_to_display = qty_to_display.toFixed(1) + 'K';\n\t\t\t}\n\t\t} else {\n\t\t\tindicator_color = '';\n\t\t\tqty_to_display = '';\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tif (!me.hide_images && item_image) {\n\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\">${qty_to_display}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-center justify-center h-32 border-b-grey text-6xl text-grey-100\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tonerror=\"cur_pos.item_selector.handle_broken_image(this)\"\n\t\t\t\t\t\t\t\tclass=\"h-full item-img\" src=\"${item_image}\"\n\t\t\t\t\t\t\t\talt=\"${frappe.get_abbr(item.item_name)}\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-qty-pill\">\n\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\">${qty_to_display}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"item-display abbr\">${frappe.get_abbr(item.item_name)}</div>`;\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t`<div class=\"item-wrapper\"\n\t\t\t\tdata-item-code=\"${escape(item.item_code)}\" data-serial-no=\"${escape(serial_no)}\"\n\t\t\t\tdata-batch-no=\"${escape(batch_no)}\" data-uom=\"${escape(uom)}\"\n\t\t\t\tdata-rate=\"${escape(price_list_rate || 0)}\"\n\t\t\t\ttitle=\"${item.item_name}\">\n\n\t\t\t\t${get_item_image_html()}\n\n\t\t\t\t<div class=\"item-detail\">\n\t\t\t\t\t<div class=\"item-name\">\n\t\t\t\t\t\t${frappe.ellipsis(item.item_name, 18)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"item-rate\">${format_currency(price_list_rate, item.currency, precision) || 0} / ${uom}</div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).parent().replaceWith(`<div class=\"item-display abbr\">${item_abbr}</div>`);\n\t}\n\tupdate_total_incoming_rate(total_rate){\n\t\tif(this.total_incoming_rate){\n\t\t\tthis.total_incoming_rate.set_value(total_rate)\n\t\t}\n\t}\n\tmake_search_bar() {\n\t\tconst me = this;\n\t\tconst doc = me.events.get_frm().doc;\n\t\tthis.$component.find('.search-field').html('');\n\t\t// this.$component.find('.item-code-search-field').html('');\n\t\tthis.$component.find('.pos-profile').html('');\n\t\tthis.$component.find('.total-incoming-rate').html('');\n\t\tthis.$component.find('.item-group-field').html('');\n\t\tthis.$component.find('.invoice-posting-date').html('');\n\t\tfrappe.db.get_single_value(\"POS Settings\",\"custom_profile_lock\").then(doc => {\n\t\t\tthis.pos_profile_field = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('POS Profile'),\n\t\t\t\t\tfieldtype: 'Link',\n\t\t\t\t\toptions: 'POS Profile',\n\t\t\t\t\tplaceholder: __('POS Profile'),\n\t\t\t\t\tread_only: doc,\n\t\t\t\t\tonchange: function () {\n\n\t\t\t\t\t\tif(me.reload_status && me.pos_profile !== this.value){\n\t\t\t\t\t\t\tfrappe.pages['posnext'].refresh(window.wrapper,window.onScan,this.value)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// console.log(\"ON ON CHANGE\")\n\t\t\t\t\t\t// console.log(this.pos_profile_field)\n\t\t\t\t\t\t// var value = this.pos_profile_field.get_value()\n\t\t\t\t\t\t// if(value !== me.pos_profile){\n\t\t\t\t\t\t// \tthis.events.check_opening_entry()\n\t\t\t\t\t\t// }\n\t\t\t\t\t\t// window.wrapper.please_refresh = true\n\t\t\t\t\t\t// frappe.pages['posnext'].refresh_data(window.wrapper)\n\t\t\t\t\t\t// console.log(\"HEEEERE\")\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tparent: this.$component.find('.pos-profile'),\n\t\t\t\trender_input: false,\n\t\t\t});\n\t\tthis.pos_profile_field.set_value(me.pos_profile)\n\t\tthis.pos_profile_field.refresh()\n\t\tthis.pos_profile_field.toggle_label(false);\n\n\t\t})\n\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Search'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: __('Search by serial number or barcode')\n\t\t\t},\n\t\t\tparent: this.$component.find('.search-field'),\n\t\t\trender_input: true,\n\t\t});\n\n\t\tthis.item_group_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Item Group'),\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\toptions: 'Item Group',\n\t\t\t\tplaceholder: __('Select item group'),\n\t\t\t\tonchange: function() {\n\t\t\t\t\tme.item_group = this.value;\n\t\t\t\t\t!me.item_group && (me.item_group = me.parent_item_group);\n\t\t\t\t\tme.filter_items();\n\t\t\t\t},\n\t\t\t\tget_query: function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tquery: 'posnext.posnext.page.posnext.point_of_sale.item_group_query',\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tpos_profile: doc ? doc.pos_profile : ''\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$component.find('.item-group-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tif(this.custom_show_last_incoming_rate || this.custom_show_incoming_rate) {\n            this.total_incoming_rate = frappe.ui.form.make_control({\n                df: {\n                    label: __(''),\n                    fieldtype: 'Currency',\n                    read_only: 1,\n                    placeholder: __('Total Incoming Rate'),\n                    default: 0\n                },\n                parent: this.$component.find('.total-incoming-rate'),\n                render_input: true,\n            });\n        }\n\t\tif(me.custom_show_posting_date){\n\t\t\tthis.invoice_posting_date = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('Posting Date'),\n\t\t\t\t\tfieldtype: 'Date',\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tme.events.get_frm().doc.posting_date= this.value;\n\t\t\t\t\t\tme.events.get_frm().doc.set_posting_time= 1;\n\t\t\t\t\t},\n\n\t\t\t\t},\n\t\t\t\tparent: this.$component.find('.invoice-posting-date'),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t}\n\n\n\t\tthis.search_field.toggle_label(false);\n\t\tthis.item_group_field.toggle_label(false);\n\t\tif(this.custom_show_last_incoming_rate) {\n            this.total_incoming_rate.toggle_label(false);\n        }\n\t\tif(me.custom_show_posting_date) {\n            this.invoice_posting_date.toggle_label(false);\n            this.invoice_posting_date.set_value(frappe.datetime.get_today())\n\n        }\n\n\t\tthis.attach_clear_btn();\n\t}\n\n\tattach_clear_btn() {\n\t\tthis.search_field.$wrapper.find('.control-input').append(\n\t\t\t`<span class=\"link-btn\" style=\"top: 2px;\">\n\t\t\t\t<a class=\"btn-open no-decoration\" title=\"${__(\"Clear\")}\">\n\t\t\t\t\t${frappe.utils.icon('close', 'sm')}\n\t\t\t\t</a>\n\t\t\t</span>`\n\t\t);\n\n\t\tthis.$clear_search_btn = this.search_field.$wrapper.find('.link-btn');\n\n\t\tthis.$clear_search_btn.on('click', 'a', () => {\n\t\t\tthis.set_search_value('');\n\t\t\tthis.search_field.set_focus();\n\t\t});\n\t}\n\n\tset_search_value(value) {\n\t\t$(this.search_field.$input[0]).val(value).trigger(\"input\");\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tif(!window.onScan){\n\t\t\tfrappe.require(\"https://cdn.jsdelivr.net/npm/onscan.js/onscan.min.js\", function() {\n\t\t\twindow.onScan = onScan;\n\n\t\t\tonScan.decodeKeyEvent = function (oEvent) {\n\t\t\t\tvar iCode = this._getNormalizedKeyNum(oEvent);\n\t\t\t\tswitch (true) {\n\t\t\t\t\tcase iCode >= 48 && iCode <= 90: // numbers and letters\n\t\t\t\t\tcase iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n\t\t\t\t\tcase (iCode >= 160 && iCode <= 164) || iCode == 170: // ^ ! # $ *\n\t\t\t\t\tcase iCode >= 186 && iCode <= 194: // (; = , - . / `)\n\t\t\t\t\tcase iCode >= 219 && iCode <= 222: // ([ \\ ] ')\n\t\t\t\t\tcase iCode == 32: // spacebar\n\t\t\t\t\t\tif (oEvent.key !== undefined && oEvent.key !== '') {\n\t\t\t\t\t\t\treturn oEvent.key;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar sDecoded = String.fromCharCode(iCode);\n\t\t\t\t\t\tswitch (oEvent.shiftKey) {\n\t\t\t\t\t\t\tcase false: sDecoded = sDecoded.toLowerCase(); break;\n\t\t\t\t\t\t\tcase true: sDecoded = sDecoded.toUpperCase(); break;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn sDecoded;\n\t\t\t\t\tcase iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n\t\t\t\t\t\treturn 0 + (iCode - 96);\n\t\t\t\t}\n\t\t\t\treturn '';\n\t\t\t};\n\n\t\t\tonScan.attachTo(document, {\n\t\t\t\tonScan: (sScancode) => {\n\t\t\t\t\tif (this.search_field && this.$component.is(':visible')) {\n\t\t\t\t\t\tthis.search_field.set_focus();\n\t\t\t\t\t\tthis.set_search_value(sScancode);\n\t\t\t\t\t\tthis.barcode_scanned = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t\t}\n\n\n\n\t\tthis.$component.on('click', '.item-wrapper', function() {\n\t\t\tconsole.log(\"OnClick Item Wrapper\")\n\t\t\tconst $item = $(this);\n\t\t\tconst item_code = unescape($item.attr('data-item-code'));\n\t\t\tlet batch_no = unescape($item.attr('data-batch-no'));\n\t\t\tlet serial_no = unescape($item.attr('data-serial-no'));\n\t\t\tlet uom = unescape($item.attr('data-uom'));\n\t\t\tlet rate = unescape($item.attr('data-rate'));\n\t\t\tlet valuation_rate = unescape($item.attr('data-valuation-rate'));\n\t\t\tlet custom_item_uoms = $item.attr('data-item-uoms');\n\t\t\tlet custom_logical_rack = $item.attr('data-item-logical-rack')\n\t\t\t// escape(undefined) returns \"un\tdefined\" then unescape returns \"undefined\"\n\t\t\tbatch_no = batch_no === \"undefined\" ? undefined : batch_no;\n\t\t\tserial_no = serial_no === \"undefined\" ? undefined : serial_no;\n\t\t\tuom = uom === \"undefined\" ? undefined : uom;\n\t\t\trate = rate === \"undefined\" ? undefined : rate;\n\t\t\tme.events.item_selected({\n\t\t\t\tfield: 'qty',\n\t\t\t\tvalue: \"+1\",\n\t\t\t\titem: { item_code, batch_no, serial_no, uom, rate ,valuation_rate, custom_item_uoms, custom_logical_rack}\n\t\t\t});\n\t\t\t// me.search_field.set_focus();\n\t\t});\n\n\t\tthis.search_field.$input.on('input', (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tthis.filter_items({ search_term });\n\t\t\t}, 300);\n\n\t\t\t// this.$clear_search_btn.toggle(\n\t\t\t// \tBoolean(this.search_field.$input.val())\n\t\t\t// );\n\t\t});\n\n\t\t// this.search_field.$input.on('focus', () => {\n\t\t// \tthis.$clear_search_btn.toggle(\n\t\t// \t\tBoolean(this.search_field.$input.val())\n\t\t// \t);\n\t\t// });\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.search_field.parent.attr(\"title\", `${ctrl_label}+I`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+i\",\n\t\t\taction: () => this.search_field.set_focus(),\n\t\t\tcondition: () => this.$component.is(':visible'),\n\t\t\tdescription: __(\"Focus on search input\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.item_group_field.parent.attr(\"title\", `${ctrl_label}+G`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+g\",\n\t\t\taction: () => this.item_group_field.set_focus(),\n\t\t\tcondition: () => this.$component.is(':visible'),\n\t\t\tdescription: __(\"Focus on Item Group filter\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\n\t\t// for selecting the last filtered item on search\n\t\tfrappe.ui.keys.on(\"enter\", () => {\n\t\t\tconst selector_is_visible = this.$component.is(':visible');\n\t\t\tif (!selector_is_visible || this.search_field.get_value() === \"\") return;\n\n\t\t\tif (this.items.length == 1) {\n\t\t\t\tthis.$items_container.find(\".item-wrapper\").click();\n\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\tthis.set_search_value('');\n\t\t\t} else if (this.items.length == 0 && this.barcode_scanned) {\n\t\t\t\t// only show alert of barcode is scanned and enter is pressed\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"No items found. Scan barcode again.\"),\n\t\t\t\t\tindicator: 'orange'\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\tthis.barcode_scanned = false;\n\t\t\t\tthis.set_search_value('');\n\t\t\t}\n\t\t});\n\t}\n\n\tfilter_items({ search_term='' }={}) {\n\t\tif (search_term) {\n\t\t\tsearch_term = search_term.toLowerCase();\n\n\t\t\t// memoize\n\t\t\tthis.search_index = this.search_index || {};\n\t\t\tif (this.search_index[search_term]) {\n\t\t\t\tconst items = this.search_index[search_term];\n\t\t\t\tthis.items = items;\n\t\t\t\tthis.render_item_list(items);\n\t\t\t\tthis.auto_add_item && this.items.length == 1;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.get_items({ search_term })\n\t\t\t.then(({ message }) => {\n\t\t\t\t// eslint-disable-next-line no-unused-vars\n\t\t\t\tconst { items, serial_no, batch_no, barcode } = message;\n\t\t\t\tif (search_term && !barcode) {\n\t\t\t\t\tthis.search_index[search_term] = items;\n\t\t\t\t}\n\t\t\t\tthis.items = items;\n\t\t\t\tthis.render_item_list(items);\n\t\t\t\tthis.auto_add_item && this.items.length == 1;\n\t\t\t});\n\t}\n\n\tadd_filtered_item_to_cart() {\n\t\tthis.$items_container.find(\".item-wrapper\").click();\n\t\tthis.set_search_value('');\n\t}\n\n\tresize_selector(minimize) {\n\t\tminimize ?\n\t\t\tthis.$component.find('.filter-section').css('grid-template-columns', 'repeat(1, minmax(0, 1fr))') :\n\t\t\tthis.$component.find('.filter-section').css('grid-template-columns', 'repeat(12, minmax(0, 1fr))');\n\n\t\tminimize ?\n\t\t\tthis.$component.find('.search-field').css('margin', 'var(--margin-sm) 0px') :\n\t\t\tthis.$component.find('.search-field').css('margin', '0px var(--margin-sm)');\n\n\t\tminimize ?\n\t\t\tthis.$component.css('grid-column', 'span 2 / span 2') :\n\t\t\tthis.$component.css('grid-column', 'span 6 / span 6');\n\n\t\tminimize ?\n\t\t\tthis.$items_container.css('grid-template-columns', 'repeat(1, minmax(0, 1fr))') :\n\t\t\tthis.$items_container.css('grid-template-columns', 'repeat(4, minmax(0, 1fr))');\n\t}\n\n\ttoggle_component(show) {\n\t\tthis.set_search_value('');\n\t\tthis.$component.css('display', show ? 'flex': 'none');\n\t}\n};\n", "frappe.provide('posnext.PointOfSale');\nposnext.PointOfSale.ItemCart = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.customer_info = undefined;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.allowed_customer_groups = settings.customer_groups;\n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.show_held_button = settings.custom_show_held_button;\n\t\tthis.show_order_list_button = settings.custom_show_order_list_button;\n\t\tthis.mobile_number_based_customer = settings.custom_mobile_number_based_customer;\n\t\tthis.show_checkout_button = settings.custom_show_checkout_button;\n\t\tthis.custom_edit_rate = settings.custom_edit_rate_and_uom;\n\t\tthis.custom_use_discount_percentage = settings.custom_use_discount_percentage;\n\t\tthis.custom_use_discount_amount = settings.custom_use_discount_amount;\n\t\tthis.custom_use_additional_discount_amount = settings.custom_use_additional_discount_amount;\n\t\tthis.custom_show_incoming_rate = settings.custom_show_incoming_rate && settings.custom_edit_rate_and_uom;\n\t\tthis.custom_show_last_customer_rate = settings.custom_show_last_customer_rate;\n\t\tthis.custom_show_logical_rack_in_cart = settings.custom_show_logical_rack_in_cart && settings.custom_edit_rate_and_uom;\n\t\tthis.custom_show_uom_in_cart = settings.custom_show_uom_in_cart && settings.custom_edit_rate_and_uom;\n\t\t// this.custom_edit_uom = settings.custom_edit_uom;\n\t\tthis.settings = settings;\n\t\tthis.warehouse = settings.warehouse;\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tif(this.custom_edit_rate){\n\t\t    this.wrapper.append(\n\t\t\t    `<section class=\"customer-cart-container customer-cart-container1 \" style=\"grid-column: span 5 / span 5;\" id=\"customer-cart-container2\"></section>`\n\t\t    )\n\t\t} else {\n\t\t\tthis.wrapper.append(\n\t\t\t    `<section class=\"customer-cart-container customer-cart-container1 \" id=\"customer-cart-container2\"></section>`\n\t\t    )\n\t\t}\n\n\t\tthis.$component = this.wrapper.find('.customer-cart-container1');\n\t}\n\n\tinit_child_components() {\n\t\tthis.init_customer_selector();\n\t\tthis.init_cart_components();\n\t}\n\n\tinit_customer_selector() {\n\t\tthis.$component.append(\n\t\t\t`<div class=\"customer-section\"></div>`\n\t\t)\n\t\tthis.$customer_section = this.$component.find('.customer-section');\n\t\tthis.make_customer_selector();\n\t}\n\n\treset_customer_selector() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrm.set_value('customer', '');\n\t\tthis.make_customer_selector();\n\t\tthis.customer_field.set_focus();\n\t}\n\n\tinit_cart_components() {\n\t\tvar html = `<div class=\"cart-container\">\n\t\t\t\t<div class=\"abs-cart-container\">\n\t\t\t\t\t<div class=\"cart-label\">${__('Item Cart')}</div>\n\t\t\t\t\t<div class=\"cart-header\">\n\t\t\t\t\t\t<div class=\"name-header\" style=\"flex:3\">${__('Item')}</div>\n\t\t\t\t\t\t<div class=\"qty-header\" style=\"flex: 1\">${__('Qty')}</div>\n\t\t\t\t\t\t`\n\t\t\tif(this.custom_show_uom_in_cart){\n\t\t\t\thtml += `<div class=\"uom-header\" style=\"flex: 1\">${__('UOM')}</div>`\n\t\t\t}\n\t\t\tif(this.custom_edit_rate){\n\t\t\t\thtml += `<div class=\"rate-header\" style=\"flex: 1\">${__('Rate')}</div>`\n\t\t\t}\n\t\t\tif(this.custom_use_discount_percentage){\n\t\t\t\thtml += `<div class=\"discount-perc-header\" style=\"flex: 1\">${__('Disc%')}</div>`\n\t\t\t}\n\t\t\tif(this.custom_use_discount_amount){\n\t\t\t\thtml += `<div class=\"discount-amount-header\" style=\"flex: 1\">${__('Disc')}</div>`\n\t\t\t}\n\t\t\tif(this.custom_show_incoming_rate){\n\t\t\t\thtml += `<div class=\"incoming-rate-header\" style=\"flex: 1\">${__('Inc.Rate')}</div>`\n\t\t\t}\n\t\t\tif(this.custom_show_logical_rack_in_cart){\n\t\t\t\thtml += `<div class=\"incoming-rate-header\" style=\"flex: 1\">${__('Rack')}</div>`\n\t\t\t}\n\t\t\tif(this.custom_show_last_customer_rate){\n\t\t\t\thtml += `<div class=\"last-customer-rate-header\" style=\"flex: 1\">${__('LC Rate')}</div>`\n\t\t\t}\n\t\t\t\n\n\t\thtml += `<div class=\"rate-amount-header\" style=\"flex: 1;text-align: left\">${__('Amount')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"cart-items-section\" ></div>\n\t\t\t\t\t<div class=\"cart-totals-section\"></div>\n\t\t\t\t\t<div class=\"numpad-section\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\tthis.$component.append(html);\n\t\tthis.$cart_container = this.$component.find('.cart-container');\n\n\t\tthis.make_cart_totals_section();\n\t\tthis.make_cart_items_section();\n\t\tthis.make_cart_numpad();\n\t}\n\n\tmake_cart_items_section() {\n\t\tthis.$cart_header = this.$component.find('.cart-header');\n\t\tthis.$cart_items_wrapper = this.$component.find('.cart-items-section');\n\n\t\tthis.make_no_items_placeholder();\n\t}\n\n\tmake_no_items_placeholder() {\n\t\tthis.$cart_header.css('display', 'none');\n\t\tthis.$cart_items_wrapper.html(\n\t\t\t`<div class=\"no-item-wrapper\">${__('No items in cart')}</div>`\n\t\t);\n\t}\n\n\tget_discount_icon() {\n\t\treturn (\n\t\t\t`<svg class=\"discount-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t<path d=\"M19 15.6213C19 15.2235 19.158 14.842 19.4393 14.5607L20.9393 13.0607C21.5251 12.4749 21.5251 11.5251 20.9393 10.9393L19.4393 9.43934C19.158 9.15804 19 8.7765 19 8.37868V6.5C19 5.67157 18.3284 5 17.5 5H15.6213C15.2235 5 14.842 4.84196 14.5607 4.56066L13.0607 3.06066C12.4749 2.47487 11.5251 2.47487 10.9393 3.06066L9.43934 4.56066C9.15804 4.84196 8.7765 5 8.37868 5H6.5C5.67157 5 5 5.67157 5 6.5V8.37868C5 8.7765 4.84196 9.15804 4.56066 9.43934L3.06066 10.9393C2.47487 11.5251 2.47487 12.4749 3.06066 13.0607L4.56066 14.5607C4.84196 14.842 5 15.2235 5 15.6213V17.5C5 18.3284 5.67157 19 6.5 19H8.37868C8.7765 19 9.15804 19.158 9.43934 19.4393L10.9393 20.9393C11.5251 21.5251 12.4749 21.5251 13.0607 20.9393L14.5607 19.4393C14.842 19.158 15.2235 19 15.6213 19H17.5C18.3284 19 19 18.3284 19 17.5V15.6213Z\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15 9L9 15\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M10.5 9.5C10.5 10.0523 10.0523 10.5 9.5 10.5C8.94772 10.5 8.5 10.0523 8.5 9.5C8.5 8.94772 8.94772 8.5 9.5 8.5C10.0523 8.5 10.5 8.94772 10.5 9.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15.5 14.5C15.5 15.0523 15.0523 15.5 14.5 15.5C13.9477 15.5 13.5 15.0523 13.5 14.5C13.5 13.9477 13.9477 13.5 14.5 13.5C15.0523 13.5 15.5 13.9477 15.5 14.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t</svg>`\n\t\t);\n\t}\n\n\tmake_cart_totals_section() {\n\t\tthis.$totals_section = this.$component.find('.cart-totals-section');\n\n\t\tthis.$totals_section.append(\n\t\t\t`<div class=\"add-discount-wrapper\">\n\t\t\t\t${this.get_discount_icon()} ${__('Add Discount')}\n\t\t\t</div>\n\t\t\t<div class=\"item-qty-total-container\">\n\t\t\t\t<div class=\"item-qty-total-label\">${__('Total Items')}</div>\n\t\t\t\t<div class=\"item-qty-total-value\">0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"net-total-container\">\n\t\t\t\t<div class=\"net-total-label\">${__(\"Net Total\")}</div>\n\t\t\t\t<div class=\"net-total-value\">0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"taxes-container\"></div>\n\t\t\t<div class=\"grand-total-container\">\n\t\t\t\t<div>${__('Grand Total')}</div>\n\t\t\t\t<div>0.00</div>\n\t\t\t</div>\n\t\t\t<div style=\" display: flex;justify-content: space-between;gap: 10px;\">\n\t\t\t\t<div class=\"checkout-btn\" style=\"\n\t\t\t\t\t\t\tpadding: 10px;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\t\tborder: none;\n\t\t\t\t\t\t\tborder-radius: 5px;\n\t\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\tflex: 1; \">${__('Checkout')}</div>\n\t\t\t\t<div class=\"checkout-btn-held checkout-btn\" style=\"\n\t\t\t\t\t\t\tpadding: 10px;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\t\tborder: none;\n\t\t\t\t\t\t\tborder-radius: 5px;\n\t\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\tflex: 1;\">${__('Held')}</div>\n\t\t\t\t<div class=\"checkout-btn-order checkout-btn\" style=\"\n\t\t\t\tpadding: 10px;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\t\tborder: none;\n\t\t\t\t\t\t\tborder-radius: 5px;\n\t\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\tflex: 1;\">${__('Order List')}</div>\n\t\t\t</div>\t\n\t\t\t<div class=\"edit-cart-btn\">${__('Edit Cart')}</div>`\n\t\t)\n\n\t\tthis.$add_discount_elem = this.$component.find(\".add-discount-wrapper\");\nthis.highlight_checkout_btn(true);\n\t}\n\n\tmake_cart_numpad() {\n\t\tthis.$numpad_section = this.$component.find('.numpad-section');\n\n\t\tthis.number_pad = new posnext.PointOfSale.NumberPad({\n\t\t\twrapper: this.$numpad_section,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: this.on_numpad_event.bind(this)\n\t\t\t},\n\t\t\tcols: 5,\n\t\t\tkeys: [\n\t\t\t\t[ 1, 2, 3, 'Quantity' ],\n\t\t\t\t[ 4, 5, 6, 'Discount' ],\n\t\t\t\t[ 7, 8, 9, 'Rate' ],\n\t\t\t\t[ '.', 0, 'Delete', 'Remove' ]\n\t\t\t],\n\t\t\tcss_classes: [\n\t\t\t\t[ '', '', '', 'col-span-2' ],\n\t\t\t\t[ '', '', '', 'col-span-2' ],\n\t\t\t\t[ '', '', '', 'col-span-2' ],\n\t\t\t\t[ '', '', '', 'col-span-2 remove-btn' ]\n\t\t\t],\n\t\t\tfieldnames_map: { 'Quantity': 'qty', 'Discount': 'discount_percentage' }\n\t\t})\n\n\t\tthis.$numpad_section.prepend(\n\t\t\t`<div class=\"numpad-totals\">\n\t\t\t<span class=\"numpad-item-qty-total\"></span>\n\t\t\t\t<span class=\"numpad-net-total\"></span>\n\t\t\t\t<span class=\"numpad-grand-total\"></span>\n\t\t\t</div>`\n\t\t)\n\n\t\tthis.$numpad_section.append(\n\t\t\t`<div class=\"numpad-btn checkout-btn\" data-button-value=\"checkout\">${__('Checkout')}</div>`\n\t\t)\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tthis.$customer_section.on('click', '.reset-customer-btn', function () {\n\t\t\tme.reset_customer_selector();\n\t\t});\n\n\t\tthis.$customer_section.on('click', '.close-details-btn', function () {\n\t\t\tme.toggle_customer_info(false);\n\t\t});\n\n\t\tthis.$customer_section.on('click', '.customer-display', function(e) {\n\t\t\tif ($(e.target).closest('.reset-customer-btn').length) return;\n\n\t\t\tconst show = me.$cart_container.is(':visible');\n\t\t\tme.toggle_customer_info(show);\n\t\t});\n        //\n\t\tif(!me.custom_edit_rate){\n\t\t\tthis.$cart_items_wrapper.on('click', '.cart-item-wrapper', function() {\n                const $cart_item = $(this);\n\n                me.toggle_item_highlight(this);\n\n                const payment_section_hidden = !me.$totals_section.find('.edit-cart-btn').is(':visible');\n                if (!payment_section_hidden) {\n                    // payment section is visible\n                    // edit cart first and then open item details section\n                    me.$totals_section.find(\".edit-cart-btn\").click();\n                }\n\n                const item_row_name = unescape($cart_item.attr('data-row-name'));\n                me.events.cart_item_clicked({ name: item_row_name });\n                this.numpad_value = '';\n            });\n\t\t}\n\n\n\t\tthis.$component.on('click', '.checkout-btn', async function() {\n\t\t\tif ($(this).attr('style').indexOf('--blue-500') == -1) return;\n\t\t\tif ($(this).attr('class').indexOf('checkout-btn-held') !== -1) return;\n\t\t\tif ($(this).attr('class').indexOf('checkout-btn-order') !== -1) return;\n\t\t\tif(!cur_frm.doc.customer &&  me.mobile_number_based_customer){\n\t\t\t\tlet d = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: 'Enter Mobile Number',\n\t\t\t\t\tfields: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Mobile Number',\n\t\t\t\t\t\t\tfieldname: 'mobile_number',\n\t\t\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\t\t\treqd: 1\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: '',\n\t\t\t\t\t\t\tfieldname: 'mobile_number_numpad',\n\t\t\t\t\t\t\tfieldtype: 'HTML',\n\t\t\t\t\t\t\toptions: '<div class=\"mobile_number_numpad\"></div>'\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tsize: 'small',\n\t\t\t\t\tprimary_action_label: 'Continue',\n\t\t\t\t\tprimary_action: function(values) {\n\t\t\t\t\t\tif(values['mobile_number'].length !== me.settings.custom_mobile_number_length){\n\t\t\t\t\t\t\tfrappe.throw(\"Mobile Number Length is \" + me.settings.custom_mobile_number_length.toString())\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.create_customer\",\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\tcustomer: values['mobile_number']\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\t\tfreeze_message: \"Creating Customer....\",\n\t\t\t\t\t\t\tcallback: async function(){\n\t\t\t\t\t\t\t\tconst frm = me.events.get_frm();\n\t\t\t\t\t\t\t\tfrappe.dom.freeze();\n\t\t\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'customer', values['mobile_number']);\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger('customer', frm.doc.doctype, frm.doc.name).then(() => {\n\t\t\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t\t\t() => me.fetch_customer_details(values['mobile_number']),\n\t\t\t\t\t\t\t\t\t\t() => me.events.customer_details_updated(me.customer_info),\n\t\t\t\t\t\t\t\t\t\t() => me.update_customer_section(),\n\t\t\t\t\t\t\t\t\t\t() => frappe.dom.unfreeze()\n\t\t\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t// me.fetch_customer_details(values['mobile_number'])\n\t\t\t\t\t\t\t\t// me.events.customer_details_updated(me.customer_info)\n\t\t\t\t\t\t\t\t// me.update_customer_section()\n\t\t\t\t\t\t\t\tawait me.events.checkout();\n\t\t\t\t\t\t\t\tme.toggle_checkout_btn(false);\n\t\t\t\t\t\t\t\tme.allow_discount_change && me.$add_discount_elem.removeClass(\"d-none\");\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tvar mobile_number_numpad_div = d.wrapper.find(\".mobile_number_numpad\")\n\t\t\t\tmobile_number_numpad_div.append(`\n\t\t\t\t\t<div class=\"custom-numpad\">\n\t\t\t\t\t\t<style>\n\t\t\t\t\t\t.custom-numpad {\n\t\t\t\t\t\t\tdisplay: grid;\n\t\t\t\t\t\t\tgrid-template-columns: repeat(3, 1fr);\n\t\t\t\t\t\t\tgap: 10px;\n\t\t\t\t\t\t\tmax-width: 350px;\n\t\t\t\t\t\t\tmargin: 0 auto;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.numpad-button {\n\t\t\t\t\t\t\tpadding: 15px;\n\t\t\t\t\t\t\tfont-size: 18px;\n\t\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\tbackground-color: #f1f1f1;\n\t\t\t\t\t\t\tborder: 1px solid #ccc;\n\t\t\t\t\t\t\tborder-radius: 5px;\n\t\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.numpad-button:hover {\n\t\t\t\t\t\t\tbackground-color: #ddd;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t</style>\n\t\t\t\t\t\t<button class=\"numpad-button one\">1</button>\n\t\t\t\t\t\t<button class=\"numpad-button two\">2</button>\n\t\t\t\t\t\t<button class=\"numpad-button three\">3</button>\n\t\t\t\t\t\t<button class=\"numpad-button four\">4</button>\n\t\t\t\t\t\t<button class=\"numpad-button five\">5</button>\n\t\t\t\t\t\t<button class=\"numpad-button six\">6</button>\n\t\t\t\t\t\t<button class=\"numpad-button seven\">7</button>\n\t\t\t\t\t\t<button class=\"numpad-button eight\">8</button>\n\t\t\t\t\t\t<button class=\"numpad-button nine\">9</button>\n\t\t\t\t\t\t<button class=\"numpad-button delete\" style=\"color: red\">x</button>\n\t\t\t\t\t\t<button class=\"numpad-button zero\">0</button>\n\t\t\t\t\t\t<button class=\"numpad-button clear\">C</button> <!-- Clear button -->\n\t\t\t\t\t</div>`)\n\n\t\t\t\td.show();\n\t\t\t\tvar numpad_num = d.wrapper.find(\".custom-numpad\")\n\t\t\t\tvar numbers = [\"one\",'two','three','four','five','six','seven','eight','nine','zero',\"plus\"]\n\t\t\t\tfor(var xx=0;xx<numbers.length;xx+=1){\n\t\t\t\t\tnumpad_num.on('click', '.' + numbers[xx], function() {\n\t\t\t\t\t\tvar current_value = d.get_value(\"mobile_number\")\n\t\t\t\t\t\td.set_value('mobile_number', current_value + $(this)[0].innerHTML.toString());\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tnumpad_num.on('click', '.clear', function() {\n\t\t\t\t\t\td.set_value('mobile_number', \"\");\n\t\t\t\t\t})\n\t\t\t\tnumpad_num.on('click', '.delete', function() {\n\t\t\t\t\tvar current_value = d.get_value(\"mobile_number\")\n\t\t\t\t\t\td.set_value('mobile_number', current_value.slice(0, -1));\n\t\t\t\t\t})\n\n\n\t\t\t} else {\n\t\t\t\tif(!cur_frm.doc.customer &&  !me.mobile_number_based_customer){\n\t\t\t\t\tfrappe.throw(\"Please Select a customer and add items first\")\n\t\t\t\t}\n\t\t\t\tawait me.events.checkout();\n\t\t\t\tme.toggle_checkout_btn(false);\n\t\t\t\tme.allow_discount_change && me.$add_discount_elem.removeClass(\"d-none\");\n\t\t\t}\n\n\n\n\t\t});\n\n\t\tthis.$component.on('click', '.checkout-btn-held', function() {\n\t\t\tif ($(this).attr('style').indexOf('--blue-500') == -1) return;\n\t\t\tif(!cur_frm.doc.customer && me.mobile_number_based_customer){\n\t\t\t\tlet d = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: 'Enter Mobile Number',\n\t\t\t\t\tfields: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: 'Mobile Number',\n\t\t\t\t\t\t\tfieldname: 'mobile_number',\n\t\t\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\t\t\treqd: 1\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: '',\n\t\t\t\t\t\t\tfieldname: 'mobile_number_numpad',\n\t\t\t\t\t\t\tfieldtype: 'HTML',\n\t\t\t\t\t\t\toptions: '<div class=\"mobile_number_numpad\"></div>'\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tsize: 'small',\n\t\t\t\t\tprimary_action_label: 'Continue',\n\t\t\t\t\tprimary_action: function(values) {\n\t\t\t\t\t\tif(values['mobile_number'].length !== me.settings.custom_mobile_number_length){\n\t\t\t\t\t\t\tfrappe.throw(\"Mobile Number Length is \" + me.settings.custom_mobile_number_length.toString())\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.create_customer\",\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\tcustomer: values['mobile_number']\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t\t\tfreeze_message: \"Creating Customer....\",\n\t\t\t\t\t\t\tcallback: async function(){\n\t\t\t\t\t\t\t\tconst frm = me.events.get_frm();\n\t\t\t\t\t\t\t\tfrappe.dom.freeze();\n\t\t\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'customer', values['mobile_number']);\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger('customer', frm.doc.doctype, frm.doc.name).then(() => {\n\t\t\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t\t\t() => me.fetch_customer_details(values['mobile_number']),\n\t\t\t\t\t\t\t\t\t\t() => me.events.customer_details_updated(me.customer_info),\n\t\t\t\t\t\t\t\t\t\t() => me.update_customer_section(),\n\t\t\t\t\t\t\t\t\t\t() => frappe.dom.unfreeze()\n\t\t\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tme.events.save_draft_invoice()\n\n\t\t\t\t\t\t\t\td.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tvar mobile_number_numpad_div = d.wrapper.find(\".mobile_number_numpad\")\n\t\t\t\tmobile_number_numpad_div.append(`\n\t\t\t\t\t<div class=\"custom-numpad\">\n\t\t\t\t\t\t<style>\n\t\t\t\t\t\t.custom-numpad {\n\t\t\t\t\t\t\tdisplay: grid;\n\t\t\t\t\t\t\tgrid-template-columns: repeat(3, 1fr);\n\t\t\t\t\t\t\tgap: 10px;\n\t\t\t\t\t\t\tmax-width: 350px;\n\t\t\t\t\t\t\tmargin: 0 auto;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.numpad-button {\n\t\t\t\t\t\t\tpadding: 15px;\n\t\t\t\t\t\t\tfont-size: 18px;\n\t\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\tbackground-color: #f1f1f1;\n\t\t\t\t\t\t\tborder: 1px solid #ccc;\n\t\t\t\t\t\t\tborder-radius: 5px;\n\t\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.numpad-button:hover {\n\t\t\t\t\t\t\tbackground-color: #ddd;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t</style>\n\t\t\t\t\t\t<button class=\"numpad-button one\">1</button>\n\t\t\t\t\t\t<button class=\"numpad-button two\">2</button>\n\t\t\t\t\t\t<button class=\"numpad-button three\">3</button>\n\t\t\t\t\t\t<button class=\"numpad-button four\">4</button>\n\t\t\t\t\t\t<button class=\"numpad-button five\">5</button>\n\t\t\t\t\t\t<button class=\"numpad-button six\">6</button>\n\t\t\t\t\t\t<button class=\"numpad-button seven\">7</button>\n\t\t\t\t\t\t<button class=\"numpad-button eight\">8</button>\n\t\t\t\t\t\t<button class=\"numpad-button nine\">9</button>\n\t\t\t\t\t\t<button class=\"numpad-button delete\" style=\"color: red\">x</button>\n\t\t\t\t\t\t<button class=\"numpad-button zero\">0</button>\n\t\t\t\t\t\t<button class=\"numpad-button clear\">C</button> <!-- Clear button -->\n\t\t\t\t\t</div>`)\n\n\t\t\t\td.show();\n\t\t\t\tvar numpad_num = d.wrapper.find(\".custom-numpad\")\n\t\t\t\tvar numbers = [\"one\",'two','three','four','five','six','seven','eight','nine','zero',\"plus\"]\n\t\t\t\tfor(var xx=0;xx<numbers.length;xx+=1){\n\t\t\t\t\tnumpad_num.on('click', '.' + numbers[xx], function() {\n\t\t\t\t\t\tvar current_value = d.get_value(\"mobile_number\")\n\t\t\t\t\t\td.set_value('mobile_number', current_value + $(this)[0].innerHTML.toString());\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tnumpad_num.on('click', '.clear', function() {\n\t\t\t\t\t\td.set_value('mobile_number', \"\");\n\t\t\t\t\t})\n\t\t\t\t\tnumpad_num.on('click', '.delete', function() {\n\t\t\t\t\tvar current_value = d.get_value(\"mobile_number\")\n\t\t\t\t\t\td.set_value('mobile_number', current_value.slice(0, -1));\n\t\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tme.events.save_draft_invoice();\n\t\t\t}\n\t\t});\n\t\tthis.$component.on('click', '.checkout-btn-order', () => {\n\t\t\tthis.events.toggle_recent_order();\n\t\t});\n\n\t\tthis.$totals_section.on('click', '.edit-cart-btn', () => {\n\t\t\tthis.events.edit_cart();\n\n\t\t\tthis.toggle_checkout_btn(true);\n\t\t});\n\n\t\tthis.$component.on('click', '.add-discount-wrapper', () => {\n\t\t\tconst can_edit_discount = this.$add_discount_elem.find('.edit-discount-btn').length;\n\n\t\t\tif(!this.discount_field || can_edit_discount) this.show_discount_control();\n\t\t});\n\n\t\tfrappe.ui.form.on(\"Sales Invoice\", \"paid_amount\", frm => {\n\t\t\t// called when discount is applied\n\t\t\tthis.update_totals_section(frm);\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tfor (let row of this.number_pad.keys) {\n\t\t\tfor (let btn of row) {\n\t\t\t\tif (typeof btn !== 'string') continue; // do not make shortcuts for numbers\n\n\t\t\t\tlet shortcut_key = `ctrl+${frappe.scrub(String(btn))[0]}`;\n\t\t\t\tif (btn === 'Delete') shortcut_key = 'ctrl+backspace';\n\t\t\t\tif (btn === 'Remove') shortcut_key = 'shift+ctrl+backspace'\n\t\t\t\tif (btn === '.') shortcut_key = 'ctrl+>';\n\n\t\t\t\t// to account for fieldname map\n\t\t\t\tconst fieldname = this.number_pad.fieldnames[btn] ? this.number_pad.fieldnames[btn] :\n\t\t\t\t\ttypeof btn === 'string' ? frappe.scrub(btn) : btn;\n\n\t\t\t\tlet shortcut_label = shortcut_key.split('+').map(frappe.utils.to_title_case).join('+');\n\t\t\t\tshortcut_label = frappe.utils.is_mac() ? shortcut_label.replace('Ctrl', '\u2318') : shortcut_label;\n\t\t\t\tthis.$numpad_section.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`).attr(\"title\", shortcut_label);\n\n\t\t\t\tfrappe.ui.keys.on(`${shortcut_key}`, () => {\n\t\t\t\t\tconst cart_is_visible = this.$component.is(\":visible\");\n\t\t\t\t\tif (cart_is_visible && this.item_is_selected && this.$numpad_section.is(\":visible\")) {\n\t\t\t\t\t\tthis.$numpad_section.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`).click();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.$component.find(\".checkout-btn\").attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+enter\",\n\t\t\taction: () => this.$component.find(\".checkout-btn\").click(),\n\t\t\tcondition: () => this.$component.is(\":visible\") && !this.$totals_section.find('.edit-cart-btn').is(':visible'),\n\t\t\tdescription: __(\"Checkout Order / Submit Order / New Order\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.$component.find(\".edit-cart-btn\").attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.on(\"ctrl+e\", () => {\n\t\t\tconst item_cart_visible = this.$component.is(\":visible\");\n\t\t\tconst checkout_btn_invisible = !this.$totals_section.find('.checkout-btn').is('visible');\n\t\t\tif (item_cart_visible && checkout_btn_invisible) {\n\t\t\t\tthis.$component.find(\".edit-cart-btn\").click();\n\t\t\t}\n\t\t});\n\t\tthis.$component.find(\".add-discount-wrapper\").attr(\"title\", `${ctrl_label}+D`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+d\",\n\t\t\taction: () => this.$component.find(\".add-discount-wrapper\").click(),\n\t\t\tcondition: () => this.$add_discount_elem.is(\":visible\"),\n\t\t\tdescription: __(\"Add Order Discount\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_cart_visible = this.$component.is(\":visible\");\n\t\t\tif (item_cart_visible && this.discount_field && this.discount_field.parent.is(\":visible\")) {\n\t\t\t\tthis.discount_field.set_value(0);\n\t\t\t}\n\t\t});\n\t}\n\n\ttoggle_item_highlight(item) {\n\t\tconst $cart_item = $(item);\n\t\tconst item_is_highlighted = $cart_item.attr(\"style\") == \"background-color:var(--gray-50);\";\n\n\t\tif (!item || item_is_highlighted) {\n\t\t\tthis.item_is_selected = false;\n\t\t\tthis.$cart_container.find('.cart-item-wrapper').css(\"background-color\", \"\");\n\t\t} else {\n\t\t\t$cart_item.css(\"background-color\", \"var(--control-bg)\");\n\t\t\tthis.item_is_selected = true;\n\t\t\tthis.$cart_container.find('.cart-item-wrapper').not(item).css(\"background-color\", \"\");\n\t\t}\n\t}\n\n\tmake_customer_selector() {\n\t\tthis.$customer_section.html(`\n\t\t\t<div class=\"customer-field\"></div>\n\t\t`);\n\t\tconst me = this;\n\t\tconst query = { query: 'posnext.controllers.queries.customer_query' };\n\t\tconst allowed_customer_group = this.allowed_customer_groups || [];\n\t\tif (allowed_customer_group.length) {\n\t\t\tquery.filters = {\n\t\t\t\tcustomer_group: ['in', allowed_customer_group]\n\t\t\t}\n\t\t}\n\t\tthis.customer_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Customer'),\n\t\t\t\tfieldtype: 'Link',\n\t\t\t\toptions: 'Customer',\n\t\t\t\tplaceholder: __('Search by customer name, phone, email.'),\n\t\t\t\tread_only: this.mobile_number_based_customer,\n\t\t\t\tget_query: () => query,\n\t\t\t\tonchange: function() {\n\t\t\t\t\tif (this.value) {\n\t\t\t\t\t\tconst frm = me.events.get_frm();\n\t\t\t\t\t\tfrappe.dom.freeze();\n\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'customer', this.value);\n\t\t\t\t\t\tfrm.script_manager.trigger('customer', frm.doc.doctype, frm.doc.name).then(() => {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => me.fetch_customer_details(this.value),\n\t\t\t\t\t\t\t\t() => me.events.customer_details_updated(me.customer_info),\n\t\t\t\t\t\t\t\t() => me.update_customer_section(),\n\t\t\t\t\t\t\t\t() => me.update_totals_section(),\n\t\t\t\t\t\t\t\t() => frappe.dom.unfreeze()\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$customer_section.find('.customer-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.customer_field.toggle_label(false);\n\t}\n\n\tfetch_customer_details(customer) {\n\t\tif (customer) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tfrappe.db.get_value('Customer', customer, [\"email_id\", \"mobile_no\", \"image\", \"loyalty_program\"]).then(({ message }) => {\n\t\t\t\t\tconst { loyalty_program } = message;\n\t\t\t\t\t// if loyalty program then fetch loyalty points too\n\t\t\t\t\tif (loyalty_program) {\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"erpnext.accounts.doctype.loyalty_program.loyalty_program.get_loyalty_program_details_with_points\",\n\t\t\t\t\t\t\targs: { customer, loyalty_program, \"silent\": true },\n\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\tconst { loyalty_points, conversion_factor } = r.message;\n\t\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\t\tthis.customer_info = { ...message, customer, loyalty_points, conversion_factor };\n\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.customer_info = { ...message, customer };\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tthis.customer_info = {}\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\t}\n\n\tshow_discount_control() {\n\t\tthis.$add_discount_elem.css({ 'padding': '0px', 'border': 'none' });\n\t\tthis.$add_discount_elem.html(\n\t\t\t`<div class=\"add-discount-field\"></div>`\n\t\t);\n\t\tconst me = this;\n\t\tconst frm = me.events.get_frm();\n\t\tlet discount = frm.doc.additional_discount_percentage;\n\t\tthis.discount_field = null;\n\t\tif(me.custom_use_additional_discount_amount){\n\t\t\tthis.discount_field = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('Discount'),\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tplaceholder: ( discount ? discount :  __('Enter discount amount.') ),\n\t\t\t\t\tinput_class: 'input-xs',\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\t\tif (flt(this.value) != 0) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'discount_amount', flt(this.value));\n\t\t\t\t\t\t\t\tme.hide_discount_control(this.value);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'discount_amount', 0);\n\t\t\t\t\t\t\t\tme.$add_discount_elem.css({\n\t\t\t\t\t\t\t\t\t'border': '1px dashed var(--gray-500)',\n\t\t\t\t\t\t\t\t\t'padding': 'var(--padding-sm) var(--padding-md)'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tme.$add_discount_elem.html(`${me.get_discount_icon()} ${__('Add Discount')}`);\n\t\t\t\t\t\t\t\tme.discount_field = undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 3000);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tparent: this.$add_discount_elem.find('.add-discount-field'),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t}else{\n\t\t\tthis.discount_field = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('Discount'),\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tplaceholder: ( discount ? discount + '%' :  __('Enter discount percentage.') ),\n\t\t\t\t\tinput_class: 'input-xs',\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\t\tif (flt(this.value) != 0) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'additional_discount_percentage', flt(this.value));\n\t\t\t\t\t\t\t\tme.hide_discount_control(this.value);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, 'additional_discount_percentage', 0);\n\t\t\t\t\t\t\t\tme.$add_discount_elem.css({\n\t\t\t\t\t\t\t\t\t'border': '1px dashed var(--gray-500)',\n\t\t\t\t\t\t\t\t\t'padding': 'var(--padding-sm) var(--padding-md)'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tme.$add_discount_elem.html(`${me.get_discount_icon()} ${__('Add Discount')}`);\n\t\t\t\t\t\t\t\tme.discount_field = undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 3000)\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tparent: this.$add_discount_elem.find('.add-discount-field'),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t}\n\t\tthis.discount_field.toggle_label(false);\n\t\tthis.discount_field.set_focus();\n\t}\n\n\thide_discount_control(discount) {\n\t\tif (!discount) {\n\t\t\tthis.$add_discount_elem.css({ 'padding': '0px', 'border': 'none' });\n\t\t\tthis.$add_discount_elem.html(\n\t\t\t\t`<div class=\"add-discount-field\"></div>`\n\t\t\t);\n\t\t} else {\n\t\t\tthis.$add_discount_elem.css({\n\t\t\t\t'border': '1px dashed var(--dark-green-500)',\n\t\t\t\t'padding': 'var(--padding-sm) var(--padding-md)'\n\t\t\t});\n\t\t\tif(this.custom_use_additional_discount_amount){\n\t\t\t\tthis.$add_discount_elem.html(\n\t\t\t\t\t`<div class=\"edit-discount-btn\">\n\t\t\t\t\t\t${this.get_discount_icon()} ${__(\"Additional\")}&nbsp;${String(discount).bold()}&nbsp;${this.events.get_frm().doc.currency} ${__(\"discount applied\")}\n\t\t\t\t\t</div>`\n\t\t\t\t);\n\t\t\t}else{\n\t\t\t\tthis.$add_discount_elem.html(\n\t\t\t\t\t`<div class=\"edit-discount-btn\">\n\t\t\t\t\t\t${this.get_discount_icon()} ${__(\"Additional\")}&nbsp;${String(discount).bold()}% ${__(\"discount applied\")}\n\t\t\t\t\t</div>`\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t}\n\t}\n\n\tupdate_customer_section() {\n\t\tconst me = this;\n\t\tconst { customer, email_id='', mobile_no='', image } = this.customer_info || {};\n\n\t\tif (customer) {\n\t\t\tthis.$customer_section.html(\n\t\t\t\t`<div class=\"customer-details\">\n\t\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t\t${get_customer_description()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"reset-customer-btn\" data-customer=\"${escape(customer)}\">\n\t\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t\t);\n\t\t\tif(this.mobile_number_based_customer){\n\t\t\t\tthis.$customer_section.find('.reset-customer-btn').css('display', 'none');\n\t\t\t} else {\n\t\t\t\tthis.$customer_section.find('.reset-customer-btn').css('display', 'flex');\n\t\t\t}\n\t\t} else {\n\t\t\t// reset customer selector\n\t\t\tthis.reset_customer_selector();\n\t\t}\n\n\t\tfunction get_customer_description() {\n\t\t\tif (!email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"customer-desc\">${__('Click to add email / phone')}</div>`;\n\t\t\t} else if (email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"customer-desc\">${email_id}</div>`;\n\t\t\t} else if (mobile_no && !email_id) {\n\t\t\t\treturn `<div class=\"customer-desc\">${mobile_no}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"customer-desc\">${email_id} - ${mobile_no}</div>`;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tget_customer_image() {\n\t\tconst { customer, image } = this.customer_info || {};\n\t\tif (image) {\n\t\t\treturn `<div class=\"customer-image\"><img src=\"${image}\" alt=\"${image}\"\"></div>`;\n\t\t} else {\n\t\t\treturn `<div class=\"customer-image customer-abbr\">${frappe.get_abbr(customer)}</div>`;\n\t\t}\n\t}\n\n\tupdate_totals_section(frm) {\n\t\tif (!frm) frm = this.events.get_frm();\n\t\tthis.render_net_total(frm.doc.net_total);\n\t\tthis.render_total_item_qty(frm.doc.items);\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? frm.doc.grand_total : frm.doc.rounded_total;\n\t\tthis.render_grand_total(grand_total);\n\n\t\tthis.render_taxes(frm.doc.taxes);\n\t}\n\n\trender_net_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section.find('.net-total-container').html(\n\t\t\t`<div>${__('Net Total')}</div><div>${format_currency(value, currency)}</div>`\n\t\t)\n\n\t\tthis.$numpad_section.find('.numpad-net-total').html(\n\t\t\t`<div>${__('Net Total')}: <span>${format_currency(value, currency)}</span></div>`\n\t\t);\n\t}\n\n\trender_total_item_qty(items) {\n\t\tvar total_item_qty = 0;\n\t\titems.map((item) => {\n\t\t\ttotal_item_qty = total_item_qty + item.qty;\n\t\t});\n\n\t\tthis.$totals_section.find('.item-qty-total-container').html(\n\t\t\t`<div>${__('Total Quantity')}</div><div>${total_item_qty}</div>`\n\t\t);\n\n\t\tthis.$numpad_section.find('.numpad-item-qty-total').html(\n\t\t\t`<div>${__('Total Quantity')}: <span>${total_item_qty}</span></div>`\n\t\t);\n\t}\n\n\trender_grand_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section.find('.grand-total-container').html(\n\t\t\t`<div>${__('Grand Total')}</div><div>${format_currency(value, currency)}</div>`\n\t\t)\n\n\t\tthis.$numpad_section.find('.numpad-grand-total').html(\n\t\t\t`<div>${__('Grand Total')}: <span>${format_currency(value, currency)}</span></div>`\n\t\t);\n\t}\n\n\trender_taxes(taxes) {\n\t\tif (taxes && taxes.length) {\n\t\t\tconst currency = this.events.get_frm().doc.currency;\n\t\t\tconst taxes_html = taxes.map(t => {\n\t\t\t\tif (t.tax_amount_after_discount_amount == 0.0) return;\n\t\t\t\t// if tax rate is 0, don't print it.\n\t\t\t\tconst description = /[0-9]+/.test(t.description) ? t.description : ((t.rate != 0) ? `${t.description} @ ${t.rate}%`: t.description);\n\t\t\t\treturn `<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, currency)}</div>\n\t\t\t\t</div>`;\n\t\t\t}).join('');\n\t\t\tthis.$totals_section.find('.taxes-container').css('display', 'flex').html(taxes_html);\n\t\t} else {\n\t\t\tthis.$totals_section.find('.taxes-container').css('display', 'none').html('');\n\t\t}\n\t}\n\n\tget_cart_item({ name }) {\n\t\tconst item_selector = `.cart-item-wrapper[data-row-name=\"${escape(name)}\"]`;\n\t\treturn this.$cart_items_wrapper.find(item_selector);\n\t}\n\n\tget_item_from_frm(item) {\n\t\tconst doc = this.events.get_frm().doc;\n\t\treturn doc.items.find(i => i.name == item.name);\n\t}\n\n\tupdate_item_html(item, remove_item) {\n\t\tconst $item = this.get_cart_item(item);\n\n\t\tif (remove_item) {\n\t\t\t$item && $item.next().remove() && $item.remove();\n\t\t} else {\n\t\t\tconst item_row = this.get_item_from_frm(item);\n\t\t\tthis.render_cart_item(item_row, $item);\n\t\t}\n\n\t\tconst no_of_cart_items = this.$cart_items_wrapper.find('.cart-item-wrapper').length;\n\t\tthis.highlight_checkout_btn(true);\n\n\t\tthis.update_empty_cart_section(no_of_cart_items);\n\t}\n\n\trender_cart_item(item_data, $item_to_update) {\n\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tconst me = this;\n\n\t\tif (!$item_to_update.length) {\n\t\t\tthis.$cart_items_wrapper.append(\n\t\t\t\t`<div class=\"cart-item-wrapper\" data-row-name=\"${escape(item_data.name)}\"></div>\n\t\t\t\t<div class=\"seperator\"></div>`\n\t\t\t)\n\t\t\t$item_to_update = this.get_cart_item(item_data);\n\t\t}\n\t\tvar item_html = `${get_item_image_html()}`\n\n\t\tif(me.custom_use_discount_percentage && !me.custom_use_discount_amount){\n\t\t\titem_html += `<div class=\"item-name-desc\" style=\"flex: 2.8\">`\n\t\t}\n\t\tif(me.custom_use_discount_amount && !me.custom_use_discount_percentage){\n\t\t\titem_html += `<div class=\"item-name-desc\" style=\"flex: 2.8\">`\n\t\t}\n\t\tif(me.custom_use_discount_amount && me.custom_use_discount_percentage){\n\t\t\titem_html += `<div class=\"item-name-desc\" style=\"flex: 2.5\">`\n\t\t}\n\t\tif(!me.custom_use_discount_amount && !me.custom_use_discount_percentage){\n\t\t\titem_html += `<div class=\"item-name-desc\" style=\"flex: 3.5\">`\n\t\t}\n\n\t\titem_html += `<div class=\"item-name\">\n\t\t\t\t\t${item_data.item_name}\n\t\t\t\t</div>\n\t\t\t\t${get_description_html()}\n\t\t\t</div>\n\t\t\t${get_rate_discount_html()}`\n\n\t\t$item_to_update.html(item_html)\n\t\tif(me.custom_edit_rate){\n\t\t    this[item_data.item_code + \"_qty\"] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tfieldname: \"qty\",\n\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\t// me.events.cart_item_clicked({ name: item_data.name });\n\t\t\t\t\t\tme.events.form_updated(item_data, \"qty\", this.value);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tparent: $item_to_update.find(`.item-qty`),\n\t\t\t\trender_input: true,\n\t\t\t});\n            var uoms = [];\n\t\t\tif(item_data.custom_item_uoms){\n\t\t\t\tuoms = item_data.custom_item_uoms.split(\",\");\n\t\t\t}else if(item_data.uom){\n\t\t\t\tuoms = [item_data.uom];\n\t\t\t}\n\t\t\tif(me.custom_show_uom_in_cart){\n\t\t\t\tthis[item_data.item_code + \"_uom\"] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tfieldname: \"uom\",\n\t\t\t\t\t\tfieldtype: \"Select\",\n\t\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\t\tme.events.form_updated(item_data, \"uom\", this.value);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tparent: $item_to_update.find(`.item-uom`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t}\n            this[item_data.item_code + \"_rate\"] = frappe.ui.form.make_control({\n                    df: {\n                        fieldname: \"rate\",\n                        fieldtype: \"Float\",\n\t\t\t\t\t\tread_only: !me.allow_rate_change,\n\t\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\t\tme.events.form_updated(item_data, \"rate\", this.value);\n\t\t\t\t\t\t},\n                    },\n                    parent: $item_to_update.find(`.item-rate`),\n                    render_input: true,\n\n                });\n            if(me.custom_use_discount_percentage){\n            \tthis[item_data.item_code + \"_discount\"] = frappe.ui.form.make_control({\n                    df: {\n                        fieldname: \"discount\",\n                        fieldtype: \"Float\",\n\t\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\t\tme.events.form_updated(item_data, \"discount_percentage\", this.value);\n\t\t\t\t\t\t},\n\n                    },\n                    parent: $item_to_update.find(`.item-rate-discount`),\n                    render_input: true,\n                });\n\t\t\t}\n\t\t\tif(me.custom_use_discount_amount){\n            \tthis[item_data.item_code + \"_discount_amount\"] = frappe.ui.form.make_control({\n                    df: {\n                        fieldname: \"discount_amount\",\n                        fieldtype: \"Currency\",\n\t\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\t\tme.events.form_updated(item_data, \"discount_amount\", this.value);\n\t\t\t\t\t\t},\n\n                    },\n                    parent: $item_to_update.find(`.item-rate-discount-amount`),\n                    render_input: true,\n                });\n\t\t\t}\n\t\t\tif(this.custom_show_incoming_rate){\n\t\t\t\tthis[item_data.item_code + \"_incoming_rate\"] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tfieldname: \"incoming_rate\",\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tread_only: 1\n\t\t\t\t\t},\n\t\t\t\t\tparent: $item_to_update.find(`.item-incoming-rate`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(this.custom_show_logical_rack_in_cart){\n\t\t\t\tthis[item_data.item_code + \"_logical_rack\"] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tfieldname: \"logical_rack\",\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tread_only: 1\n\t\t\t\t\t},\n\t\t\t\t\tparent: $item_to_update.find(`.item-logical-rack`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(this.custom_show_last_customer_rate){\n\t\t\t\tthis[item_data.item_code + \"_last_customer_rate\"] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tfieldname: \"last_customer_rate\",\n\t\t\t\t\t\tfieldtype: \"Float\",\n\t\t\t\t\t\tread_only: 1\n\t\t\t\t\t},\n\t\t\t\t\tparent: $item_to_update.find(`.item-last-customer-rate`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis[item_data.item_code + \"_amount\"] = frappe.ui.form.make_control({\n                    df: {\n                        fieldname: \"amount\",\n                        fieldtype: \"Float\",\n\t\t\t\t\t\tread_only: 1\n\t\t\t\t\t},\n                    parent: $item_to_update.find(`.item-rate-amount`),\n                    render_input: true,\n                });\n\n            var delete_button = `<svg width=\"16px\" height=\"16px\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" stroke=\"#ff0000\"><g id=\"SVGRepo_bgCarrier\" stroke-width=\"0\"></g><g id=\"SVGRepo_tracerCarrier\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></g><g id=\"SVGRepo_iconCarrier\"> <path d=\"M10 11V17\" stroke=\"#ff0000\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path> <path d=\"M14 11V17\" stroke=\"#ff0000\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path> <path d=\"M4 7H20\" stroke=\"#ff0000\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path> <path d=\"M6 7H12H18V18C18 19.6569 16.6569 21 15 21H9C7.34315 21 6 19.6569 6 18V7Z\" stroke=\"#ff0000\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path> <path d=\"M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5V7H9V5Z\" stroke=\"#ff0000\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path> </g></svg>`\n            var remove_button = frappe.ui.form.make_control({\n                    df: {\n                        fieldname: \"remove\",\n                        fieldtype: \"Button\",\n\t\t\t\t\t\tlabel: delete_button,\n\n                    },\n                    parent: $item_to_update.find(`.remove-button`),\n                    render_input: true,\n                });\n            remove_button.refresh(); // Make sure button is rendered\n            $(remove_button.$input).on(\"click\", function() {\n\t\t\t\tme.events.remove_item_from_cart(item_data)\n\t\t\t\tme.prev_action = undefined;\n\t\t\t\tme.toggle_item_highlight();\n\t\t\t\tme.events.numpad_event(undefined, \"remove\");\n\n            });\n            this[item_data.item_code + \"_qty\"].set_value(item_data.qty)\n\t\t\tif(me.custom_show_uom_in_cart){\n\t\t\t\tthis[item_data.item_code + \"_uom\"].df.options = uoms;\n\t\t\t\tthis[item_data.item_code + \"_uom\"].set_value(item_data.uom);\n\t\t\t\tthis[item_data.item_code + \"_uom\"].refresh();\n\t\t\t}\n\t\t\t\n            // this[item_data.item_code + \"_amount\"].set_value(parseFloat(item_data.amount).toFixed(3));\n            // this[item_data.item_code + \"_rate\"].set_value(parseFloat(item_data.rate).toFixed(3));\n\t\t\tthis[item_data.item_code + \"_amount\"].set_value(item_data.amount);\n\t\t\tthis[item_data.item_code + \"_rate\"].set_value(item_data.rate);\n\t\t\t\n\t\t\tif(me.custom_use_discount_percentage){\n\t\t\t\tthis[item_data.item_code + \"_discount\"].set_value(item_data.discount_percentage)\n\t\t\t}\n\t\t\tif(me.custom_use_discount_amount){\n\t\t\t\tthis[item_data.item_code + \"_discount_amount\"].set_value(item_data.discount_amount)\n\t\t\t}\n\t\t\tif(me.custom_show_incoming_rate){\n\t\t\t\tthis[item_data.item_code + \"_incoming_rate\"].set_value(item_data.custom_valuation_rate);\n\t\t\t}\n\t\t\tif(me.custom_show_logical_rack_in_cart){\n\t\t\t\tthis[item_data.item_code + \"_logical_rack\"].set_value(item_data.custom_logical_rack);\n\t\t\t}\n\t\t\tif(me.custom_show_last_customer_rate){\n\t\t\t\tfrappe.xcall(\"posnext.posnext.page.posnext.point_of_sale.get_lcr\", {\n\t\t\t\t\t\"customer\": me.customer_info.customer, \"item_code\": item_data.item_code\n\t\t\t\t}).then(d=>{\n\t\t\t\t\tthis[item_data.item_code + \"_last_customer_rate\"].set_value(d)\n\t\t\t\t})\n\t\t\t}\n\t\t\tif(me.custom_show_uom_in_cart){\n\t\t\t\tfrappe.xcall(\"posnext.posnext.page.posnext.point_of_sale.get_uoms\", {\n\t\t\t\t\t\"item_code\": item_data.item_code\n\t\t\t\t}).then(d=>{\n\t\t\t\t\tthis[item_data.item_code + \"_uom\"].df.options = d;\n\t\t\t\t\tthis[item_data.item_code + \"_uom\"].refresh();\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tset_dynamic_rate_header_width();\n\n\t\tfunction set_dynamic_rate_header_width() {\n\t\t\tconst rate_cols = Array.from(me.$cart_items_wrapper.find(\".item-rate-amount\"));\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", \"\");\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", \"\");\n\t\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\t\tif ($(elm).width() > max_width)\n\t\t\t\t\tmax_width = $(elm).width();\n\t\t\t\treturn max_width;\n\t\t\t}, 0);\n\n\t\t\tmax_width += 1;\n\t\t\tif (max_width == 1) max_width = \"\";\n\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", max_width);\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", max_width);\n\t\t}\n\n\t\tfunction get_rate_discount_html() {\n\t\t\tif(me.custom_edit_rate){\n\t\t\t\tif (item_data.rate && item_data.amount && item_data.rate !== item_data.amount) {\n\t\t\t\t\tvar html = `\n                        <div class=\"item-qty-rate\" style=\"flex: 6\">\n                        <div class=\"item-qty\" style=\"flex: 1\"></div>`;\n\n\t\t\t\t\tif(me.custom_show_uom_in_cart){\n\t\t\t\t\t\thtml += `<div class=\"item-uom\" style=\"flex: 1;text-align: left\"></div>`;\n\t\t\t\t\t}\n\t\t\t\t\thtml += `<div class=\"item-rate\" style=\"flex: 1;\"></div>`;\n\t\t\t\t\tif(me.custom_use_discount_percentage){\n\t\t\t\t\t\thtml += `<div class=\"item-rate-discount\" style=\"flex: 1;text-align: left\"></div>`\n\t\t\t\t\t}\n\t\t\t\t\tif(me.custom_use_discount_amount){\n\t\t\t\t\t\thtml += `<div class=\"item-rate-discount-amount\" style=\"flex: 1;text-align: left\"></div>`\n\t\t\t\t\t}\n\t\t\t\t\tif(me.custom_show_incoming_rate){\n\t\t\t\t\t\thtml += `<div class=\"item-incoming-rate\" style=\"flex: 1\"></div>`\n\t\t\t\t\t}\n\t\t\t\t\tif(me.custom_show_logical_rack_in_cart){\n\t\t\t\t\t\thtml += `<div class=\"item-logical-rack\" style=\"flex: 1\"></div>`\n\t\t\t\t\t}\n\t\t\t\t\tif(me.custom_show_last_customer_rate){\n\t\t\t\t\t\thtml += `<div class=\"item-last-customer-rate\" style=\"flex: 1\"></div>`\n\t\t\t\t\t}\n                    html += `<div class=\"item-rate-amount\" style=\"flex: 1\"></div>\n\t\t\t\t\t\t\t<div class=\"remove-button\" style=\"margin-top:15px;display: flex;justify-content: center;align-items: center;\"></div>\n                        </div>`\n                    return html\n                } else {\n\t\t\t\t\tvar html = `\n                        <div class=\"item-qty-rate\" style=\"flex: 6\">\n                        <div class=\"item-qty\" style=\"flex: 1\"></div>`;\n\t\t\t\t\tif(me.custom_show_uom_in_cart){\n\t\t\t\t\t\thtml += `<div class=\"item-uom\" style=\"flex: 1;text-align: left\"></div>`;\n\t\t\t\t\t}\n\t\t\t\t\thtml += `<div class=\"item-rate\" style=\"flex: 1;\"></div>`;\n\t\t\t\t\tif(me.custom_use_discount_percentage){\n\t\t\t\t\t\thtml += `<div class=\"item-rate-discount\" style=\"flex: 1;text-align: left\"></div>`\n\t\t\t\t\t}\n\t\t\t\t\tif(me.custom_use_discount_amount){\n\t\t\t\t\t\thtml += `<div class=\"item-rate-discount-amount\" style=\"flex: 1;text-align: left\"></div>`\n\t\t\t\t\t}\n\t\t\t\t\tif(me.custom_show_incoming_rate){\n\t\t\t\t\t\thtml += `<div class=\"item-incoming-rate\" style=\"flex: 1\"></div>`\n\t\t\t\t\t}\n\t\t\t\t\tif(me.custom_show_logical_rack_in_cart){\n\t\t\t\t\t\thtml += `<div class=\"item-logical-rack\" style=\"flex: 1\"></div>`\n\t\t\t\t\t}\n\t\t\t\t\tif(me.custom_show_last_customer_rate){\n\t\t\t\t\t\thtml += `<div class=\"item-last-customer-rate\" style=\"flex: 1\"></div>`\n\t\t\t\t\t}\n                    html += `<div class=\"item-rate-amount\" style=\"flex: 1\"></div>\n                            <div class=\"remove-button\" style=\"margin-top:15px;display: flex;justify-content: center;align-items: center;\"></div>\n                        </div>`\n                    return html\n                }\n\t\t\t} else {\n\t\t\t\tif (item_data.rate && item_data.amount && item_data.rate !== item_data.amount) {\n                    return `\n                        <div class=\"item-qty-rate\" style=\"flex: 4\" > \n                            <div class=\"item-qty\" style=\"flex: 1\"><span>${item_data.qty || 0}</span></div>\n                            <div class=\"item-qty\" style=\"flex: 1\"><span> ${item_data.uom}</span></div>\n                            <div class=\"item-rate-amount\" style=\"flex: 1\">\n                                <div class=\"item-rate\">${parseFloat(item_data.amount).toFixed(2)}</div>\n                                <div class=\"item-amount\">${parseFloat(item_data.rate).toFixed(2)}</div>\n                            </div>\n                        </div>`\n                } else {\n                    return `\n                        <div class=\"item-qty-rate\" style=\"flex: 4\" >\n                            <div class=\"item-qty\" style=\"flex: 1\" ><span>${item_data.qty || 0}</span></div>\n                            <div class=\"item-qty\" style=\"flex: 1\"><span> ${item_data.uom}</span></div>\n                            <div class=\"item-rate-amount\" style=\"flex: 1\">\n                                <div class=\"item-rate\">${parseFloat(item_data.rate).toFixed(2)}</div>\n                            </div>\n                        </div>`\n                }\n\t\t\t}\n\n\t\t}\n\n\t\tfunction get_description_html() {\n\t\t\tif (item_data.description) {\n\t\t\t\tif (item_data.description.indexOf('<div>') != -1) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\titem_data.description = $(item_data.description).text();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\titem_data.description = item_data.description.replace(/<div>/g, ' ').replace(/<\\/div>/g, ' ').replace(/ +/g, ' ');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\titem_data.description = frappe.ellipsis(item_data.description, 45);\n\t\t\t\treturn `<div class=\"item-desc\">${item_data.description}</div>`;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tconst { image, item_name } = item_data;\n\t\t\tif (!me.hide_images && image) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-image\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tonerror=\"cur_pos.cart.handle_broken_image(this)\"\n\t\t\t\t\t\t\tsrc=\"${image}\" alt=\"${frappe.get_abbr(item_name)}\"\">\n\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-image item-abbr\">${frappe.get_abbr(item_name)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).parent().replaceWith(`<div class=\"item-image item-abbr\">${item_abbr}</div>`);\n\t}\n\n\tupdate_selector_value_in_cart_item(selector, value, item) {\n\t\tconst $item_to_update = this.get_cart_item(item);\n\t\t$item_to_update.attr(`data-${selector}`, escape(value));\n\t}\n\n\ttoggle_checkout_btn(show_checkout) {\n\t\tif (show_checkout) {\n\t\t\tif(this.show_checkout_button){\n\t\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'flex');\n\t\t\t} else {\n\t\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'none');\n\t\t\t}\n\n\t\t\tif(this.show_held_button){\n\t\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'flex');\n\t\t\t} else {\n\t\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'none');\n\t\t\t}\n\t\t\tif(this.show_order_list_button){\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'flex');\n\t\t\t} else {\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'none');\n\t\t\t}\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'none');\n\t\t} else {\n\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'none');\n\t\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'none');\n\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'none');\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'none');\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'flex');\n\t\t}\n\t}\n\n\thighlight_checkout_btn(toggle) {\n\t\tif (toggle) {\n\t\t\tthis.$add_discount_elem.css('display', 'flex');\n\t\t\tthis.$cart_container.find('.checkout-btn').css({\n\t\t\t\t'background-color': 'var(--blue-500)'\n\t\t\t});\n\t\t\tif(this.show_held_button){\n\t\t\t\tthis.$cart_container.find('.checkout-btn-held').css({\n\t\t\t\t\t'background-color': 'var(--blue-500)'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.$cart_container.find('.checkout-btn-held').css({\n\t\t\t\t\t'background-color': 'var(--blue-200)'\n\t\t\t\t});\n\t\t\t}\n\t\t\tif(this.show_order_list_button){\n\t\t\t\tthis.$cart_container.find('.checkout-btn-order').css({\n\t\t\t\t\t'background-color': 'var(--blue-500)'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.$cart_container.find('.checkout-btn-order').css({\n\t\t\t\t\t'background-color': 'var(--blue-500)'\n\t\t\t\t});\n\t\t\t}\n\n\t\t} else {\n\t\t\tthis.$add_discount_elem.css('display', 'none');\n\t\t\tthis.$cart_container.find('.checkout-btn').css({\n\t\t\t\t'background-color': 'var(--blue-200)'\n\t\t\t});\n\t\t\tthis.$cart_container.find('.checkout-btn-held').css({\n\t\t\t\t'background-color': 'var(--blue-200)'\n\t\t\t});\n\n\t\t\tthis.$cart_container.find('.checkout-btn-order').css({\n\t\t\t\t'background-color': 'var(--blue-500)'\n\t\t\t});\n\t\t}\n\t}\n\n\tupdate_empty_cart_section(no_of_cart_items) {\n\t\tconst $no_item_element = this.$cart_items_wrapper.find('.no-item-wrapper');\n\n\t\t// if cart has items and no item is present\n\t\tno_of_cart_items > 0 && $no_item_element && $no_item_element.remove() && this.$cart_header.css('display', 'flex');\n\n\t\tno_of_cart_items === 0 && !$no_item_element.length && this.make_no_items_placeholder();\n\t}\n\n\ton_numpad_event($btn) {\n\t\tconst current_action = $btn.attr('data-button-value');\n\t\tconst action_is_field_edit = ['qty', 'discount_percentage', 'rate'].includes(current_action);\n\t\tconst action_is_allowed = action_is_field_edit ? (\n\t\t\t(current_action == 'rate' && this.allow_rate_change) ||\n\t\t\t(current_action == 'discount_percentage' && this.allow_discount_change) ||\n\t\t\t(current_action == 'qty')) : true;\n\n\t\tconst action_is_pressed_twice = this.prev_action === current_action;\n\t\tconst first_click_event = !this.prev_action;\n\t\tconst field_to_edit_changed = this.prev_action && this.prev_action != current_action;\n\n\t\tif (action_is_field_edit) {\n\t\t\tif (!action_is_allowed) {\n\t\t\t\tconst label = current_action == 'rate' ? 'Rate'.bold() : 'Discount'.bold();\n\t\t\t\tconst message = __('Editing {0} is not allowed as per POS Profile settings', [label]);\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\tmessage: message\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (first_click_event || field_to_edit_changed) {\n\t\t\t\tthis.prev_action = current_action;\n\t\t\t} else if (action_is_pressed_twice) {\n\t\t\t\tthis.prev_action = undefined;\n\t\t\t}\n\t\t\tthis.numpad_value = '';\n\n\t\t} else if (current_action === 'checkout') {\n\t\t\tthis.prev_action = undefined;\n\t\t\tthis.toggle_item_highlight();\n\t\t\tthis.events.numpad_event(undefined, current_action);\n\t\t\treturn;\n\t\t} else if (current_action === 'remove') {\n\t\t\tthis.prev_action = undefined;\n\t\t\tthis.toggle_item_highlight();\n\t\t\tthis.events.numpad_event(undefined, current_action);\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.numpad_value = current_action === 'delete' ? this.numpad_value.slice(0, -1) : this.numpad_value + current_action;\n\t\t\tthis.numpad_value = this.numpad_value || 0;\n\t\t}\n\n\t\tconst first_click_event_is_not_field_edit = !action_is_field_edit && first_click_event;\n\n\t\tif (first_click_event_is_not_field_edit) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tindicator: 'red',\n\t\t\t\tmessage: __('Please select a field to edit from numpad')\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (flt(this.numpad_value) > 100 && this.prev_action === 'discount_percentage') {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __('Discount cannot be greater than 100%'),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\tthis.numpad_value = current_action;\n\t\t}\n\n\t\tthis.highlight_numpad_btn($btn, current_action);\n\t\tthis.events.numpad_event(this.numpad_value, this.prev_action);\n\t}\n\n\thighlight_numpad_btn($btn, curr_action) {\n\t\tconst curr_action_is_highlighted = $btn.hasClass('highlighted-numpad-btn');\n\t\tconst curr_action_is_action = ['qty', 'discount_percentage', 'rate', 'done'].includes(curr_action);\n\n\t\tif (!curr_action_is_highlighted) {\n\t\t\t$btn.addClass('highlighted-numpad-btn');\n\t\t}\n\t\tif (this.prev_action === curr_action && curr_action_is_highlighted) {\n\t\t\t// if Qty is pressed twice\n\t\t\t$btn.removeClass('highlighted-numpad-btn');\n\t\t}\n\t\tif (this.prev_action && this.prev_action !== curr_action && curr_action_is_action) {\n\t\t\t// Order: Qty -> Rate then remove Qty highlight\n\t\t\tconst prev_btn = $(`[data-button-value='${this.prev_action}']`);\n\t\t\tprev_btn.removeClass('highlighted-numpad-btn');\n\t\t}\n\t\tif (!curr_action_is_action || curr_action === 'done') {\n\t\t\t// if numbers are clicked\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass('highlighted-numpad-btn');\n\t\t\t}, 200);\n\t\t}\n\t}\n\n\ttoggle_numpad(show) {\n\t\tif (show) {\n\t\t\tthis.$totals_section.css('display', 'none');\n\t\t\tthis.$numpad_section.css('display', 'flex');\n\t\t} else {\n\t\t\tthis.$totals_section.css('display', 'flex');\n\t\t\tthis.$numpad_section.css('display', 'none');\n\t\t}\n\t\tthis.reset_numpad();\n\t}\n\n\treset_numpad() {\n\t\tthis.numpad_value = '';\n\t\tthis.prev_action = undefined;\n\t\tthis.$numpad_section.find('.highlighted-numpad-btn').removeClass('highlighted-numpad-btn');\n\t}\n\n\ttoggle_numpad_field_edit(fieldname) {\n\t\tif (['qty', 'discount_percentage', 'rate'].includes(fieldname)) {\n\t\t\tthis.$numpad_section.find(`[data-button-value=\"${fieldname}\"]`).click();\n\t\t}\n\t}\n\n\ttoggle_customer_info(show) {\n\t\tif (show) {\n\t\t\tconst { customer } = this.customer_info || {};\n\n\t\t\tthis.$cart_container.css('display', 'none');\n\t\t\tthis.$customer_section.css({\n\t\t\t\t'height': '100%',\n\t\t\t\t'padding-top': '0px'\n\t\t\t});\n\t\t\tthis.$customer_section.find('.customer-details').html(\n\t\t\t\t`<div class=\"header\">\n\n\t\t\t\t\t<div class=\"label\">Contact Details</div>\n\t\t\t\t\t<div class=\"close-details-btn\">\n\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t<div class=\"customer-desc\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-fields-container\">\n\t\t\t\t\t<div class=\"email_id-field\"></div>\n\t\t\t\t\t<div class=\"mobile_no-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_program-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_points-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"transactions-label\">Recent Transactions</div>`\n\t\t\t);\n\t\t\t// transactions need to be in diff div from sticky elem for scrolling\n\t\t\tthis.$customer_section.append(`<div class=\"customer-transactions\"></div>`);\n\t\t\tif(this.mobile_number_based_customer){\n\t\t\t\tthis.$customer_section.find('.mobile_no-field').css('display', 'none');\n\t\t\t\tthis.$customer_section.find('.close-details-btn').css('display', 'none');\n\t\t\t} else {\n\t\t\t\tthis.$customer_section.find('.mobile_no-field').css('display', 'flex');\n\t\t\t\tthis.$customer_section.find('.close-details-btn').css('display', 'flex');\n\t\t\t}\n\t\t\tthis.render_customer_fields();\n\t\t\tthis.fetch_customer_transactions();\n\n\t\t} else {\n\t\t\tthis.$cart_container.css('display', 'flex');\n\t\t\tthis.$customer_section.css({\n\t\t\t\t'height': '',\n\t\t\t\t'padding-top': ''\n\t\t\t});\n\n\t\t\tthis.update_customer_section();\n\t\t}\n\t}\n\n\trender_customer_fields() {\n\t\tconst $customer_form = this.$customer_section.find('.customer-fields-container');\n\n\t\tconst dfs = [{\n\t\t\tfieldname: 'email_id',\n\t\t\tlabel: __('Email'),\n\t\t\tfieldtype: 'Data',\n\t\t\toptions: 'email',\n\t\t\tplaceholder: __(\"Enter customer's email\")\n\t\t},{\n\t\t\tfieldname: 'mobile_no',\n\t\t\tlabel: __('Phone Number'),\n\t\t\tfieldtype: 'Data',\n\t\t\tplaceholder: __(\"Enter customer's phone number\")\n\t\t},{\n\t\t\tfieldname: 'loyalty_program',\n\t\t\tlabel: __('Loyalty Program'),\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: 'Loyalty Program',\n\t\t\tplaceholder: __(\"Select Loyalty Program\")\n\t\t},{\n\t\t\tfieldname: 'loyalty_points',\n\t\t\tlabel: __('Loyalty Points'),\n\t\t\tfieldtype: 'Data',\n\t\t\tread_only: 1\n\t\t}];\n\n\t\tconst me = this;\n\t\tdfs.forEach(df => {\n\t\t\tthis[`customer_${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\tdf: { ...df,\n\t\t\t\t\tonchange: handle_customer_field_change,\n\t\t\t\t},\n\t\t\t\tparent: $customer_form.find(`.${df.fieldname}-field`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`customer_${df.fieldname}_field`].set_value(this.customer_info[df.fieldname]);\n\t\t})\n\n\t\tfunction handle_customer_field_change() {\n\t\t\tconst current_value = me.customer_info[this.df.fieldname];\n\t\t\tconst current_customer = me.customer_info.customer;\n\n\t\t\tif (this.value && current_value != this.value && this.df.fieldname != 'loyalty_points') {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'posnext.posnext.page.posnext.point_of_sale.set_customer_info',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tfieldname: this.df.fieldname,\n\t\t\t\t\t\tcustomer: current_customer,\n\t\t\t\t\t\tvalue: this.value\n\t\t\t\t\t},\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\tme.customer_info[this.df.fieldname] = this.value;\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Customer contact updated successfully.\"),\n\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tfetch_customer_transactions() {\n\t\tfrappe.db.get_list('Sales Invoice', {\n\t\t\tfilters: { customer: this.customer_info.customer, docstatus: 1 },\n\t\t\tfields: ['name', 'grand_total', 'status', 'posting_date', 'posting_time', 'currency'],\n\t\t\tlimit: 20\n\t\t}).then((res) => {\n\t\t\tconst transaction_container = this.$customer_section.find('.customer-transactions');\n\n\t\t\tif (!res.length) {\n\t\t\t\ttransaction_container.html(\n\t\t\t\t\t`<div class=\"no-transactions-placeholder\">No recent transactions found</div>`\n\t\t\t\t)\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst elapsed_time = moment(res[0].posting_date+\" \"+res[0].posting_time).fromNow();\n\t\t\tthis.$customer_section.find('.customer-desc').html(`Last transacted ${elapsed_time}`);\n\n\t\t\tres.forEach(invoice => {\n\t\t\t\tconst posting_datetime = moment(invoice.posting_date+\" \"+invoice.posting_time).format(\"Do MMMM, h:mma\");\n\t\t\t\tlet indicator_color = {\n\t\t\t\t\t'Paid': 'green',\n\t\t\t\t\t'Draft': 'red',\n\t\t\t\t\t'Return': 'gray',\n\t\t\t\t\t'Consolidated': 'blue'\n\t\t\t\t};\n\n\t\t\t\ttransaction_container.append(\n\t\t\t\t\t`<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t\t\t<div class=\"invoice-total\">\n\t\t\t\t\t\t\t\t${format_currency(invoice.grand_total, invoice.currency, 0) || 0}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"invoice-status\">\n\t\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color[invoice.status]}\">\n\t\t\t\t\t\t\t\t\t<span>${invoice.status}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"seperator\"></div>`\n\t\t\t\t)\n\t\t\t});\n\t\t});\n\t}\n\n\tattach_refresh_field_event(frm) {\n\t\t$(frm.wrapper).off('refresh-fields');\n\t\t$(frm.wrapper).on('refresh-fields', () => {\n\t\t\tif (frm.doc.items.length) {\n\t\t\t\tthis.$cart_items_wrapper.html('');\n\t\t\t\tfrm.doc.items.forEach(item => {\n\t\t\t\t\tthis.update_item_html(item);\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.update_totals_section(frm);\n\t\t});\n\t}\n\n\tload_invoice() {\n\t\tconst frm = this.events.get_frm();\n\n\t\tthis.attach_refresh_field_event(frm);\n\n\t\tthis.fetch_customer_details(frm.doc.customer).then(() => {\n\t\t\tthis.events.customer_details_updated(this.customer_info);\n\t\t\tthis.update_customer_section();\n\t\t});\n\n\t\tthis.$cart_items_wrapper.html('');\n\t\tif (frm.doc.items.length) {\n\t\t\tfrm.doc.items.forEach(item => {\n\t\t\t\tthis.update_item_html(item);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.make_no_items_placeholder();\n\t\t\tthis.highlight_checkout_btn(true);\n\t\t}\n\n\t\tthis.update_totals_section(frm);\n\n\t\tif(frm.doc.docstatus === 1) {\n\t\t\tthis.$totals_section.find('.checkout-btn').css('display', 'none');\n\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'none');\n\t\t\tif(this.show_order_list_button){\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'flex');\n\t\t\t} else {\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'none');\n\t\t\t}\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'none');\n\t\t} else {\n\t\t\tif(this.show_checkout_button) {\n                this.$totals_section.find('.checkout-btn').css('display', 'flex');\n            } else {\n\t\t\t\t                this.$totals_section.find('.checkout-btn').css('display', 'none');\n\n\t\t\t}\n\t\t\tif(this.show_held_button){\n\t\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'flex');\n\t\t\t} else {\n\t\t\tthis.$totals_section.find('.checkout-btn-held').css('display', 'none');\n\t\t\t}\n\t\t\tif(this.show_order_list_button){\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'flex');\n\t\t\t} else {\n\t\t\t\tthis.$totals_section.find('.checkout-btn-order').css('display', 'none');\n\t\t\t}\n\t\t\tthis.$totals_section.find('.edit-cart-btn').css('display', 'none');\n\t\t}\n\n\t\tthis.toggle_component(true);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n\n}\n", "frappe.provide('posnext.PointOfSale');\nposnext.PointOfSale.ItemDetails = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.custom_edit_rate_and_uom = settings.custom_edit_rate_and_uom;\n\t\tthis.current_item = {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"item-details-container\" id=\"item-details-container\"></section>`\n\t\t)\n\n\t\tthis.$component = this.wrapper.find('.item-details-container');\n\t}\n\n\tinit_child_components() {\n\t\tthis.$component.html(\n\t\t\t`<div class=\"item-details-header\">\n\t\t\t\t<div class=\"label\">${__('Item Detailss')}</div>\n\t\t\t\t<div class=\"close-btn\">\n\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"item-display\">\n\t\t\t\t<div class=\"item-name-desc-price\">\n\t\t\t\t\t<div class=\"item-name\"></div>\n\t\t\t\t\t<div class=\"item-desc\"></div>\n\t\t\t\t\t<div class=\"item-price\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"item-image\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"discount-section\"></div>\n\t\t\t<div class=\"form-container\"></div>\n\t\t\t<div class=\"serial-batch-container\"></div>`\n\t\t)\n\n\t\tthis.$item_name = this.$component.find('.item-name');\n\t\tthis.$item_description = this.$component.find('.item-desc');\n\t\tthis.$item_price = this.$component.find('.item-price');\n\t\tthis.$item_image = this.$component.find('.item-image');\n\t\tthis.$form_container = this.$component.find('.form-container');\n\t\tthis.$dicount_section = this.$component.find('.discount-section');\n\t\tthis.$serial_batch_container = this.$component.find('.serial-batch-container');\n\t}\n\n\tcompare_with_current_item(item) {\n\t\t// returns true if `item` is currently being edited\n\t\treturn item && item.name == this.current_item.name;\n\t}\n\n\tasync toggle_item_details_section(item) {\n\t\tconst current_item_changed = !this.compare_with_current_item(item);\n\n\t\t// if item is null or highlighted cart item is clicked twice\n\t\tconst hide_item_details = !Boolean(item) || !current_item_changed;\n\n\t\tif ((!hide_item_details && current_item_changed) || hide_item_details) {\n\t\t\t// if item details is being closed OR if item details is opened but item is changed\n\t\t\t// in both cases, if the current item is a serialized item, then validate and remove the item\n\t\t\tawait this.validate_serial_batch_item();\n\t\t}\n\t\tif(!this.custom_edit_rate_and_uom){\n\t\t\tthis.events.toggle_item_selector(!hide_item_details);\n\t\t\tthis.toggle_component(!hide_item_details);\n\t\t}\n\n\n\t\tif (item && current_item_changed) {\n\t\t\tthis.doctype = item.doctype;\n\t\t\tthis.item_meta = frappe.get_meta(this.doctype);\n\t\t\tthis.name = item.name;\n\t\t\tthis.item_row = item;\n\t\t\tthis.currency = this.events.get_frm().doc.currency;\n\n\t\t\tthis.current_item = item;\n\n\t\t\tthis.render_dom(item);\n\t\t\tthis.render_discount_dom(item);\n\t\t\tthis.render_form(item);\n\t\t\tthis.events.highlight_cart_item(item);\n\t\t} else {\n\t\t\tthis.current_item = {};\n\t\t}\n\t}\n\n\tvalidate_serial_batch_item() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst item_row = doc.items.find(item => item.name === this.name);\n\n\t\tif (!item_row) return;\n\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_bundle_selected = !item_row.serial_and_batch_bundle;\n\n\t\tif ((serialized && no_bundle_selected) || (batched && no_bundle_selected)) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Item is removed since no serial / batch no selected.\"),\n\t\t\t\tindicator: 'orange'\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\treturn this.events.remove_item_from_cart();\n\t\t}\n\t}\n\n\trender_dom(item) {\n\t\tlet { item_name, description, image, price_list_rate } = item;\n\n\t\tfunction get_description_html() {\n\t\t\tif (description) {\n\t\t\t\tdescription = description.indexOf('...') === -1 && description.length > 140 ? description.substr(0, 139) + '...' : description;\n\t\t\t\treturn description;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tthis.$item_name.html(item_name);\n\t\tthis.$item_description.html(get_description_html());\n\t\tthis.$item_price.html(format_currency(price_list_rate, this.currency));\n\t\tif (!this.hide_images && image) {\n\t\t\tthis.$item_image.html(\n\t\t\t\t`<img\n\t\t\t\t\tonerror=\"cur_pos.item_details.handle_broken_image(this)\"\n\t\t\t\t\tclass=\"h-full\" src=\"${image}\"\n\t\t\t\t\talt=\"${frappe.get_abbr(item_name)}\"\n\t\t\t\t\tstyle=\"object-fit: cover;\">`\n\t\t\t);\n\t\t} else {\n\t\t\tthis.$item_image.html(`<div class=\"item-abbr\">${frappe.get_abbr(item_name)}</div>`);\n\t\t}\n\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr('alt');\n\t\t$($img).replaceWith(`<div class=\"item-abbr\">${item_abbr}</div>`);\n\t}\n\n\trender_discount_dom(item) {\n\t\tif (item.discount_percentage) {\n\t\t\tthis.$dicount_section.html(\n\t\t\t\t`<div class=\"item-rate\">${format_currency(item.price_list_rate, this.currency)}</div>\n\t\t\t\t<div class=\"item-discount\">${item.discount_percentage}% off</div>`\n\t\t\t)\n\t\t\tthis.$item_price.html(format_currency(item.rate, this.currency));\n\t\t} else {\n\t\t\tthis.$dicount_section.html(``)\n\t\t}\n\t}\n\n\trender_form(item) {\n\t\tconst fields_to_display = this.get_form_fields(item);\n\t\tthis.$form_container.html('');\n\n\t\tfields_to_display.forEach((fieldname, idx) => {\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"${fieldname}-control\" data-fieldname=\"${fieldname}\"></div>`\n\t\t\t)\n\n\t\t\tconst field_meta = this.item_meta.fields.find(df => df.fieldname === fieldname);\n\t\t\tfieldname === 'discount_percentage' ? (field_meta.label = __('Discount (%)')) : '';\n\t\t\tconst me = this;\n\t\t\tvar uoms = []\n\t\t\tfrappe.db.get_doc(\"Item\",me.current_item.item_code).then(doc => {\n\t\t\t\tuoms = doc.uoms.map(item => item.uom);\n\t\t\t})\n\t\t\tthis[`${fieldname}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\t...field_meta,\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tme.events.form_updated(me.current_item, fieldname, this.value);\n\t\t\t\t\t},\n\t\t\t\t\tget_query:function () {\n\t\t\t\t\t\tif(fieldname === 'uom'){\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\t\tname: ['in',uoms]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn\n                    }\n\t\t\t\t},\n\t\t\t\tparent: this.$form_container.find(`.${fieldname}-control`),\n\t\t\t\trender_input: true,\n\t\t\t})\n\t\t\tthis[`${fieldname}_control`].set_value(item[fieldname]);\n\t\t});\n\n\t\tthis.make_auto_serial_selection_btn(item);\n\n\t\tthis.bind_custom_control_change_event();\n\t}\n\n\tget_form_fields(item) {\n\t\tconst fields = ['qty', 'uom', 'rate', 'conversion_factor', 'discount_percentage', 'warehouse', 'actual_qty', 'price_list_rate'];\n\t\tif (item.has_serial_no) fields.push('serial_no');\n\t\tif (item.has_batch_no) fields.push('batch_no');\n\t\treturn fields;\n\t}\n\n\tmake_auto_serial_selection_btn(item) {\n\t\tif (item.has_serial_no || item.has_batch_no) {\n\t\t\tconst label = item.has_serial_no ? __('Select Serial No') : __('Select Batch No');\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"btn btn-sm btn-secondary auto-fetch-btn\">${label}</div>`\n\t\t\t);\n\t\t\tthis.$form_container.find('.serial_no-control').find('textarea').css('height', '6rem');\n\t\t}\n\t}\n\n\tbind_custom_control_change_event() {\n\t\tconst me = this;\n\t\tif (this.rate_control) {\n\t\t\tthis.rate_control.df.onchange = function() {\n\t\t\t\tif (this.value || flt(this.value) === 0) {\n\t\t\t\t\tme.events.form_updated(me.current_item, 'rate', this.value).then(() => {\n\t\t\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\t\t\tconst doc = me.events.get_frm().doc;\n\t\t\t\t\t\tme.$item_price.html(format_currency(item_row.rate, doc.currency));\n\t\t\t\t\t\tme.render_discount_dom(item_row);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.rate_control.df.read_only = !this.allow_rate_change;\n\t\t\tthis.rate_control.refresh();\n\t\t}\n\n\t\tif (this.discount_percentage_control && !this.allow_discount_change) {\n\t\t\tthis.discount_percentage_control.df.read_only = 1;\n\t\t\tthis.discount_percentage_control.refresh();\n\t\t}\n\n\t\tif (this.warehouse_control) {\n\t\t\tthis.warehouse_control.df.reqd = 1;\n\t\t\tthis.warehouse_control.df.onchange = function() {\n\t\t\t\tif (this.value) {\n\t\t\t\t\tme.events.form_updated(me.current_item, 'warehouse', this.value).then(() => {\n\t\t\t\t\t\tme.item_stock_map = me.events.get_item_stock_map();\n\t\t\t\t\t\tconst available_qty = me.item_stock_map[me.item_row.item_code][this.value][0];\n\t\t\t\t\t\tconst is_stock_item = Boolean(me.item_stock_map[me.item_row.item_code][this.value][1]);\n\t\t\t\t\t\tif (available_qty === undefined) {\n\t\t\t\t\t\t\tme.events.get_available_stock(me.item_row.item_code, this.value).then(() => {\n\t\t\t\t\t\t\t\t// item stock map is updated now reset warehouse\n\t\t\t\t\t\t\t\tme.warehouse_control.set_value(this.value);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t} else if (available_qty === 0 && is_stock_item) {\n\t\t\t\t\t\t\tme.warehouse_control.set_value('');\n\t\t\t\t\t\t\tconst bold_item_code = me.item_row.item_code.bold();\n\t\t\t\t\t\t\tconst bold_warehouse = this.value.bold();\n\t\t\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t\t\t__('Item Code: {0} is not available under warehouse {1}.', [bold_item_code, bold_warehouse])\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.actual_qty_control.set_value(available_qty);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.warehouse_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: { company: this.events.get_frm().doc.company }\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.warehouse_control.refresh();\n\t\t}\n\n\t\tif (this.serial_no_control) {\n\t\t\tthis.serial_no_control.df.reqd = 1;\n\t\t\tthis.serial_no_control.df.onchange = async function() {\n\t\t\t\t!me.current_item.batch_no && await me.auto_update_batch_no();\n\t\t\t\tme.events.form_updated(me.current_item, 'serial_no', this.value);\n\t\t\t}\n\t\t\tthis.serial_no_control.refresh();\n\t\t}\n\n\t\tif (this.batch_no_control) {\n\t\t\tthis.batch_no_control.df.reqd = 1;\n\t\t\tthis.batch_no_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tquery: 'erpnext.controllers.queries.get_batch_no',\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\titem_code: me.item_row.item_code,\n\t\t\t\t\t\twarehouse: me.item_row.warehouse,\n\t\t\t\t\t\tposting_date: me.events.get_frm().doc.posting_date\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.batch_no_control.refresh();\n\t\t}\n\n\t\tif (this.uom_control) {\n\t\t\tthis.uom_control.df.onchange = function() {\n\t\t\t\tme.events.form_updated(me.current_item, 'uom', this.value);\n\n\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\tme.conversion_factor_control.df.read_only = (item_row.stock_uom == this.value);\n\t\t\t\tme.conversion_factor_control.refresh();\n\t\t\t}\n\t\t}\n\n\t\tfrappe.model.on(\"POS Invoice Item\", \"*\", (fieldname, value, item_row) => {\n\t\t\tconst field_control = this[`${fieldname}_control`];\n\t\t\tconst item_row_is_being_edited = this.compare_with_current_item(item_row);\n\n\t\t\tif (item_row_is_being_edited && field_control && field_control.get_value() !== value) {\n\t\t\t\tfield_control.set_value(value);\n\t\t\t\tcur_pos.update_cart_html(item_row);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync auto_update_batch_no() {\n\t\tif (this.serial_no_control && this.batch_no_control) {\n\t\t\tconst selected_serial_nos = this.serial_no_control.get_value().split(`\\n`).filter(s => s);\n\t\t\tif (!selected_serial_nos.length) return;\n\n\t\t\t// find batch nos of the selected serial no\n\t\t\tconst serials_with_batch_no = await frappe.db.get_list(\"Serial No\", {\n\t\t\t\tfilters: { 'name': [\"in\", selected_serial_nos]},\n\t\t\t\tfields: [\"batch_no\", \"name\"]\n\t\t\t});\n\t\t\tconst batch_serial_map = serials_with_batch_no.reduce((acc, r) => {\n\t\t\t\tif (!acc[r.batch_no]) {\n\t\t\t\t\tacc[r.batch_no] = [];\n\t\t\t\t}\n\t\t\t\tacc[r.batch_no] = [...acc[r.batch_no], r.name];\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t\t// set current item's batch no and serial no\n\t\t\tconst batch_no = Object.keys(batch_serial_map)[0];\n\t\t\tconst batch_serial_nos = batch_serial_map[batch_no].join(`\\n`);\n\t\t\t// eg. 10 selected serial no. -> 5 belongs to first batch other 5 belongs to second batch\n\t\t\tconst serial_nos_belongs_to_other_batch = selected_serial_nos.length !== batch_serial_map[batch_no].length;\n\n\t\t\tconst current_batch_no = this.batch_no_control.get_value();\n\t\t\tcurrent_batch_no != batch_no && await this.batch_no_control.set_value(batch_no);\n\n\t\t\tif (serial_nos_belongs_to_other_batch) {\n\t\t\t\tthis.serial_no_control.set_value(batch_serial_nos);\n\t\t\t\tthis.qty_control.set_value(batch_serial_map[batch_no].length);\n\n\t\t\t\tdelete batch_serial_map[batch_no];\n\t\t\t\tthis.events.clone_new_batch_item_in_frm(batch_serial_map, this.current_item);\n\t\t\t}\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tthis.bind_auto_serial_fetch_event();\n\t\tthis.bind_fields_to_numpad_fields();\n\n\t\tthis.$component.on('click', '.close-btn', () => {\n\t\t\tthis.events.close_item_details();\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tthis.wrapper.find('.close-btn').attr(\"title\", \"Esc\");\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_details_visible = this.$component.is(\":visible\");\n\t\t\tif (item_details_visible) {\n\t\t\t\tthis.events.close_item_details();\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_fields_to_numpad_fields() {\n\t\tconst me = this;\n\t\tthis.$form_container.on('click', '.input-with-feedback', function() {\n\t\t\tconst fieldname = $(this).attr('data-fieldname');\n\t\t\tif (this.last_field_focused != fieldname) {\n\t\t\t\tme.events.item_field_focused(fieldname);\n\t\t\t\tthis.last_field_focused = fieldname;\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_auto_serial_fetch_event() {\n\t\tthis.$form_container.on('click', '.auto-fetch-btn', () => {\n\t\t\tfrappe.require(\"assets/erpnext/js/utils/serial_no_batch_selector.js\", () => {\n\t\t\t\tlet frm = this.events.get_frm();\n\t\t\t\tlet item_row = this.item_row;\n\t\t\t\titem_row.type_of_transaction = \"Outward\";\n\n\t\t\t\tnew erpnext.SerialBatchPackageSelector(frm, item_row, (r) => {\n\t\t\t\t\tif (r) {\n\t\t\t\t\t\tfrappe.model.set_value(item_row.doctype, item_row.name, {\n\t\t\t\t\t\t\t\"serial_and_batch_bundle\": r.name,\n\t\t\t\t\t\t\t\"qty\": Math.abs(r.total_qty)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t})\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n}\n", "frappe.provide('posnext.PointOfSale');\nposnext.PointOfSale.NumberPad = class {\n\tconstructor({ wrapper, events, cols, keys, css_classes, fieldnames_map }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.cols = cols;\n\t\tthis.keys = keys;\n\t\tthis.css_classes = css_classes || [];\n\t\tthis.fieldnames = fieldnames_map || {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tconst { cols, keys, css_classes, fieldnames } = this;\n\n\t\tfunction get_keys() {\n\t\t\treturn keys.reduce((a, row, i) => {\n\t\t\t\treturn a + row.reduce((a2, number, j) => {\n\t\t\t\t\tconst class_to_append = css_classes && css_classes[i] ? css_classes[i][j] : '';\n\t\t\t\t\tconst fieldname = fieldnames && fieldnames[number] ?\n\t\t\t\t\t\tfieldnames[number] : typeof number === 'string' ? frappe.scrub(number) : number;\n\n\t\t\t\t\treturn a2 + `<div class=\"numpad-btn ${class_to_append}\" data-button-value=\"${fieldname}\">${__(number)}</div>`;\n\t\t\t\t}, '');\n\t\t\t}, '');\n\t\t}\n\n\t\tthis.wrapper.html(\n\t\t\t`<div class=\"numpad-container\">\n\t\t\t\t${get_keys()}\n\t\t\t</div>`\n\t\t)\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tthis.wrapper.on('click', '.numpad-btn', function() {\n\t\t\tconst $btn = $(this);\n\t\t\tme.events.numpad_event($btn);\n\t\t});\n\t}\n}\n", "/* eslint-disable no-unused-vars */\nfrappe.provide('posnext.PointOfSale');\nposnext.PointOfSale.Payment = class {\n\tconstructor({ events, wrapper, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.custom_show_sales_man = settings.custom_show_sales_man\n\t\tthis.custom_show_additional_note = settings.custom_show_additional_note\n\t\tthis.custom_edit_rate = settings.custom_edit_rate_and_uom\n\t\tthis.custom_show_credit_sales = settings.custom_show_credit_sales\n\t\tthis.default_payment = settings.default_payment\n\t\tthis.current_payments = []\n\n\t\tthis.init_component();\n\t\t// this.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.initialize_numpad();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"payment-container\">\n\t\t\t\t<div class=\"section-label payment-section\">${__('Payment Method')}</div>\n\t\t\t\t<div class=\"payment-modes\"></div>\n\t\t\t\t<div class=\"fields-numpad-container\">\n\t\t\t\t\t<div class=\"fields-section\">\n\t\t\t\t\t\t<div class=\"section-label\">${__('Additional Information')}</div>\n\t\t\t\t\t\t<div class=\"invoice-fields\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"number-pad\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"totals-section\">\n\t\t\t\t\t<div class=\"totals\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"submit-order-btn\">${__(\"Complete Order\")}</div>\n\t\t\t</section>`\n\t\t);\n\t\tthis.$component = this.wrapper.find('.payment-container');\n\t\tthis.$payment_modes = this.$component.find('.payment-modes');\n\t\tthis.$totals_section = this.$component.find('.totals-section');\n\t\tthis.$totals = this.$component.find('.totals');\n\t\tthis.$numpad = this.$component.find('.number-pad');\n\t\tthis.$invoice_fields_section = this.$component.find('.fields-section');\n\t}\n\n\tmake_invoice_fields_control() {\n\t\t// frappe.db.get_doc(\"POS Settings\", undefined).then((doc) => {\n\t\t\tvar me = this\n\t\t\tconst fields = [];\n\t\t\tif(this.custom_show_credit_sales){\n\t\t\t\tfields.push({\n\t\t\t\t\tfieldname: \"custom_credit_sales\",\n\t\t\t\t\tlabel: \"Credit Sales\",\n\t\t\t\t\tfieldtype: \"Check\",\n\t\t\t\t})\n\t\t\t\t// fields.push({\n\t\t\t\t// \tfieldname: \"custom_credit_sales_date\",\n\t\t\t\t// \tlabel: \"Credit Sales Date\",\n\t\t\t\t// \tfieldtype: \"Date\"\n\t\t\t\t// })\n\t\t\t}\n\t\t\tif(this.custom_show_sales_man){\n\t\t\t\tfields.push({\n\t\t\t\t\tfieldname: \"sales_person\",\n\t\t\t\t\tlabel: \"Sales Man\",\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\toptions: \"Sales Person\",\n\t\t\t\t})\n\t\t\t}\n\t\t\tif(this.custom_show_additional_note){\n\t\t\t\tfields.push({\n\t\t\t\t\tfieldname: \"remarks\",\n\t\t\t\t\tlabel: \"Additional Note\",\n\t\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tif (!fields.length) return;\n\t\t\tthis.$invoice_fields = this.$invoice_fields_section.find('.invoice-fields');\n\t\t\tthis.$invoice_fields.html('');\n\t\t\tconst frm = this.events.get_frm();\n\t\t\tme.current_payments = frm.doc.payments\n\t\t\tfields.forEach(df => {\n\t\t\t\tthis.$invoice_fields.append(\n\t\t\t\t\t`<div class=\"invoice_detail_field ${df.fieldname}-field\" data-fieldname=\"${df.fieldname}\"></div>`\n\t\t\t\t);\n\t\t\t\tlet df_events = {\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tif(this.df.fieldname === 'sales_person'){\n\t\t\t\t\t\t\tfrm.clear_table(\"sales_team\")\n\t\t\t\t\t\t\tcur_frm.add_child(\"sales_team\", {\n\t\t\t\t\t\t\t\tsales_person: this.get_value(),\n\t\t\t\t\t\t\t\tallocated_percentage: 100,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif(this.df.fieldname === 'custom_credit_sales'){\n\t\t\t\t\t\t\t\t// $('input[data-fieldname=\"custom_credit_sales_date\"]').css(\"pointer-events\",this.get_value() ? \"\" : \"none\")\n\t\t\t\t\t\t\t\tif(this.get_value()){\n\t\t\t\t\t\t\t\t\t// $('input[data-fieldname=\"custom_credit_sales_date\"]').removeAttr('readonly')\n\n\t\t\t\t\t\t\t\t\tfrm.doc.payments.forEach(p => {\n\t\t\t\t\t\t\t\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\t\t\t\t\t\t\t\tme[`${mode}_control`].set_value(0);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tconsole.log(me.current_payments)\n\t\t\t\t\t\t\t\t\t// $('input[data-fieldname=\"custom_credit_sales_date\"]').attr('readonly', true);\n\t\t\t\t\t\t\t\t\tme.current_payments.forEach(p => {\n\t\t\t\t\t\t\t\t\t\tif(p.mode_of_payment === me.default_payment){\n\t\t\t\t\t\t\t\t\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\t\t\t\t\t\t\t\t\tme[`${mode}_control`].set_value(frm.doc.grand_total);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfrm.set_value(this.df.fieldname, this.get_value());\n\t\t\t\t\t\t}\n\t\t// \t\t\t\tif(this.df.fieldname === 'custom_credit_sales' && this.get_value()){\n\t\t// \t\t\t\t\tconsole.log(\"SELECTEEED MODE\")\n\t\t// console.log(me.$payment_modes)\n\t\t// \t\t\t\t\tthis.selected_mode.set_value(0);\n\t\t// \t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (df.fieldtype == \"Button\") {\n\t\t\t\t\tdf_events = {\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\tif (frm.script_manager.has_handlers(df.fieldname, frm.doc.doctype)) {\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger(df.fieldname, frm.doc.doctype, frm.doc.docname);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis[`${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\t...df,\n\t\t\t\t\t\t...df_events\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$invoice_fields.find(`.${df.fieldname}-field`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tif(df.fieldname !== 'remarks'){\n\t\t\t\t\tthis[`${df.fieldname}_field`].set_value(frm.doc[df.fieldname]);\n\t\t\t\t}\n\t\t\t\t// if(df.fieldname === 'custom_credit_sales_date'){\n\t\t\t\t// \tthis[`${df.fieldname}_field`].set_value(frappe.datetime.get_today());\n\t\t\t\t// }\n\t\t\t});\n\t\t// });\n\t}\n\n\tinitialize_numpad() {\n\t\tconst me = this;\n\t\tthis.number_pad = new posnext.PointOfSale.NumberPad({\n\t\t\twrapper: this.$numpad,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: function($btn) {\n\t\t\t\t\tme.on_numpad_clicked($btn);\n\t\t\t\t}\n\t\t\t},\n\t\t\tcols: 3,\n\t\t\tkeys: [\n\t\t\t\t[ 1, 2, 3 ],\n\t\t\t\t[ 4, 5, 6 ],\n\t\t\t\t[ 7, 8, 9 ],\n\t\t\t\t[ '.', 0, 'Delete' ]\n\t\t\t],\n\t\t});\n\n\t\tthis.numpad_value = '';\n\t}\n\n\ton_numpad_clicked($btn) {\n\t\tconst button_value = $btn.attr('data-button-value');\n\n\t\thighlight_numpad_btn($btn);\n\t\tthis.numpad_value = button_value === 'delete' ? this.numpad_value.slice(0, -1) : this.numpad_value + button_value;\n\t\tthis.selected_mode.$input.get(0).focus();\n\t\tthis.selected_mode.set_value(this.numpad_value);\n\n\t\tfunction highlight_numpad_btn($btn) {\n\t\t\t$btn.addClass('shadow-base-inner bg-selected');\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass('shadow-base-inner bg-selected');\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\n\t\tthis.$payment_modes.on('click', '.mode-of-payment', function(e) {\n\t\t\tconst mode_clicked = $(this);\n\t\t\t// if clicked element doesn't have .mode-of-payment class then return\n\t\t\tif (!$(e.target).is(mode_clicked)) return;\n\n\t\t\tconst scrollLeft = mode_clicked.offset().left - me.$payment_modes.offset().left + me.$payment_modes.scrollLeft();\n\t\t\tme.$payment_modes.animate({ scrollLeft });\n\n\t\t\tconst mode = mode_clicked.attr('data-mode');\n\n\t\t\t// hide all control fields and shortcuts\n\t\t\t$(`.mode-of-payment-control`).css('display', 'none');\n\t\t\t$(`.cash-shortcuts`).css('display', 'none');\n\t\t\tme.$payment_modes.find(`.pay-amount`).css('display', 'inline');\n\t\t\tme.$payment_modes.find(`.loyalty-amount-name`).css('display', 'none');\n\n\t\t\t// remove highlight from all mode-of-payments\n\t\t\t$('.mode-of-payment').removeClass('border-primary');\n\n\t\t\tif (mode_clicked.hasClass('border-primary')) {\n\t\t\t\t// clicked one is selected then unselect it\n\t\t\t\tmode_clicked.removeClass('border-primary');\n\t\t\t\tme.selected_mode = '';\n\t\t\t} else {\n\t\t\t\t// clicked one is not selected then select it\n\t\t\t\tmode_clicked.addClass('border-primary');\n\t\t\t\tmode_clicked.find('.mode-of-payment-control').css('display', 'flex');\n\t\t\t\tmode_clicked.find('.cash-shortcuts').css('display', 'grid');\n\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).css('display', 'none');\n\t\t\t\tme.$payment_modes.find(`.${mode}-name`).css('display', 'inline');\n\n\t\t\t\tme.selected_mode = me[`${mode}_control`];\n\t\t\t\tme.selected_mode && me.selected_mode.$input.get(0).focus();\n\t\t\t\tme.auto_set_remaining_amount();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'contact_mobile', (frm) => {\n\t\t\tconst contact = frm.doc.contact_mobile;\n\t\t\tconst request_button = $(this.request_for_payment_field?.$input[0]);\n\t\t\tif (contact) {\n\t\t\t\trequest_button.removeClass('btn-default').addClass('btn-primary');\n\t\t\t} else {\n\t\t\t\trequest_button.removeClass('btn-primary').addClass('btn-default');\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'coupon_code', (frm) => {\n\t\t\tif (frm.doc.coupon_code && !frm.applying_pos_coupon_code) {\n\t\t\t\tif (!frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrm.applying_pos_coupon_code = true;\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frm.doc.ignore_pricing_rule=1,\n\t\t\t\t\t\t() => frm.trigger('ignore_pricing_rule'),\n\t\t\t\t\t\t() => frm.doc.ignore_pricing_rule=0,\n\t\t\t\t\t\t() => frm.trigger('apply_pricing_rule'),\n\t\t\t\t\t\t() => frm.save(),\n\t\t\t\t\t\t() => this.update_totals_section(frm.doc),\n\t\t\t\t\t\t() => (frm.applying_pos_coupon_code = false)\n\t\t\t\t\t]);\n\t\t\t\t} else if (frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Ignore Pricing Rule is enabled. Cannot apply coupon code.\"),\n\t\t\t\t\t\tindicator: \"orange\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_listener_for_payments();\n\n\t\tthis.$payment_modes.on('click', '.shortcut', function() {\n\t\t\tconst value = $(this).attr('data-value');\n\t\t\tme.selected_mode.set_value(value);\n\t\t});\n\n\t\tthis.$component.on('click', '.submit-order-btn', () => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tlet paid_amount = doc.paid_amount\n\t\t\tif(cur_frm.doc.custom_credit_sales && this.custom_show_credit_sales){\n\t\t\t\tcur_frm.clear_table(\"payments\")\n\t\t\t\tpaid_amount = 0;\n\t\t\t}\n\n\t\t\tconst items = doc.items;\n\n\t\t\tif ((paid_amount == 0 || !items.length) && !this.custom_show_credit_sales) {\n\t\t\t\tconst message = items.length ? __(\"You cannot submit the order without payment.\") : __(\"You cannot submit empty order.\");\n\t\t\t\tfrappe.show_alert({ message, indicator: \"orange\" });\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.events.submit_invoice();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'paid_amount', (frm) => {\n\t\t\tthis.update_totals_section(frm.doc);\n\n\t\t\t// need to re calculate cash shortcuts after discount is applied\n\t\t\tconst is_cash_shortcuts_invisible = !this.$payment_modes.find('.cash-shortcuts').is(':visible');\n\t\t\tthis.attach_cash_shortcuts(frm.doc);\n\t\t\t!is_cash_shortcuts_invisible && this.$payment_modes.find('.cash-shortcuts').css('display', 'grid');\n\t\t\tthis.render_payment_mode_dom();\n\t\t});\n\n\t\tfrappe.ui.form.on('POS Invoice', 'loyalty_amount', (frm) => {\n\t\t\tconst formatted_currency = format_currency(frm.doc.loyalty_amount, frm.doc.currency);\n\t\t\tthis.$payment_modes.find(`.loyalty-amount-amount`).html(formatted_currency);\n\t\t});\n\n\t\tfrappe.ui.form.on(\"Sales Invoice Payment\", \"amount\", (frm, cdt, cdn) => {\n\t\t\t// for setting correct amount after loyalty points are redeemed\n\t\t\tconst default_mop = locals[cdt][cdn];\n\t\t\tconst mode = default_mop.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (this[`${mode}_control`] && this[`${mode}_control`].get_value() != default_mop.amount) {\n\t\t\t\tthis[`${mode}_control`].set_value(default_mop.amount);\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_listener_for_payments() {\n\t\tfrappe.realtime.on(\"process_phone_payment\", (data) => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst { response, amount, success, failure_message } = data;\n\t\t\tlet message, title;\n\n\t\t\tif (success) {\n\t\t\t\ttitle = __(\"Payment Received\");\n\t\t\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\t\t\tif (amount >= grand_total) {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\tmessage = __(\"Payment of {0} received successfully.\", [format_currency(amount, doc.currency, 0)]);\n\t\t\t\t\tthis.events.submit_invoice();\n\t\t\t\t\tcur_frm.reload_doc();\n\n\t\t\t\t} else {\n\t\t\t\t\tmessage = __(\"Payment of {0} received successfully. Waiting for other requests to complete...\", [format_currency(amount, doc.currency, 0)]);\n\t\t\t\t}\n\t\t\t} else if (failure_message) {\n\t\t\t\tmessage = failure_message;\n\t\t\t\ttitle = __(\"Payment Failed\");\n\t\t\t}\n\n\t\t\tfrappe.msgprint({ \"message\": message, \"title\": title });\n\t\t});\n\t}\n\n\tauto_set_remaining_amount() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst remaining_amount = grand_total - doc.paid_amount;\n\t\tconst current_value = this.selected_mode ? this.selected_mode.get_value() : undefined;\n\t\tif (!current_value && remaining_amount > 0 && this.selected_mode) {\n\t\t\tthis.selected_mode.set_value(remaining_amount);\n\t\t}\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.$component.find('.submit-order-btn').attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\tconst active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\tif (payment_is_visible && active_mode.length) {\n\t\t\t\tthis.$component.find('.submit-order-btn').click();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"tab\",\n\t\t\taction: () => {\n\t\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\t\tlet active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\t\tactive_mode = active_mode.length ? active_mode.attr(\"data-mode\") : undefined;\n\n\t\t\t\tif (!active_mode) return;\n\n\t\t\t\tconst mode_of_payments = Array.from(this.$payment_modes.find(\".mode-of-payment\")).map(m => $(m).attr(\"data-mode\"));\n\t\t\t\tconst mode_index = mode_of_payments.indexOf(active_mode);\n\t\t\t\tconst next_mode_index = (mode_index + 1) % mode_of_payments.length;\n\t\t\t\tconst next_mode_to_be_clicked = this.$payment_modes.find(`.mode-of-payment[data-mode=\"${mode_of_payments[next_mode_index]}\"]`);\n\n\t\t\t\tif (payment_is_visible && mode_index != next_mode_index) {\n\t\t\t\t\tnext_mode_to_be_clicked.click();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcondition: () => this.$component.is(':visible') && this.$payment_modes.find(\".border-primary\").length,\n\t\t\tdescription: __(\"Switch Between Payment Modes\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t}\n\n\ttoggle_numpad() {\n\t\t// pass\n\t}\n\n\trender_payment_section() {\n\t\tthis.render_payment_mode_dom();\n\t\tthis.make_invoice_fields_control();\n\t\tthis.update_totals_section();\n\t\tthis.focus_on_default_mop();\n\t}\n\n\tafter_render() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrm.script_manager.trigger(\"after_payment_render\", frm.doc.doctype, frm.doc.docname);\n\t}\n\n\tedit_cart() {\n\t\tif(this.custom_edit_rate){\n\t\t\tconst div = document.getElementById(\"customer-cart-container2\");\n\t\t\tdiv.style.gridColumn = \"span 5 / span 5\";\n\t\t}\n\n\t\tthis.events.toggle_other_sections(false);\n\t\tthis.toggle_component(false);\n\t}\n\n\tcheckout() {\n\t\tthis.events.toggle_other_sections(true);\n\t\tthis.toggle_component(true);\n\n\t\tthis.render_payment_section();\n\t\tthis.after_render();\n\t}\n\n\ttoggle_remarks_control() {\n\t\tif (this.$remarks.find('.frappe-control').length) {\n\t\t\tthis.$remarks.html('+ Add Remark');\n\t\t} else {\n\t\t\tthis.$remarks.html('');\n\t\t\tthis[`remark_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __('Remark'),\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tonchange: function() {}\n\t\t\t\t},\n\t\t\t\tparent: this.$totals_section.find(`.remarks`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`remark_control`].set_value('');\n\t\t}\n\t}\n\n\trender_payment_mode_dom() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tconst currency = doc.currency;\n\n\t\tthis.$payment_modes.html(`${\n\t\t\tpayments.map((p, i) => {\n\t\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\t\tconst payment_type = p.type;\n\t\t\t\tconst margin = i % 2 === 0 ? 'pr-2' : 'pl-2';\n\t\t\t\tconst amount = p.amount > 0 ? format_currency(p.amount, currency) : '';\n\n\t\t\t\treturn (`\n\t\t\t\t\t<div class=\"payment-mode-wrapper\">\n\t\t\t\t\t\t<div class=\"mode-of-payment\" data-mode=\"${mode}\" data-payment-type=\"${payment_type}\">\n\t\t\t\t\t\t\t${p.mode_of_payment}\n\t\t\t\t\t\t\t<div class=\"${mode}-amount pay-amount\">${amount}</div>\n\t\t\t\t\t\t\t<div class=\"${mode} mode-of-payment-control\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`);\n\t\t\t}).join('')\n\t\t}`);\n\t\tthis.current_payments = payments\n\t\tpayments.forEach(p => {\n\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tconst me = this;\n\t\t\tthis[`${mode}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: p.mode_of_payment,\n\t\t\t\t\tfieldtype: 'Currency',\n\t\t\t\t\tplaceholder: __('Enter {0} amount.', [p.mode_of_payment]),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconsole.log(p.doctype)\n\t\t\t\t\t\tconsole.log(p.name)\n\t\t\t\t\t\tconst current_value = frappe.model.get_value(p.doctype, p.name, 'amount');\n\t\t\t\t\t\tif (current_value != this.value) {\n\t\t\t\t\t\t\tfrappe.model\n\t\t\t\t\t\t\t\t.set_value(p.doctype, p.name, 'amount', flt(this.value))\n\t\t\t\t\t\t\t\t.then(() => me.update_totals_section())\n\n\t\t\t\t\t\t\tconst formatted_currency = format_currency(this.value, currency);\n\t\t\t\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).html(formatted_currency);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tparent: this.$payment_modes.find(`.${mode}.mode-of-payment-control`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`${mode}_control`].toggle_label(false);\n\t\t\tthis[`${mode}_control`].set_value(p.amount);\n\t\t});\n\n\t\tthis.render_loyalty_points_payment_mode();\n\n\t\tthis.attach_cash_shortcuts(doc);\n\t}\n\n\tfocus_on_default_mop() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tpayments.forEach(p => {\n\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (p.default) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.$payment_modes.find(`.${mode}.mode-of-payment-control`).parent().click();\n\t\t\t\t}, 500);\n\t\t\t}\n\t\t});\n\t}\n\n\tattach_cash_shortcuts(doc) {\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst currency = doc.currency;\n\n\t\tconst shortcuts = this.get_cash_shortcuts(flt(grand_total));\n\n\t\tthis.$payment_modes.find('.cash-shortcuts').remove();\n\t\tlet shortcuts_html = shortcuts.map(s => {\n\t\t\treturn `<div class=\"shortcut\" data-value=\"${s}\">${format_currency(s, currency, 0)}</div>`;\n\t\t}).join('');\n\n\t\tthis.$payment_modes.find('[data-payment-type=\"Cash\"]').find('.mode-of-payment-control')\n\t\t\t.after(`<div class=\"cash-shortcuts\">${shortcuts_html}</div>`);\n\t}\n\n\tget_cash_shortcuts(grand_total) {\n\t\tlet steps = [1, 5, 10];\n\t\tconst digits = String(Math.round(grand_total)).length;\n\n\t\tsteps = steps.map(x => x * (10 ** (digits - 2)));\n\n\t\tconst get_nearest = (amount, x) => {\n\t\t\tlet nearest_x = Math.ceil((amount / x)) * x;\n\t\t\treturn nearest_x === amount ? nearest_x + x : nearest_x;\n\t\t};\n\n\t\treturn steps.reduce((finalArr, x) => {\n\t\t\tlet nearest_x = get_nearest(grand_total, x);\n\t\t\tnearest_x = finalArr.indexOf(nearest_x) != -1 ? nearest_x + x : nearest_x;\n\t\t\treturn [...finalArr, nearest_x];\n\t\t}, []);\n\t}\n\n\trender_loyalty_points_payment_mode() {\n\t\tconst me = this;\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst { loyalty_program, loyalty_points, conversion_factor } = this.events.get_customer_details();\n\n\t\tthis.$payment_modes.find(`.mode-of-payment[data-mode=\"loyalty-amount\"]`).parent().remove();\n\n\t\tif (!loyalty_program) return;\n\n\t\tlet description, read_only, max_redeemable_amount;\n\t\tif (!loyalty_points) {\n\t\t\tdescription = __(\"You don't have enough points to redeem.\");\n\t\t\tread_only = true;\n\t\t} else {\n\t\t\tmax_redeemable_amount = flt(flt(loyalty_points) * flt(conversion_factor), precision(\"loyalty_amount\", doc));\n\t\t\tdescription = __(\"You can redeem upto {0}.\", [format_currency(max_redeemable_amount)]);\n\t\t\tread_only = false;\n\t\t}\n\n\t\tconst margin = this.$payment_modes.children().length % 2 === 0 ? 'pr-2' : 'pl-2';\n\t\tconst amount = doc.loyalty_amount > 0 ? format_currency(doc.loyalty_amount, doc.currency) : '';\n\t\tthis.$payment_modes.append(\n\t\t\t`<div class=\"payment-mode-wrapper\">\n\t\t\t\t<div class=\"mode-of-payment loyalty-card\" data-mode=\"loyalty-amount\" data-payment-type=\"loyalty-amount\">\n\t\t\t\t\tRedeem Loyalty Points\n\t\t\t\t\t<div class=\"loyalty-amount-amount pay-amount\">${amount}</div>\n\t\t\t\t\t<div class=\"loyalty-amount-name\">${loyalty_program}</div>\n\t\t\t\t\t<div class=\"loyalty-amount mode-of-payment-control\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\n\t\tthis['loyalty-amount_control'] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Redeem Loyalty Points\"),\n\t\t\t\tfieldtype: 'Currency',\n\t\t\t\tplaceholder: __(\"Enter amount to be redeemed.\"),\n\t\t\t\toptions: 'company:currency',\n\t\t\t\tread_only,\n\t\t\t\tonchange: async function() {\n\t\t\t\t\tif (!loyalty_points) return;\n\n\t\t\t\t\tif (this.value > max_redeemable_amount) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"You cannot redeem more than {0}.\", [format_currency(max_redeemable_amount)]),\n\t\t\t\t\t\t\tindicator: \"red\"\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\tme['loyalty-amount_control'].set_value(0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst redeem_loyalty_points = this.value > 0 ? 1 : 0;\n\t\t\t\t\tawait frappe.model.set_value(doc.doctype, doc.name, 'redeem_loyalty_points', redeem_loyalty_points);\n\t\t\t\t\tfrappe.model.set_value(doc.doctype, doc.name, 'loyalty_points', parseInt(this.value / conversion_factor));\n\t\t\t\t},\n\t\t\t\tdescription\n\t\t\t},\n\t\t\tparent: this.$payment_modes.find(`.loyalty-amount.mode-of-payment-control`),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis['loyalty-amount_control'].toggle_label(false);\n\n\t\t// this.render_add_payment_method_dom();\n\t}\n\n\trender_add_payment_method_dom() {\n\t\tconst docstatus = this.events.get_frm().doc.docstatus;\n\t\tif (docstatus === 0)\n\t\t\tthis.$payment_modes.append(\n\t\t\t\t`<div class=\"w-full pr-2\">\n\t\t\t\t\t<div class=\"add-mode-of-payment w-half text-grey mb-4 no-select pointer\">+ Add Payment Method</div>\n\t\t\t\t</div>`\n\t\t\t);\n\t}\n\n\tupdate_totals_section(doc) {\n\t\tif (!doc) doc = this.events.get_frm().doc;\n\t\t// doc.paid_amount = doc.grand_total\n\t\t\tconst paid_amount = doc.paid_amount;\n\n\t\tif(cur_frm.doc.custom_credit_sales){\n\t\t\tconst paid_amount = 0\n\t\t}\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total) ? doc.grand_total : doc.rounded_total;\n\t\tconst remaining = grand_total - doc.paid_amount;\n\t\tconst change = doc.change_amount || remaining <= 0 ? -1 * remaining : undefined;\n\t\tconst currency = doc.currency;\n\t\tconst label = change ? __('Change') : __('To Be Paid');\n\n\t\tthis.$totals.html(\n\t\t\t`<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${__('Grand Total')}</div>\n\t\t\t\t<div class=\"value\">${format_currency(grand_total, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${__('Paid Amount')}</div>\n\t\t\t\t<div class=\"value\">${format_currency(paid_amount, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${label}</div>\n\t\t\t\t<div class=\"value\">${format_currency(change || remaining, currency)}</div>\n\t\t\t</div>`\n\t\t);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\t}\n};\n", "frappe.provide('posnext.PointOfSale');\nvar invoicess = []\nposnext.PointOfSale.PastOrderList = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.pos_profile = settings.name\n\t\tthis.custom_filter_order_list_by_profile = settings.custom_filter_order_list_by_profile\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.make_filter_section();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-list\">\n\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t<div class=\"label back\" style=\"font-size: 13px \">\n\t\t\t\t\t\t<a>\n\t\t\t\t\t\t\t<svg class=\"es-line\" style=\"width: 13px;height: 13px\">\n\t\t\t\t\t\t\t\t<use class=\"\" href=\"#es-line-left-chevron\"></use></svg> Back\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<br>\n\t\t\t\t\t<div class=\"label\">${__('Recent Orders')}</div>\n\t\t\t\t\t<div class=\"search-field\"></div>\n\t\t\t\t\t<div class=\"status-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoices-container\"></div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.past-order-list');\n\t\tthis.$invoices_container = this.$component.find('.invoices-container');\n\n\t}\n\n\tbind_events() {\n\t\tthis.search_field.$input.on('input', (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tthis.refresh_list(search_term, this.status_field.get_value());\n\t\t\t}, 300);\n\t\t});\n\t\tconst me = this;\n\t\tthis.$invoices_container.on('click', '.invoice-wrapper', function() {\n\t\t\tconst invoice_name = unescape($(this).attr('data-invoice-name'));\n\t\t\tme.events.open_invoice_data(invoice_name);\n\t\t});\n\t\tthis.$component.on('click', '.back', function() {\n\t\t\tme.events.previous_screen()\n\t\t});\n\t}\n\n\tmake_filter_section() {\n\t\tconst me = this;\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Search'),\n\t\t\t\tfieldtype: 'Data',\n\t\t\t\tplaceholder: __('Search by invoice id or customer name')\n\t\t\t},\n\t\t\tparent: this.$component.find('.search-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.status_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __('Invoice Status'),\n\t\t\t\tfieldtype: 'Select',\n\t\t\t\toptions: `Draft\\nPaid\\nUnpaid\\nReturn`,\n\t\t\t\tplaceholder: __('Filter by invoice status'),\n\t\t\t\tonchange: function() {\n\t\t\t\t\tif (me.$component.is(':visible')) me.refresh_list();\n\t\t\t\t}\n\t\t\t},\n\t\t\tparent: this.$component.find('.status-field'),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.search_field.toggle_label(false);\n\t\tthis.status_field.toggle_label(false);\n\t\tthis.status_field.set_value('Draft');\n\t}\n\n\trefresh_list() {\n\t\tfrappe.dom.freeze();\n\t\tthis.events.reset_summary();\n\t\tconst search_term = this.search_field.get_value();\n\t\tconst status = this.status_field.get_value();\n\t\tconst pos_profile = this.pos_profile;\n\t\tthis.$invoices_container.html('');\n\t\tlet filter = { search_term, status };\n\t\tif(this.custom_filter_order_list_by_profile){\n\t\t\tfilter = { search_term, status, pos_profile }\n\t\t}\n\t\t\n\t\treturn frappe.call({\n\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.get_past_order_list\",\n\t\t\tfreeze: true,\n\t\t\targs: filter,\n\t\t\tcallback: (response) => {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tinvoicess = response.message\n\t\t\t\tresponse.message.forEach(invoice => {\n\t\t\t\t\tconst invoice_html = this.get_invoice_html(invoice);\n\t\t\t\t\tthis.$invoices_container.append(invoice_html);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t}\n\n\tget_invoice_html(invoice) {\n\t\tconst posting_datetime = moment(invoice.posting_date+\" \"+invoice.posting_time).format(\"Do MMMM, h:mma\");\n\t\treturn (\n\t\t\t`<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t\t\t\t<div class=\"invoice-date\">\n\t\t\t\t\t\t<svg class=\"mr-2\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n\t\t\t\t\t\t\t<path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"/><circle cx=\"12\" cy=\"7\" r=\"4\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t${frappe.ellipsis(invoice.customer, 20)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t<div class=\"invoice-total\">${format_currency(invoice.grand_total, invoice.currency, 0) || 0}</div>\n\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator\"></div>`\n\t\t);\n\t}\n\n\ttoggle_component(show) {\n\t\tfrappe.run_serially([\n\t\t\t() => show ? this.$component.css('display', 'flex') && this.refresh_list() : this.$component.css('display', 'none'),\n\t\t\t() => this.events.open_invoice_data(invoicess[0].name)\n\t\t])\n\n\n\n\t}\n};\n", "frappe.provide('posnext.PointOfSale');\nposnext.PointOfSale.PastOrderSummary = class {\n\tconstructor({ wrapper, pos_profile,events }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.pos_profile = pos_profile;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_email_print_dialog();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-summary\">\n\t\t\t\t<div class=\"no-summary-placeholder\">\n\t\t\t\t\t${__('Select an invoice to load summary data')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-summary-wrapper\" >\n\t\t\t\t\t<div class=\"abs-container\" >\n\t\t\t\t\t\t<div class=\"upper-section\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Items')}</div>\n\t\t\t\t\t\t<div class=\"items-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Totals')}</div>\n\t\t\t\t\t\t<div class=\"totals-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__('Payments')}</div>\n\t\t\t\t\t\t<div class=\"payments-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"summary-btns\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find('.past-order-summary');\n\t\tthis.$summary_wrapper = this.$component.find('.invoice-summary-wrapper');\n\t\tthis.$summary_container = this.$component.find('.abs-container');\n\t\tthis.$upper_section = this.$summary_container.find('.upper-section');\n\t\tthis.$items_container = this.$summary_container.find('.items-container');\n\t\tthis.$totals_container = this.$summary_container.find('.totals-container');\n\t\tthis.$payment_container = this.$summary_container.find('.payments-container');\n\t\tthis.$summary_btns = this.$summary_container.find('.summary-btns');\n\t}\n\n\tinit_email_print_dialog() {\n\t\tconst email_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Email Receipt',\n\t\t\tfields: [\n\t\t\t\t{fieldname: 'email_id', fieldtype: 'Data', options: 'Email', label: 'Email ID', reqd: 1},\n\t\t\t\t{fieldname:'content', fieldtype:'Small Text', label:'Message (if any)'}\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.send_email();\n\t\t\t},\n\t\t\tprimary_action_label: __('Send'),\n\t\t});\n\t\tthis.email_dialog = email_dialog;\n\n\t\tconst print_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Print Receipt',\n\t\t\tfields: [\n\t\t\t\t{fieldname: 'print', fieldtype: 'Data', label: 'Print Preview'}\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.print_receipt();\n\t\t\t},\n\t\t\tprimary_action_label: __('Print'),\n\t\t});\n\t\tthis.print_dialog = print_dialog;\n\t}\n\n\tget_upper_section_html(doc) {\n\t\tconst { status } = doc;\n\t\tlet indicator_color = '';\n\n\t\tin_list(['Paid', 'Consolidated'], status) && (indicator_color = 'green');\n\t\tstatus === 'Draft' && (indicator_color = 'red');\n\t\tstatus === 'Return' && (indicator_color = 'grey');\n\n\t\treturn `<div class=\"left-section\">\n\t\t\t\t\t<div class=\"customer-name\">${doc.customer}</div>\n\t\t\t\t\t<div class=\"customer-email\">${this.customer_email}</div>\n\t\t\t\t\t<div class=\"cashier\">${__('Sold by')}: ${doc.owner}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"right-section\">\n\t\t\t\t\t<div class=\"paid-amount\">${format_currency(doc.paid_amount, doc.currency)}</div>\n\t\t\t\t\t<div class=\"invoice-name\">${doc.name}</div>\n\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\"><span>${doc.status}</span></span>\n\t\t\t\t</div>`;\n\t}\n\n\tget_item_html(doc, item_data) {\n\t\treturn `<div class=\"item-row-wrapper\">\n\t\t\t\t\t<div class=\"item-name\">${item_data.item_name}</div>\n\t\t\t\t\t<div class=\"item-qty\">${item_data.qty || 0} ${item_data.uom}</div>\n\t\t\t\t\t<div class=\"item-rate-disc\">${get_rate_discount_html()}</div>\n\t\t\t\t</div>`;\n\n\t\tfunction get_rate_discount_html() {\n\t\t\tif (item_data.rate && item_data.price_list_rate && item_data.rate !== item_data.price_list_rate) {\n\t\t\t\treturn `<span class=\"item-disc\">(${item_data.discount_percentage}% off)</span>\n\t\t\t\t\t\t<div class=\"item-rate\">${format_currency(item_data.rate, doc.currency)}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-rate\">${format_currency(item_data.price_list_rate || item_data.rate, doc.currency)}</div>`;\n\t\t\t}\n\t\t}\n\t}\n\n\tget_discount_html(doc) {\n\t\tif (doc.discount_amount) {\n\t\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t\t<div>Discount (${doc.additional_discount_percentage} %)</div>\n\t\t\t\t\t\t<div>${format_currency(doc.discount_amount, doc.currency)}</div>\n\t\t\t\t\t</div>`;\n\t\t} else {\n\t\t\treturn ``;\n\t\t}\n\t}\n\n\tget_net_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t<div>${__('Net Total')}</div>\n\t\t\t\t\t<div>${format_currency(doc.net_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_taxes_html(doc) {\n\t\tif (!doc.taxes.length) return '';\n\n\t\tlet taxes_html = doc.taxes.map(t => {\n\t\t\t// if tax rate is 0, don't print it.\n\t\t\tconst description = /[0-9]+/.test(t.description) ? t.description : ((t.rate != 0) ? `${t.description} @ ${t.rate}%`: t.description);\n\t\t\treturn `\n\t\t\t\t<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, doc.currency)}</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}).join('');\n\n\t\treturn `<div class=\"taxes-wrapper\">${taxes_html}</div>`;\n\t}\n\n\tget_grand_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper grand-total\">\n\t\t\t\t\t<div>${__('Grand Total')}</div>\n\t\t\t\t\t<div>${format_currency(doc.grand_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_payment_html(doc, payment) {\n\t\treturn `<div class=\"summary-row-wrapper payments\">\n\t\t\t\t\t<div>${__(payment.mode_of_payment)}</div>\n\t\t\t\t\t<div>${format_currency(payment.amount, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tbind_events() {\n\t\tthis.$summary_container.on('click', '.return-btn', () => {\n\t\t\tthis.events.process_return(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.edit-btn', () => {\n\t\t\tthis.events.edit_order(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.delete-btn', () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.send-btn', () => {\n\t\t\t// this.events.delete_order(this.doc.name);\n\t\t\t// this.show_summary_placeholder();\n\t\tconsole.log(this.pos_profile)\n\t\tvar field_names = this.pos_profile.custom_whatsapp_field_names.map(x => this.doc[x.field_names.toString()]);\n\t\t\tconsole.log(field_names)\n\t\t\tconsole.log(field_names.join(\",\"))\n\t\t\tvar message = \"https://wa.me/\" +  this.doc.customer +\"?text=\"\n\t\t\tmessage += formatString(this.pos_profile.custom_whatsapp_message, field_names);\n\t\t\tconsole.log(message)\n\t\t\t// message += \"Hello, here is the file you requested.\"\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"posnext.posnext.page.posnext.point_of_sale.generate_pdf_and_save\",\n\t\t\t\targs: {\n\t\t\t\t\tdocname: this.doc.name,\n\t\t\t\t\tdoctype: this.doc.doctype,\n\t\t\t\t\tprint_format: this.pos_profile.print_format\n\t\t\t\t},\n\t\t\t\tfreeze: true,\n\t\t\t\tfreeze_message: \"Creating file then send to whatsapp thru link....\",\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tmessage += \"Please Find your invoice here \\n \"+window.origin+r.message.file_url\n\t\t\t\t\twindow.open(message)\n                }\n\t\t\t})\n\t\t\t// this.toggle_component(false);\n\t\t\t// this.$component.find('.no-summary-placeholder').removeClass('d-none');\n\t\t\t// this.$summary_wrapper.addClass('d-none');\n\t\t});\n\t\tfunction formatString(str, args) {\n\t\t\treturn str.replace(/{(\\d+)}/g, function(match, number) {\n\t\t\t\treturn typeof args[number] !== 'undefined'\n\t\t\t\t\t? args[number]\n\t\t\t\t\t: match;\n\t\t\t});\n\t\t}\n\n\t\tthis.$summary_container.on('click', '.new-btn', () => {\n\t\t\tthis.events.new_order();\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.email-btn', () => {\n\t\t\tthis.email_dialog.fields_dict.email_id.set_value(this.customer_email);\n\t\t\tthis.email_dialog.show();\n\t\t});\n\n\t\tthis.$summary_container.on('click', '.print-btn', () => {\n\t\t\tthis.print_receipt();\n\t\t});\n\t}\n\n\tprint_receipt() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrappe.utils.print(\n\t\t\tthis.doc.doctype,\n\t\t\tthis.doc.name,\n\t\t\tfrm.pos_print_format,\n\t\t\tthis.doc.letter_head,\n\t\t\tthis.doc.language || frappe.boot.lang\n\t\t);\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? '\u2318' : 'Ctrl';\n\t\tthis.$summary_container.find('.print-btn').attr(\"title\", `${ctrl_label}+P`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+p\",\n\t\t\taction: () => this.$summary_container.find('.print-btn').click(),\n\t\t\tcondition: () => this.$component.is(':visible') && this.$summary_container.find('.print-btn').is(\":visible\"),\n\t\t\tdescription: __(\"Print Receipt\"),\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t\tthis.$summary_container.find('.new-btn').attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst summary_is_visible = this.$component.is(\":visible\");\n\t\t\tif (summary_is_visible && this.$summary_container.find('.new-btn').is(\":visible\")) {\n\t\t\t\tthis.$summary_container.find('.new-btn').click();\n\t\t\t}\n\t\t});\n\t\tthis.$summary_container.find('.edit-btn').attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+e\",\n\t\t\taction: () => this.$summary_container.find('.edit-btn').click(),\n\t\t\tcondition: () => this.$component.is(':visible') && this.$summary_container.find('.edit-btn').is(\":visible\"),\n\t\t\tdescription: __(\"Edit Receipt\"),\n\t\t\tpage: cur_page.page.page\n\t\t});\n\t}\n\n\tsend_email() {\n\t\tconst frm = this.events.get_frm();\n\t\tconst recipients = this.email_dialog.get_values().email_id;\n\t\tconst content = this.email_dialog.get_values().content;\n\t\tconst doc = this.doc || frm.doc;\n\t\tconst print_format = frm.pos_print_format;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.communication.email.make\",\n\t\t\targs: {\n\t\t\t\trecipients: recipients,\n\t\t\t\tsubject: __(frm.meta.name) + ': ' + doc.name,\n\t\t\t\tcontent: content ? content : __(frm.meta.name) + ': ' + doc.name,\n\t\t\t\tdoctype: doc.doctype,\n\t\t\t\tname: doc.name,\n\t\t\t\tsend_email: 1,\n\t\t\t\tprint_format,\n\t\t\t\tsender_full_name: frappe.user.full_name(),\n\t\t\t\t_lang: doc.language\n\t\t\t},\n\t\t\tcallback: r => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.utils.play_sound(\"email\");\n\t\t\t\t\tif (r.message[\"emails_not_sent_to\"]) {\n\t\t\t\t\t\tfrappe.msgprint(__(\n\t\t\t\t\t\t\t\"Email not sent to {0} (unsubscribed / disabled)\",\n\t\t\t\t\t\t\t[ frappe.utils.escape_html(r.message[\"emails_not_sent_to\"]) ]\n\t\t\t\t\t\t));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __('Email sent successfully.'),\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.email_dialog.hide();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__(\"There were errors while sending email. Please try again.\"));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tadd_summary_btns(map) {\n\t\tthis.$summary_btns.html('');\n\t\tmap.forEach(m => {\n\t\t\tif (m.condition) {\n\t\t\t\tm.visible_btns.forEach(b => {\n\t\t\t\t\tconst class_name = b.split(' ')[0].toLowerCase();\n\t\t\t\t\tconst btn = __(b);\n\t\t\t\t\tthis.$summary_btns.append(\n\t\t\t\t\t\t`<div class=\"summary-btn btn btn-default ${class_name}-btn\">${btn}</div>`\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.$summary_btns.children().last().removeClass('mr-4');\n\t}\n\n\ttoggle_summary_placeholder(show) {\n\t\tif (show) {\n\t\t\tthis.$summary_wrapper.css('display', 'none');\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'flex');\n\t\t} else {\n\t\t\tthis.$summary_wrapper.css('display', 'flex');\n\t\t\tthis.$component.find('.no-summary-placeholder').css('display', 'none');\n\t\t}\n\t}\n\n\tget_condition_btn_map(after_submission) {\n\t\tif (after_submission)\n\t\t\treturn [{ condition: true, visible_btns: ['Print Receipt', 'Email Receipt','Send Whatsapp', 'New Order'] }];\n\n\t\treturn [\n\t\t\t{ condition: this.doc.docstatus === 0, visible_btns: ['Print Receipt','Edit Order', 'Delete Order','Send Whatsapp'] },\n\t\t\t{ condition: !this.doc.is_return && this.doc.docstatus === 1, visible_btns: ['Print Receipt', 'Email Receipt', 'Return','Send Whatsapp']},\n\t\t\t{ condition: this.doc.is_return && this.doc.docstatus === 1, visible_btns: ['Print Receipt', 'Email Receipt','Send Whatsapp']}\n\t\t];\n\t}\n\n\tload_summary_of(doc, after_submission=false) {\n\t\tafter_submission ?\n\t\t\tthis.$component.css('grid-column', 'span 10 / span 10') :\n\t\t\tthis.$component.css('grid-column', 'span 6 / span 6');\n\n\t\tthis.toggle_summary_placeholder(false);\n\n\t\tthis.doc = doc;\n\n\t\tthis.attach_document_info(doc);\n\n\t\tthis.attach_items_info(doc);\n\n\t\tthis.attach_totals_info(doc);\n\n\t\tthis.attach_payments_info(doc);\n\n\t\tconst condition_btns_map = this.get_condition_btn_map(after_submission);\n\n\t\tthis.add_summary_btns(condition_btns_map);\n\t\tthis.$summary_wrapper.css(\"width\",after_submission ? \"35%\" : \"60%\")\n\t}\n\n\tattach_document_info(doc) {\n\t\tfrappe.db.get_value('Customer', this.doc.customer, 'email_id').then(({ message }) => {\n\t\t\tthis.customer_email = message.email_id || '';\n\t\t\tconst upper_section_dom = this.get_upper_section_html(doc);\n\t\t\tthis.$upper_section.html(upper_section_dom);\n\t\t});\n\t}\n\n\tattach_items_info(doc) {\n\t\tthis.$items_container.html('');\n\t\tdoc.items.forEach(item => {\n\t\t\tconst item_dom = this.get_item_html(doc, item);\n\t\t\tthis.$items_container.append(item_dom);\n\t\t\tthis.set_dynamic_rate_header_width();\n\t\t});\n\t}\n\n\tset_dynamic_rate_header_width() {\n\t\tconst rate_cols = Array.from(this.$items_container.find(\".item-rate-disc\"));\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", \"\");\n\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\tif ($(elm).width() > max_width)\n\t\t\t\tmax_width = $(elm).width();\n\t\t\treturn max_width;\n\t\t}, 0);\n\n\t\tmax_width += 1;\n\t\tif (max_width == 1) max_width = \"\";\n\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", max_width);\n\t}\n\n\tattach_payments_info(doc) {\n\t\tthis.$payment_container.html('');\n\t\tdoc.payments.forEach(p => {\n\t\t\tif (p.amount) {\n\t\t\t\tconst payment_dom = this.get_payment_html(doc, p);\n\t\t\t\tthis.$payment_container.append(payment_dom);\n\t\t\t}\n\t\t});\n\t\tif (doc.redeem_loyalty_points && doc.loyalty_amount) {\n\t\t\tconst payment_dom = this.get_payment_html(doc, {\n\t\t\t\tmode_of_payment: 'Loyalty Points',\n\t\t\t\tamount: doc.loyalty_amount,\n\t\t\t});\n\t\t\tthis.$payment_container.append(payment_dom);\n\t\t}\n\t}\n\n\tattach_totals_info(doc) {\n\t\tthis.$totals_container.html('');\n\n\t\tconst net_total_dom = this.get_net_total_html(doc);\n\t\tconst taxes_dom = this.get_taxes_html(doc);\n\t\tconst discount_dom = this.get_discount_html(doc);\n\t\tconst grand_total_dom = this.get_grand_total_html(doc);\n\t\tthis.$totals_container.append(net_total_dom);\n\t\tthis.$totals_container.append(taxes_dom);\n\t\tthis.$totals_container.append(discount_dom);\n\t\tthis.$totals_container.append(grand_total_dom);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css('display', 'flex') : this.$component.css('display', 'none');\n\n\t}\n};\n"],
  "mappings": "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",
  "names": ["selected_item", "wrapper", "updateLedgerBalance", "customerSection", "balance", "ledgerBalanceDiv", "fetchLedgerBalance", "customerId", "error", "resetCustomerBtn", "ledgerBalance", "value", "r", "me", "table_fields", "dialog", "d", "fetch_pos_payment_methods", "pos_profile", "payments", "pay", "mode_of_payment", "pos_profile_query", "company", "balance_details", "method", "res", "data", "message", "profile", "group", "show", "voucher", "args", "items", "item", "field", "item_row", "action", "details", "minimize", "cart_item", "fieldname", "selector", "batch_serial_map", "batch", "item_to_clone", "i", "new_row", "__spreadValues", "row", "item_code", "warehouse", "name", "doc", "from_held", "doctype", "resolve", "_frm", "page", "frm", "item_row_exists", "from_selector", "qty_needed", "batch_no", "serial_no", "rate", "uom", "valuation_rate", "custom_item_uoms", "custom_logical_rack", "new_item", "total_incoming_rate", "has_batch_no", "batch_no_check", "remove_item", "serialized", "batched", "no_serial_selected", "no_batch_selected", "resp", "available_qty", "is_stock_item", "bold_uom", "bold_item_code", "bold_warehouse", "bold_available_qty", "field_or_action", "field_control", "current_item", "e", "div", "save_error", "view", "frm", "wrapper", "events", "pos_profile", "settings", "currency", "init_item_cart", "reload_status", "cardlist", "tir", "section", "res", "message", "start", "page_length", "search_term", "doc", "price_list", "item_group", "items", "me", "get_item_code_header", "flex_value", "html_header", "item", "item_html", "name", "item_selector", "item_code", "item_data", "$item_to_update", "get_item_image_html", "get_item_name", "get_description_html", "get_item_code", "get_rate_discount_html", "set_dynamic_rate_header_width", "rate_cols", "max_width", "elm", "html_code", "item_code_flex_value", "error", "image", "item_name", "item_image", "serial_no", "batch_no", "barcode", "actual_qty", "uom", "price_list_rate", "precision", "indicator_color", "qty_to_display", "$img", "item_abbr", "total_rate", "value", "oEvent", "iCode", "sDecoded", "sScancode", "$item", "rate", "valuation_rate", "custom_item_uoms", "custom_logical_rack", "e", "ctrl_label", "minimize", "show", "wrapper", "events", "settings", "html", "me", "e", "show", "$cart_item", "item_row_name", "d", "values", "frm", "mobile_number_numpad_div", "numpad_num", "numbers", "xx", "current_value", "can_edit_discount", "row", "btn", "shortcut_key", "fieldname", "shortcut_label", "ctrl_label", "item_cart_visible", "checkout_btn_invisible", "item", "item_is_highlighted", "query", "allowed_customer_group", "customer", "resolve", "message", "loyalty_program", "r", "loyalty_points", "conversion_factor", "__spreadProps", "__spreadValues", "discount", "email_id", "mobile_no", "image", "get_customer_description", "grand_total", "value", "currency", "items", "total_item_qty", "taxes", "taxes_html", "t", "name", "item_selector", "remove_item", "$item", "item_row", "no_of_cart_items", "item_data", "$item_to_update", "item_html", "get_item_image_html", "get_description_html", "get_rate_discount_html", "uoms", "delete_button", "remove_button", "set_dynamic_rate_header_width", "rate_cols", "max_width", "elm", "error", "item_name", "$img", "item_abbr", "selector", "show_checkout", "toggle", "$no_item_element", "$btn", "current_action", "action_is_field_edit", "action_is_allowed", "action_is_pressed_twice", "first_click_event", "field_to_edit_changed", "label", "curr_action", "curr_action_is_highlighted", "curr_action_is_action", "$customer_form", "dfs", "df", "handle_customer_field_change", "current_customer", "res", "transaction_container", "elapsed_time", "invoice", "posting_datetime", "indicator_color", "wrapper", "events", "settings", "item", "current_item_changed", "hide_item_details", "item_row", "serialized", "batched", "no_bundle_selected", "item_name", "description", "image", "price_list_rate", "get_description_html", "$img", "item_abbr", "fields_to_display", "fieldname", "idx", "field_meta", "df", "me", "uoms", "doc", "__spreadProps", "__spreadValues", "fields", "label", "available_qty", "is_stock_item", "bold_item_code", "bold_warehouse", "value", "field_control", "selected_serial_nos", "s", "batch_serial_map", "acc", "r", "batch_no", "batch_serial_nos", "serial_nos_belongs_to_other_batch", "frm", "show", "wrapper", "events", "cols", "keys", "css_classes", "fieldnames_map", "fieldnames", "get_keys", "a", "row", "i", "a2", "number", "j", "class_to_append", "fieldname", "me", "$btn", "events", "wrapper", "settings", "me", "fields", "frm", "df", "df_events", "p", "mode", "__spreadValues", "$btn", "button_value", "highlight_numpad_btn", "e", "mode_clicked", "scrollLeft", "_a", "contact", "request_button", "value", "doc", "paid_amount", "items", "message", "is_cash_shortcuts_invisible", "formatted_currency", "cdt", "cdn", "default_mop", "data", "response", "amount", "success", "failure_message", "title", "grand_total", "remaining_amount", "ctrl_label", "payment_is_visible", "active_mode", "mode_of_payments", "m", "mode_index", "next_mode_index", "next_mode_to_be_clicked", "div", "payments", "currency", "i", "payment_type", "margin", "shortcuts", "shortcuts_html", "s", "steps", "digits", "x", "get_nearest", "nearest_x", "finalArr", "loyalty_program", "loyalty_points", "conversion_factor", "description", "read_only", "max_redeemable_amount", "redeem_loyalty_points", "remaining", "change", "label", "show", "invoicess", "wrapper", "events", "settings", "e", "search_term", "me", "invoice_name", "status", "pos_profile", "filter", "response", "invoice", "invoice_html", "posting_datetime", "show", "wrapper", "pos_profile", "events", "email_dialog", "print_dialog", "doc", "status", "indicator_color", "item_data", "get_rate_discount_html", "t", "payment", "field_names", "x", "message", "formatString", "r", "str", "args", "match", "number", "frm", "ctrl_label", "recipients", "content", "print_format", "map", "m", "b", "class_name", "btn", "show", "after_submission", "condition_btns_map", "upper_section_dom", "item", "item_dom", "rate_cols", "max_width", "elm", "p", "payment_dom", "net_total_dom", "taxes_dom", "discount_dom", "grand_total_dom"]
}
